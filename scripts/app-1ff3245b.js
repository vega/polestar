/*!
 * JSON3 with compact stringify -- Modified by Kanit Wongsuphasawat.   https://github.com/kanitw/json3
 *
 * Forked from JSON v3.3.2 | https://bestiejs.github.io/json3 | Copyright 2012-2014, Kit Cambridge | http://kit.mit-license.org
 */
function getNameMap(e){return e.reduce(function(e,t){return e[t.name]=t,e},{})}(function(){function e(t,r){function a(e){if(a[e]!==m)return a[e];var t;if("bug-string-char-index"==e)t="a"!="a"[0];else if("json"==e)t=a("json-stringify")&&a("json-parse");else{var n,i='{"a":[1,true,false,null,"\\u0000\\b\\n\\f\\r\\t"]}';if("json-stringify"==e){var l=r.stringify,u="function"==typeof l&&b;if(u){(n=function(){return 1}).toJSON=n;try{u="0"===l(0)&&"0"===l(new o)&&'""'==l(new s)&&l(y)===m&&l(m)===m&&l()===m&&"1"===l(n)&&"[1]"==l([n])&&"[null]"==l([m])&&"null"==l(null)&&"[null,null,null]"==l([m,y,null])&&l({a:[n,!0,!1,null,"\x00\b\n\f\r	"]})==i&&"1"===l(null,n)&&"[\n 1,\n 2\n]"==l([1,2],null,1)&&'"-271821-04-20T00:00:00.000Z"'==l(new c(-864e13))&&'"+275760-09-13T00:00:00.000Z"'==l(new c(864e13))&&'"-000001-01-01T00:00:00.000Z"'==l(new c(-621987552e5))&&'"1969-12-31T23:59:59.999Z"'==l(new c(-1))}catch(d){u=!1}}t=u}if("json-parse"==e){var f=r.parse;if("function"==typeof f)try{if(0===f("0")&&!f(!1)){n=f(i);var p=5==n.a.length&&1===n.a[0];if(p){try{p=!f('"	"')}catch(d){}if(p)try{p=1!==f("01")}catch(d){}if(p)try{p=1!==f("1.")}catch(d){}}}}catch(d){p=!1}t=p}}return a[e]=!!t}t||(t=i.Object()),r||(r=i.Object());var o=t.Number||i.Number,s=t.String||i.String,l=t.Object||i.Object,c=t.Date||i.Date,u=t.SyntaxError||i.SyntaxError,d=t.TypeError||i.TypeError,f=t.Math||i.Math,p=t.JSON||i.JSON;"object"==typeof p&&p&&(r.stringify=p.stringify,r.parse=p.parse);var h,g,m,v=l.prototype,y=v.toString,b=new c(-0xc782b5b800cec);try{b=-109252==b.getUTCFullYear()&&0===b.getUTCMonth()&&1===b.getUTCDate()&&10==b.getUTCHours()&&37==b.getUTCMinutes()&&6==b.getUTCSeconds()&&708==b.getUTCMilliseconds()}catch(x){}var k="[object Function]",w="[object Date]",S="[object Number]",_="[object String]",O="[object Array]",E="[object Boolean]",T=a("bug-string-char-index");if(!b)var A=f.floor,L=[0,31,59,90,120,151,181,212,243,273,304,334],C=function(e,t){return L[t]+365*(e-1970)+A((e-1969+(t=+(t>1)))/4)-A((e-1901+t)/100)+A((e-1601+t)/400)};(h=v.hasOwnProperty)||(h=function(e){var t,n={};return(n.__proto__=null,n.__proto__={toString:1},n).toString!=y?h=function(e){var t=this.__proto__,n=e in(this.__proto__=null,this);return this.__proto__=t,n}:(t=n.constructor,h=function(e){var n=(this.constructor||t).prototype;return e in this&&!(e in n&&this[e]===n[e])}),n=null,h.call(this,e)}),g=function(e,t){var r,i,a,o=0;(r=function(){this.valueOf=0}).prototype.valueOf=0,i=new r;for(a in i)h.call(i,a)&&o++;return r=i=null,o?g=2==o?function(e,t){var n,r={},i=y.call(e)==k;for(n in e)i&&"prototype"==n||h.call(r,n)||!(r[n]=1)||!h.call(e,n)||t(n)}:function(e,t){var n,r,i=y.call(e)==k;for(n in e)i&&"prototype"==n||!h.call(e,n)||(r="constructor"===n)||t(n);(r||h.call(e,n="constructor"))&&t(n)}:(i=["valueOf","toString","toLocaleString","propertyIsEnumerable","isPrototypeOf","hasOwnProperty","constructor"],g=function(e,t){var r,a,o=y.call(e)==k,s=!o&&"function"!=typeof e.constructor&&n[typeof e.hasOwnProperty]&&e.hasOwnProperty||h;for(r in e)o&&"prototype"==r||!s.call(e,r)||t(r);for(a=i.length;r=i[--a];s.call(e,r)&&t(r));}),g(e,t)};var M={92:"\\\\",34:'\\"',8:"\\b",12:"\\f",10:"\\n",13:"\\r",9:"\\t"},N="000000",P=function(e,t){return(N+(t||0)).slice(-e)},I="\\u00",R=function(e){for(var t='"',n=0,r=e.length,i=!T||r>10,a=i&&(T?e.split(""):e);r>n;n++){var o=e.charCodeAt(n);switch(o){case 8:case 9:case 10:case 12:case 13:case 34:case 92:t+=M[o];break;default:if(32>o){t+=I+P(2,o.toString(16));break}t+=i?a[n]:e.charAt(n)}}return t+'"'},D=function(e,t,n,r,i,a,o,s){var l,c,u,f,p,v,b,x,k,T,L,M,N,I,z,j;s=s||0;try{l=t[e]}catch(U){}if("object"==typeof l&&l)if(c=y.call(l),c!=w||h.call(l,"toJSON"))"function"==typeof l.toJSON&&(c!=S&&c!=_&&c!=O||h.call(l,"toJSON"))&&(l=l.toJSON(e));else if(l>-1/0&&1/0>l){if(C){for(p=A(l/864e5),u=A(p/365.2425)+1970-1;C(u+1,0)<=p;u++);for(f=A((p-C(u,0))/30.42);C(u,f+1)<=p;f++);p=1+p-C(u,f),v=(l%864e5+864e5)%864e5,b=A(v/36e5)%24,x=A(v/6e4)%60,k=A(v/1e3)%60,T=v%1e3}else u=l.getUTCFullYear(),f=l.getUTCMonth(),p=l.getUTCDate(),b=l.getUTCHours(),x=l.getUTCMinutes(),k=l.getUTCSeconds(),T=l.getUTCMilliseconds();l=(0>=u||u>=1e4?(0>u?"-":"+")+P(6,0>u?-u:u):P(4,u))+"-"+P(2,f+1)+"-"+P(2,p)+"T"+P(2,b)+":"+P(2,x)+":"+P(2,k)+"."+P(3,T)+"Z"}else l=null;if(n&&(l=n.call(t,e,l)),null===l)return"null";if(c=y.call(l),c==E)return""+l;if(c==S)return l>-1/0&&1/0>l?""+l:"null";if(c==_)return R(""+l);if("object"==typeof l){for(I=o.length;I--;)if(o[I]===l)throw d();if(o.push(l),L=[],z=a,a+=i,c==O){var j,F=a.length;for(N=0,I=l.length;I>N;N++)M=D(N,l,n,r,i,a,o,s),j=M===m?"null":M,F+=j.length+(N>0?1:0),L.push(j);j=L.length?i&&F>s?"[\n"+a+L.join(",\n"+a)+"\n"+z+"]":"["+L.join(",")+"]":"[]"}else{var F=a.length,N=0;g(r||l,function(e){var t,c=D(e,l,n,r,i,a,o,s);c!==m&&(t=R(e)+":"+(i?" ":"")+c,F+=t.length+(N++>0?1:0),L.push(t))}),j=L.length?i&&F>s?"{\n"+a+L.join(",\n"+a)+"\n"+z+"}":"{"+L.join(",")+"}":"{}"}return o.pop(),j}};if(r.stringify=function(e,t,r,i){var a,o,s,l;if(n[typeof t]&&t)if((l=y.call(t))==k)o=t;else if(l==O){s={};for(var c,u=0,d=t.length;d>u;c=t[u++],l=y.call(c),(l==_||l==S)&&(s[c]=1));}if(r)if((l=y.call(r))==S){if((r-=r%1)>0)for(a="",r>10&&(r=10);a.length<r;a+=" ");}else l==_&&(a=r.length<=10?r:r.slice(0,10));return D("",(c={},c[""]=e,c),o,s,a,"",[],i)},r.compactStringify=function(e,t,n){return r.stringify(e,t,n,60)},!a("json-parse")){var z,j,U=s.fromCharCode,F={92:"\\",34:'"',47:"/",98:"\b",116:"	",110:"\n",102:"\f",114:"\r"},W=function(){throw z=j=null,u()},B=function(){for(var e,t,n,r,i,a=j,o=a.length;o>z;)switch(i=a.charCodeAt(z)){case 9:case 10:case 13:case 32:z++;break;case 123:case 125:case 91:case 93:case 58:case 44:return e=T?a.charAt(z):a[z],z++,e;case 34:for(e="@",z++;o>z;)if(i=a.charCodeAt(z),32>i)W();else if(92==i)switch(i=a.charCodeAt(++z)){case 92:case 34:case 47:case 98:case 116:case 110:case 102:case 114:e+=F[i],z++;break;case 117:for(t=++z,n=z+4;n>z;z++)i=a.charCodeAt(z),i>=48&&57>=i||i>=97&&102>=i||i>=65&&70>=i||W();e+=U("0x"+a.slice(t,z));break;default:W()}else{if(34==i)break;for(i=a.charCodeAt(z),t=z;i>=32&&92!=i&&34!=i;)i=a.charCodeAt(++z);e+=a.slice(t,z)}if(34==a.charCodeAt(z))return z++,e;W();default:if(t=z,45==i&&(r=!0,i=a.charCodeAt(++z)),i>=48&&57>=i){for(48==i&&(i=a.charCodeAt(z+1),i>=48&&57>=i)&&W(),r=!1;o>z&&(i=a.charCodeAt(z),i>=48&&57>=i);z++);if(46==a.charCodeAt(z)){for(n=++z;o>n&&(i=a.charCodeAt(n),i>=48&&57>=i);n++);n==z&&W(),z=n}if(i=a.charCodeAt(z),101==i||69==i){for(i=a.charCodeAt(++z),(43==i||45==i)&&z++,n=z;o>n&&(i=a.charCodeAt(n),i>=48&&57>=i);n++);n==z&&W(),z=n}return+a.slice(t,z)}if(r&&W(),"true"==a.slice(z,z+4))return z+=4,!0;if("false"==a.slice(z,z+5))return z+=5,!1;if("null"==a.slice(z,z+4))return z+=4,null;W()}return"$"},H=function(e){var t,n;if("$"==e&&W(),"string"==typeof e){if("@"==(T?e.charAt(0):e[0]))return e.slice(1);if("["==e){for(t=[];e=B(),"]"!=e;n||(n=!0))n&&(","==e?(e=B(),"]"==e&&W()):W()),","==e&&W(),t.push(H(e));return t}if("{"==e){for(t={};e=B(),"}"!=e;n||(n=!0))n&&(","==e?(e=B(),"}"==e&&W()):W()),(","==e||"string"!=typeof e||"@"!=(T?e.charAt(0):e[0])||":"!=B())&&W(),t[e.slice(1)]=H(B());return t}W()}return e},X=function(e,t,n){var r=q(e,t,n);r===m?delete e[t]:e[t]=r},q=function(e,t,n){var r,i=e[t];if("object"==typeof i&&i)if(y.call(i)==O)for(r=i.length;r--;)X(i,r,n);else g(i,function(e){X(i,e,n)});return n.call(e,t,i)};r.parse=function(e,t){var n,r;return z=0,j=""+e,n=H(B()),"$"!=B()&&W(),z=j=null,t&&y.call(t)==k?q((r={},r[""]=n,r),"",t):n}}return r.runInContext=e,r}var t="function"==typeof define&&define.amd,n={"function":!0,object:!0},r=n[typeof exports]&&exports&&!exports.nodeType&&exports,i=n[typeof window]&&window||this,a=r&&n[typeof module]&&module&&!module.nodeType&&"object"==typeof global&&global;if(!a||a.global!==a&&a.window!==a&&a.self!==a||(i=a),r&&!t)e(i,r);else{var o=i.JSON,s=i.JSON3,l=!1,c=e(i,i.JSON3={noConflict:function(){return l||(l=!0,i.JSON=o,i.JSON3=s,o=s=null),c}});i.JSON={parse:c.parse,stringify:c.stringify}}t&&define(function(){return c})}).call(this),function(e){if("function"==typeof define&&define.amd)define(["d3","topojson"],e);else{var t="undefined"==typeof topojson?null:topojson;vg=e(d3,t)}}(function(e,t){function n(e){return e.replace(N,"$1\\'")}function r(e,t,n,r){for(;r>n;){var i=n+r>>>1;C.cmp(e[i],t)<0?n=i+1:r=i}return n}function a(e,t,n){var r=0,i=e.split(P);return e=n?(i=i.reverse()).filter(function(e){return r+=e.length,t>=r}).reverse():i.filter(function(e){return r+=e.length,t>=r}),e.length?e.join("").trim():i[0].slice(0,t)}function o(e){C.config.isNode?process.stderr.write(e+"\n"):console.log(e)}function s(e){C.config.isNode?process.stderr.write(e+"\n"):console.error(e)}function l(e){return e.__vgtree__=!0,e.nodes=function(){return c(this,[])},e}function c(e,t){var n,r=e.values,i=r?r.length:0;for(t.push(e),n=0;i>n;++n)c(r[n],t);return t}function u(e){var t,n,r=e;if(C.isArray(e))for(r=[],t=0,n=e.length;n>t;++t)r.push(u(e[t]));else if(C.isObject(e)){r={};for(t in e)r[t]=u(e[t])}return r}function d(e,t,n){if(r=[],n&&t.length>1){for(var r,i,a,o=f(e.domain()),s=-1,l=t.length,c=(t[1]-t[0])/++n;++s<l;)for(i=n;--i>0;)(a=+t[s]-i*c)>=o[0]&&r.push(a);for(--s,i=0;++i<n&&(a=+t[s]+i*c)<o[1];)r.push(a)}return r}function f(e){var t=e[0],n=e[e.length-1];return n>t?[t,n]:[n,t]}function p(e){return e.rangeExtent?e.rangeExtent():f(e.range())}function h(e,t,n,r,i,a){i=Math.max(i,0)+a,("left"===e||"top"===e)&&(i*=-1),"top"===e||"bottom"===e?(C.extend(t.properties.enter,{x:n,y:{value:i}}),C.extend(t.properties.update,{x:r,y:{value:i},align:{value:"center"},baseline:{value:V[e]}})):(C.extend(t.properties.enter,{x:{value:i},y:n}),C.extend(t.properties.update,{x:{value:i},y:r,align:{value:K[e]},baseline:{value:"middle"}}))}function g(e,t,n,r,i){var a="left"===e||"top"===e?-1:1;i=1/0===i?"top"===e||"bottom"===e?{group:"mark.group.height",mult:-a}:{group:"mark.group.width",mult:-a}:{value:a*i},"top"===e||"bottom"===e?(C.extend(t.properties.enter,{x:n,y:{value:0},y2:i}),C.extend(t.properties.update,{x:r,y:{value:0},y2:i}),C.extend(t.properties.exit,{x:r})):(C.extend(t.properties.enter,{x:{value:0},x2:i,y:n}),C.extend(t.properties.update,{x:{value:0},x2:i,y:r}),C.extend(t.properties.exit,{y:r}))}function m(e,t,n,r){var i=~~((n[0]+n[1])/2),a="top"===e||"left"===e?-1:1;"bottom"===e||"top"===e?C.extend(t.properties.update,{x:{value:i},y:{value:a*r},angle:{value:0}}):C.extend(t.properties.update,{x:{value:a*r},y:{value:i},angle:{value:-90}})}function v(e,t,n,r){var i;("top"===e||"left"===e)&&(r=-1*r),i="bottom"===e||"top"===e?"M"+n[0]+","+r+"V0H"+n[1]+"V"+r:"M"+r+","+n[0]+"H0V"+n[1]+"H"+r,t.properties.update.path={value:i}}function y(e,t,n){var r=n?{}:e,i=e.mark.def.offset,a=e.mark.def.orient,o=t.width,s=t.height;if(C.isArray(i)){var l=i[0],c=i[1];switch(a){case"left":r.x=-l,r.y=c;break;case"right":r.x=o+l,r.y=c;break;case"bottom":r.x=l,r.y=s+c;break;case"top":r.x=l,r.y=-c;break;default:r.x=l,r.y=c}}else switch(C.isObject(i)&&(i=-t.scales[i.scale](i.value)),a){case"left":r.x=-i,r.y=0;break;case"right":r.x=o+i,r.y=0;break;case"bottom":r.x=0,r.y=s+i;break;case"top":r.x=0,r.y=-i;break;default:r.x=0,r.y=0}n&&n.interpolate(e,r)}function b(){return{type:"rule",interactive:!1,key:"data",properties:{enter:{stroke:{value:C.config.axis.tickColor},strokeWidth:{value:C.config.axis.tickWidth},opacity:{value:1e-6}},exit:{opacity:{value:1e-6}},update:{opacity:{value:1}}}}}function x(){return{type:"text",interactive:!0,key:"data",properties:{enter:{fill:{value:C.config.axis.tickLabelColor},font:{value:C.config.axis.tickLabelFont},fontSize:{value:C.config.axis.tickLabelFontSize},opacity:{value:1e-6},text:{field:"label"}},exit:{opacity:{value:1e-6}},update:{opacity:{value:1}}}}}function k(){return{type:"text",interactive:!0,properties:{enter:{font:{value:C.config.axis.titleFont},fontSize:{value:C.config.axis.titleFontSize},fontWeight:{value:C.config.axis.titleFontWeight},fill:{value:C.config.axis.titleColor},align:{value:"center"},baseline:{value:"middle"},text:{field:"data"}},update:{}}}}function w(){return{type:"path",interactive:!1,properties:{enter:{x:{value:.5},y:{value:.5},stroke:{value:C.config.axis.axisColor},strokeWidth:{value:C.config.axis.axisWidth}},update:{}}}}function S(e,t,n){var r,i=n?{}:e,a=e.mark.def.offset,o=e.mark.def.orient,s=2*e.mark.def.padding,l=~~e.bounds.width()+(e.width?0:s),c=~~e.bounds.height()+(e.height?0:s);switch(i.x=.5,i.y=.5,i.width=l,i.height=c,!n&&t.bounds&&(t.bounds.delta=t.bounds.x2-t.width),o){case"left":r=t.bounds?t.bounds.x1:0,i.x+=r-a-l;break;case"right":r=t.width,t.bounds&&(r=n?t.width+t.bounds.delta:t.bounds.x2),i.x+=r+a}n&&n.interpolate(e,i),e.mark.def.properties.enter(e,t,n)}function _(e,t,n,r,i){var a=e.properties.enter,o=e.properties.update;t&&(a.size=o.size={scale:t.scaleName,field:"data"}),n&&(a.shape=o.shape={scale:n.scaleName,field:"data"}),r&&(a.fill=o.fill={scale:r.scaleName,field:"data"}),i&&(a.stroke=o.stroke={scale:i.scaleName,field:"data"})}function O(){var e=C.config.legend;return{type:"text",interactive:!1,key:"data",properties:{enter:{x:{value:0},y:{value:0},fill:{value:e.titleColor},font:{value:e.titleFont},fontSize:{value:e.titleFontSize},fontWeight:{value:e.titleFontWeight},baseline:{value:"top"},text:{field:"data"},opacity:{value:1e-6}},exit:{opacity:{value:1e-6}},update:{opacity:{value:1}}}}}function E(){var e=C.config.legend;return{type:"symbol",interactive:!1,key:"data",properties:{enter:{x:{field:"offset",mult:.5},y:{scale:"legend",field:"index"},shape:{value:e.symbolShape},size:{value:e.symbolSize},stroke:{value:e.symbolColor},strokeWidth:{value:e.symbolStrokeWidth},opacity:{value:1e-6}},exit:{opacity:{value:1e-6}},update:{x:{field:"offset",mult:.5},y:{scale:"legend",field:"index"},opacity:{value:1}}}}}function T(){var e=C.config.legend;return{type:"text",interactive:!1,key:"data",properties:{enter:{x:{field:"offset",offset:5},y:{scale:"legend",field:"index"},fill:{value:e.labelColor},font:{value:e.labelFont},fontSize:{value:e.labelFontSize},align:{value:e.labelAlign},baseline:{value:e.labelBaseline},text:{field:"label"},opacity:{value:1e-6}},exit:{opacity:{value:1e-6}},update:{opacity:{value:1},x:{field:"offset",offset:5},y:{scale:"legend",field:"index"}}}}}function A(){var e=C.config.legend;return{type:"rect",interactive:!1,properties:{enter:{x:{value:0},y:{value:0},width:{value:e.gradientWidth},height:{value:e.gradientHeight},stroke:{value:e.gradientStrokeColor},strokeWidth:{value:e.gradientStrokeWidth},opacity:{value:1e-6}},exit:{opacity:{value:1e-6}},update:{x:{value:0},y:{value:0},opacity:{value:1}}}}}function L(){var e=C.config.legend;return{type:"text",interactive:!1,key:"data",properties:{enter:{x:{scale:"legend",field:"data"},y:{value:20},dy:{value:2},fill:{value:e.labelColor},font:{value:e.labelFont},fontSize:{value:e.labelFontSize},align:{field:"align"},baseline:{value:"top"},text:{field:"label"},opacity:{value:1e-6}},exit:{opacity:{value:1e-6}},update:{x:{scale:"legend",field:"data"},y:{value:20},opacity:{value:1}}}}}var C={version:"1.5.0",d3:e,topojson:t},M=Object.prototype.toString;C.isObject=function(e){return e===Object(e)},C.isFunction=function(e){return"[object Function]"==M.call(e)},C.isString=function(e){return"[object String]"==M.call(e)},C.isArray=Array.isArray||function(e){return"[object Array]"==M.call(e)},C.isNumber=function(e){return"[object Number]"==M.call(e)},C.isBoolean=function(e){return"[object Boolean]"==M.call(e)},C.isTree=function(e){return e&&e.__vgtree__},C.tree=function(e,t){var n=[e];return n.__vgtree__=!0,n.children=t||"children",n},C.number=function(e){return null===e?null:+e},C.boolean=function(e){return null===e?null:!!e},C.date=function(e){return null===e?null:Date.parse(e)},C.startsWith=String.prototype.startsWith?function(e,t){return e.startsWith(t)}:function(e,t){return 0===e.lastIndexOf(t,0)},C.identity=function(e){return e},C.true=function(){return!0},C.extend=function(e){for(var t,n,r=1,i=arguments.length;i>r;++r){t=arguments[r];for(n in t)e[n]=t[n]}return e},C.duplicate=function(e){return JSON.parse(JSON.stringify(e))},C.field=function(e){return e.split("\\.").map(function(e){return e.split(".")}).reduce(function(e,t){return e.length&&(e[e.length-1]+="."+t.shift()),e.push.apply(e,t),e},[])},C.accessor=function(e){var t;return C.isFunction(e)||null==e?e:C.isString(e)&&(t=C.field(e)).length>1?function(e){return t.reduce(function(e,t){return e[t]},e)}:function(t){return t[e]}},C.mutator=function(e){var t;return C.isString(e)&&(t=C.field(e)).length>1?function(e,n){for(var r=0;r<t.length-1;++r)e=e[t[r]];e[t[r]]=n}:function(t,n){t[e]=n}},C.comparator=function(e){var t=[];return void 0===e&&(e=[]),e=C.array(e).map(function(e){var n=1;return"-"===e[0]?(n=-1,e=e.slice(1)):"+"===e[0]&&(n=1,e=e.slice(1)),t.push(n),C.accessor(e)}),function(n,r){var i,a,o,s,l;for(i=0,a=e.length;a>i;++i){if(o=e[i],s=o(n),l=o(r),l>s)return-1*t[i];if(s>l)return t[i]}return 0}},C.cmp=function(e,t){return t>e?-1:e>t?1:e>=t?0:null===e&&null===t?0:null===e?-1:null===t?1:0/0},C.numcmp=function(e,t){return e-t},C.array=function(e){return null!=e?C.isArray(e)?e:[e]:[]},C.values=function(e){return C.isObject(e)&&!C.isArray(e)&&e.values?e.values:e},C.str=function(e){return C.isArray(e)?"["+e.map(C.str)+"]":C.isObject(e)?JSON.stringify(e):C.isString(e)?"'"+n(e)+"'":e};var N=/(^|[^\\])'/g;C.keys=function(e){var t=[];for(var n in e)t.push(n);return t},C.toMap=function(e){return e.reduce(function(e,t){return e[t]=1,e},{})},C.unique=function(e,t,n){if(!C.isArray(e)||0===e.length)return[];t=t||C.identity,n=n||[];for(var r,i={},a=0,o=e.length;o>a;++a)r=t(e[a]),r in i||(i[r]=!0,n.push(r));return n},C.minIndex=function(e,t){if(!C.isArray(e)||0==e.length)return-1;t=t||C.identity;for(var n=0,r=t(e[0]),i=r,a=1,o=e.length;o>a;++a)i=t(e[a]),r>i&&(r=i,n=a);return n},C.maxIndex=function(e,t){if(!C.isArray(e)||0==e.length)return-1;t=t||C.identity;for(var n=0,r=t(e[0]),i=r,a=1,o=e.length;o>a;++a)i=t(e[a]),i>r&&(r=i,n=a);return n},C.bins=function(e){e=e||{};var t,n,i,a,o=e.maxbins||1024,s=e.base||10,l=e.div||[5,2],c=e.minstep||0,u=Math.log(s),d=Math.ceil(Math.log(o)/u),f=e.min,p=e.max,h=p-f,g=Math.max(c,Math.pow(s,Math.round(Math.log(h)/u)-d)),m=Math.ceil(h/g);if(null!=e.step)g=e.step;else if(e.steps)g=e.steps[Math.min(e.steps.length-1,r(e.steps,h/o,0,e.steps.length))];else{do g*=s,m=Math.ceil(h/g);while(m>o);for(i=0;i<l.length;++i)n=g/l[i],n>=c&&o>=h/n&&(g=n,m=Math.ceil(h/g))}return n=Math.log(g),t=n>=0?0:~~(-n/u)+1,a=(0>f?-1:1)*Math.pow(s,-t-1),f=Math.min(f,Math.floor(f/g+a)*g),p=Math.ceil(p/g)*g,{start:f,stop:p,step:g,unit:t}},C.truncate=function(e,t,n,r,i){var o=e.length;if(t>=o)return e;i=i||"...";var s=Math.max(0,t-i.length);switch(n){case"left":return i+(r?a(e,s,1):e.slice(o-s));case"middle":case"center":var l=Math.ceil(s/2),c=Math.floor(s/2);return(r?a(e,l):e.slice(0,l))+i+(r?a(e,c,1):e.slice(o-c));default:return(r?a(e,s):e.slice(0,s))+i}};var P=/([\u0009\u000A\u000B\u000C\u000D\u0020\u00A0\u1680\u180E\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200A\u202F\u205F\u2028\u2029\u3000\uFEFF])/;C.log=function(e){o("[Vega Log] "+e)},C.error=function(e){s("[Vega Err] "+e)},C.config={},C.config.isNode=!1,C.config.domainWhiteList=!1,C.config.safeMode=!1,C.config.baseURL="",C.config.defaultProtocol="http:",C.config.svgNamespace='version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"',C.config.autopadInset=5,C.config.scale={time:e.time.scale,utc:e.time.scale.utc},C.config.render={lineWidth:1,lineCap:"butt",font:"sans-serif",fontSize:11},C.config.axis={orient:"bottom",ticks:10,padding:3,axisColor:"#000",gridColor:"#d8d8d8",tickColor:"#000",tickLabelColor:"#000",axisWidth:1,tickWidth:1,tickSize:6,tickLabelFontSize:11,tickLabelFont:"sans-serif",titleColor:"#000",titleFont:"sans-serif",titleFontSize:11,titleFontWeight:"bold",titleOffset:35},C.config.legend={orient:"right",offset:10,padding:3,gradientStrokeColor:"#888",gradientStrokeWidth:1,gradientHeight:16,gradientWidth:100,labelColor:"#000",labelFontSize:10,labelFont:"sans-serif",labelAlign:"left",labelBaseline:"middle",labelOffset:8,symbolShape:"circle",symbolSize:50,symbolColor:"#888",symbolStrokeWidth:1,titleColor:"#000",titleFont:"sans-serif",titleFontSize:11,titleFontWeight:"bold"},C.config.color={rgb:[128,128,128],lab:[50,0,0],hcl:[0,0,50],hsl:[0,0,.5]},C.config.range={category10:["#1f77b4","#ff7f0e","#2ca02c","#d62728","#9467bd","#8c564b","#e377c2","#7f7f7f","#bcbd22","#17becf"],category20:["#1f77b4","#aec7e8","#ff7f0e","#ffbb78","#2ca02c","#98df8a","#d62728","#ff9896","#9467bd","#c5b0d5","#8c564b","#c49c94","#e377c2","#f7b6d2","#7f7f7f","#c7c7c7","#bcbd22","#dbdb8d","#17becf","#9edae5"],shapes:["circle","cross","diamond","square","triangle-down","triangle-up"]},C.Bounds=function(){var e=function(e){this.clear(),e&&this.union(e)},t=e.prototype;return t.clear=function(){return this.x1=+Number.MAX_VALUE,this.y1=+Number.MAX_VALUE,this.x2=-Number.MAX_VALUE,this.y2=-Number.MAX_VALUE,this},t.set=function(e,t,n,r){return this.x1=e,this.y1=t,this.x2=n,this.y2=r,this},t.add=function(e,t){return e<this.x1&&(this.x1=e),t<this.y1&&(this.y1=t),e>this.x2&&(this.x2=e),t>this.y2&&(this.y2=t),this},t.expand=function(e){return this.x1-=e,this.y1-=e,this.x2+=e,this.y2+=e,this},t.round=function(){return this.x1=Math.floor(this.x1),this.y1=Math.floor(this.y1),this.x2=Math.ceil(this.x2),this.y2=Math.ceil(this.y2),this},t.translate=function(e,t){return this.x1+=e,this.x2+=e,this.y1+=t,this.y2+=t,this},t.rotate=function(e,t,n){var r=Math.cos(e),i=Math.sin(e),a=t-t*r+n*i,o=n-t*i-n*r,s=this.x1,l=this.x2,c=this.y1,u=this.y2;return this.clear().add(r*s-i*c+a,i*s+r*c+o).add(r*s-i*u+a,i*s+r*u+o).add(r*l-i*c+a,i*l+r*c+o).add(r*l-i*u+a,i*l+r*u+o)},t.union=function(e){return e.x1<this.x1&&(this.x1=e.x1),e.y1<this.y1&&(this.y1=e.y1),e.x2>this.x2&&(this.x2=e.x2),e.y2>this.y2&&(this.y2=e.y2),this},t.encloses=function(e){return e&&this.x1<=e.x1&&this.x2>=e.x2&&this.y1<=e.y1&&this.y2>=e.y2},t.intersects=function(e){return e&&!(this.x2<e.x1||this.x1>e.x2||this.y2<e.y1||this.y1>e.y2)},t.contains=function(e,t){return!(e<this.x1||e>this.x2||t<this.y1||t>this.y2)},t.width=function(){return this.x2-this.x1},t.height=function(){return this.y2-this.y1},e}(),C.Gradient=function(){function e(e){this.id="grad_"+I++,this.type=e||"linear",this.stops=[],this.x1=0,this.x2=1,this.y1=0,this.y2=0}var t=e.prototype;return t.stop=function(e,t){return this.stops.push({offset:e,color:t}),this},e}();var I=0;C.canvas={},C.canvas.path=function(){function t(e){var t,n,r,i=[];e=e.slice().replace(f[0],"###$1").split(f[1]).slice(1);for(var a,o,s=0,l=e.length;l>s;s++){t=e[s],n=t.slice(1).trim().replace(f[2],"$1###-").split(f[3]),o=[t.charAt(0)];for(var a=0,c=n.length;c>a;a++)r=parseFloat(n[a]),isNaN(r)||o.push(r);var u=o[0].toLowerCase(),p=d[u];if(o.length-1>p)for(var h=1,g=o.length;g>h;h+=p)i.push([o[0]].concat(o.slice(h,h+p)));else i.push(o)}return i}function n(e,t,n,r,o,s,l){for(var c=r[0],u=r[1],d=r[2],f=r[3],p=r[4],h=r[5],g=r[6],m=i(h,g,c,u,f,p,d,t,n),v=0;v<m.length;v++){var y=a.apply(null,m[v]);e.bezierCurveTo.apply(e,y),o.add(y[0]-s,y[1]-l),o.add(y[2]-s,y[3]-l),o.add(y[4]-s,y[5]-l)}}function r(e,t,n,r){for(var o=n[0],s=n[1],l=n[2],c=n[3],u=n[4],d=n[5],f=n[6],p=i(d,f,o,s,c,u,l,e,t),h=0;h<p.length;h++){var g=a.apply(null,p[h]);r.add(g[0],g[1]),r.add(g[2],g[3]),r.add(g[4],g[5])}}function i(e,t,n,r,i,a,o,s,l){if(u=g.call(arguments),p[u])return p[u];var c=o*(Math.PI/180),d=Math.sin(c),f=Math.cos(c);n=Math.abs(n),r=Math.abs(r);var h=f*(s-e)*.5+d*(l-t)*.5,m=f*(l-t)*.5-d*(s-e)*.5,v=h*h/(n*n)+m*m/(r*r);v>1&&(v=Math.sqrt(v),n*=v,r*=v);var y=f/n,b=d/n,x=-d/r,k=f/r,w=y*s+b*l,S=x*s+k*l,_=y*e+b*t,O=x*e+k*t,E=(_-w)*(_-w)+(O-S)*(O-S),T=1/E-.25;0>T&&(T=0);var A=Math.sqrt(T);a==i&&(A=-A);var L=.5*(w+_)-A*(O-S),C=.5*(S+O)+A*(_-w),M=Math.atan2(S-C,w-L),N=Math.atan2(O-C,_-L),P=N-M;0>P&&1==a?P+=2*Math.PI:P>0&&0==a&&(P-=2*Math.PI);for(var I=Math.ceil(Math.abs(P/(.5*Math.PI+.001))),R=[],D=0;I>D;D++){var z=M+D*P/I,j=M+(D+1)*P/I;R[D]=[L,C,z,j,n,r,d,f]}return p[u]=R}function a(e,t,n,r,i,a,o,s){if(u=g.call(arguments),h[u])return h[u];var l=s*i,c=-o*a,d=o*i,f=s*a,p=Math.cos(n),m=Math.sin(n),v=Math.cos(r),y=Math.sin(r),b=.5*(r-n),x=Math.sin(.5*b),k=8/3*x*x/Math.sin(b),w=e+p-k*m,S=t+m+k*p,_=e+v,O=t+y,E=_+k*y,T=O-k*v;return h[u]=[l*w+c*S,d*w+f*S,l*E+c*T,d*E+f*T,l*_+c*O,d*_+f*O]}function o(e,t,r,i){var a,o,s,l,c,u=null,d=0,f=0,p=0,h=0,g=new C.Bounds;void 0==r&&(r=0),void 0==i&&(i=0),e.beginPath();for(var m=0,v=t.length;v>m;++m){switch(a=t[m],a[0]){case"l":d+=a[1],f+=a[2],e.lineTo(d+r,f+i),g.add(d,f);break;case"L":d=a[1],f=a[2],e.lineTo(d+r,f+i),g.add(d,f);break;case"h":d+=a[1],e.lineTo(d+r,f+i),g.add(d,f);break;case"H":d=a[1],e.lineTo(d+r,f+i),g.add(d,f);break;case"v":f+=a[1],e.lineTo(d+r,f+i),g.add(d,f);break;case"V":f=a[1],e.lineTo(d+r,f+i),g.add(d,f);break;case"m":d+=a[1],f+=a[2],e.moveTo(d+r,f+i),g.add(d,f);break;case"M":d=a[1],f=a[2],e.moveTo(d+r,f+i),g.add(d,f);break;case"c":o=d+a[5],s=f+a[6],p=d+a[3],h=f+a[4],e.bezierCurveTo(d+a[1]+r,f+a[2]+i,p+r,h+i,o+r,s+i),g.add(d+a[1],f+a[2]),g.add(p,h),g.add(o,s),d=o,f=s;break;case"C":d=a[5],f=a[6],p=a[3],h=a[4],e.bezierCurveTo(a[1]+r,a[2]+i,p+r,h+i,d+r,f+i),g.add(a[1],a[2]),g.add(p,h),g.add(d,f);break;case"s":o=d+a[3],s=f+a[4],p=2*d-p,h=2*f-h,e.bezierCurveTo(p+r,h+i,d+a[1]+r,f+a[2]+i,o+r,s+i),g.add(p,h),g.add(d+a[1],f+a[2]),g.add(o,s),p=d+a[1],h=f+a[2],d=o,f=s;break;case"S":o=a[3],s=a[4],p=2*d-p,h=2*f-h,e.bezierCurveTo(p+r,h+i,a[1]+r,a[2]+i,o+r,s+i),d=o,f=s,g.add(a[1],a[2]),g.add(p,h),g.add(o,s),p=a[1],h=a[2];break;case"q":o=d+a[3],s=f+a[4],p=d+a[1],h=f+a[2],e.quadraticCurveTo(p+r,h+i,o+r,s+i),d=o,f=s,g.add(p,h),g.add(o,s);break;case"Q":o=a[3],s=a[4],e.quadraticCurveTo(a[1]+r,a[2]+i,o+r,s+i),d=o,f=s,p=a[1],h=a[2],g.add(p,h),g.add(o,s);break;case"t":o=d+a[1],s=f+a[2],null===u[0].match(/[QqTt]/)?(p=d,h=f):"t"===u[0]?(p=2*d-l,h=2*f-c):"q"===u[0]&&(p=2*d-p,h=2*f-h),l=p,c=h,e.quadraticCurveTo(p+r,h+i,o+r,s+i),d=o,f=s,p=d+a[1],h=f+a[2],g.add(p,h),g.add(o,s);break;case"T":o=a[1],s=a[2],p=2*d-p,h=2*f-h,e.quadraticCurveTo(p+r,h+i,o+r,s+i),d=o,f=s,g.add(p,h),g.add(o,s);break;case"a":n(e,d+r,f+i,[a[1],a[2],a[3],a[4],a[5],a[6]+d+r,a[7]+f+i],g,r,i),d+=a[6],f+=a[7];break;case"A":n(e,d+r,f+i,[a[1],a[2],a[3],a[4],a[5],a[6]+r,a[7]+i],g,r,i),d=a[6],f=a[7];break;case"z":case"Z":e.closePath()}u=a}return g.translate(r,i)}function s(e,t){for(var n,i,a,o,s,l=null,c=0,u=0,d=0,f=0,p=0,h=e.length;h>p;++p){switch(n=e[p],n[0]){case"l":c+=n[1],u+=n[2],t.add(c,u);break;case"L":c=n[1],u=n[2],t.add(c,u);break;case"h":c+=n[1],t.add(c,u);break;case"H":c=n[1],t.add(c,u);break;case"v":u+=n[1],t.add(c,u);break;case"V":u=n[1],t.add(c,u);break;case"m":c+=n[1],u+=n[2],t.add(c,u);break;case"M":c=n[1],u=n[2],t.add(c,u);break;case"c":i=c+n[5],a=u+n[6],d=c+n[3],f=u+n[4],t.add(c+n[1],u+n[2]),t.add(d,f),t.add(i,a),c=i,u=a;break;case"C":c=n[5],u=n[6],d=n[3],f=n[4],t.add(n[1],n[2]),t.add(d,f),t.add(c,u);break;case"s":i=c+n[3],a=u+n[4],d=2*c-d,f=2*u-f,t.add(d,f),t.add(c+n[1],u+n[2]),t.add(i,a),d=c+n[1],f=u+n[2],c=i,u=a;break;case"S":i=n[3],a=n[4],d=2*c-d,f=2*u-f,c=i,u=a,t.add(n[1],n[2]),t.add(d,f),t.add(i,a),d=n[1],f=n[2];break;case"q":i=c+n[3],a=u+n[4],d=c+n[1],f=u+n[2],c=i,u=a,t.add(d,f),t.add(i,a);break;case"Q":i=n[3],a=n[4],c=i,u=a,d=n[1],f=n[2],t.add(d,f),t.add(i,a);break;case"t":i=c+n[1],a=u+n[2],null===l[0].match(/[QqTt]/)?(d=c,f=u):"t"===l[0]?(d=2*c-o,f=2*u-s):"q"===l[0]&&(d=2*c-d,f=2*u-f),o=d,s=f,c=i,u=a,d=c+n[1],f=u+n[2],t.add(d,f),t.add(i,a);break;case"T":i=n[1],a=n[2],d=2*c-d,f=2*u-f,c=i,u=a,t.add(d,f),t.add(i,a);break;case"a":r(c,u,[n[1],n[2],n[3],n[4],n[5],n[6]+c,n[7]+u],t),c+=n[6],u+=n[7];break;case"A":r(c,u,[n[1],n[2],n[3],n[4],n[5],n[6],n[7]],t),c=n[6],u=n[7];break;case"z":case"Z":}l=n}return t}function l(t){var n,r=t[0];return n="horizontal"===r.orient?e.svg.area().y(function(e){return e.y}).x0(function(e){return e.x}).x1(function(e){return e.x+e.width}):e.svg.area().x(function(e){return e.x}).y1(function(e){return e.y}).y0(function(e){return e.y+e.height}),r.interpolate&&n.interpolate(r.interpolate),null!=r.tension&&n.tension(r.tension),n(t)}function c(t){var n=t[0],r=e.svg.line().x(function(e){return e.x}).y(function(e){return e.y});return n.interpolate&&r.interpolate(n.interpolate),null!=n.tension&&r.tension(n.tension),r(t)}var u,d={m:2,l:2,h:1,v:1,c:6,s:4,q:4,t:2,a:7},f=[/([MLHVCSQTAZmlhvcsqtaz])/g,/###/,/(\d)-/g,/\s|,|###/],p={},h={},g=Array.prototype.join;return{parse:t,render:o,bounds:s,area:l,line:c}}(),C.canvas.marks=function(){function e(e,t){var n=t.x||0,r=t.y||0,i=t.innerRadius||0,a=t.outerRadius||0,o=(t.startAngle||0)-Math.PI/2,s=(t.endAngle||0)-Math.PI/2;e.beginPath(),0===i?e.moveTo(n,r):e.arc(n,r,i,o,s,0),e.arc(n,r,a,s,o,1),e.closePath()}function t(e,t){var n=t[0],r=n.mark,i=r.pathCache||(r.pathCache=_(C.canvas.path.area(t)));O(e,i)}function n(e,t){var n=t[0],r=n.mark,i=r.pathCache||(r.pathCache=_(C.canvas.path.line(t)));O(e,i)}function r(e,t){if(null!=t.path){var n=t.pathCache||(t.pathCache=_(t.path));return O(e,n,t.x,t.y)}}function i(e,t){e.beginPath();var n,r,i,a,o=null!=t.size?t.size:100,s=t.x,l=t.y;if(null==t.shape||"circle"===t.shape)return n=Math.sqrt(o/Math.PI),e.arc(s,l,n,0,2*Math.PI,0),void e.closePath();switch(t.shape){case"cross":n=Math.sqrt(o/5)/2,r=3*n,e.moveTo(s-r,l-n),e.lineTo(s-n,l-n),e.lineTo(s-n,l-r),e.lineTo(s+n,l-r),e.lineTo(s+n,l-n),e.lineTo(s+r,l-n),e.lineTo(s+r,l+n),e.lineTo(s+n,l+n),e.lineTo(s+n,l+r),e.lineTo(s-n,l+r),e.lineTo(s-n,l+n),e.lineTo(s-r,l+n);break;case"diamond":a=Math.sqrt(o/(2*T)),i=a*T,e.moveTo(s,l-a),e.lineTo(s+i,l),e.lineTo(s,l+a),e.lineTo(s-i,l);break;case"square":r=Math.sqrt(o),n=r/2,e.rect(s-n,l-n,r,r);break;case"triangle-down":i=Math.sqrt(o/E),a=i*E/2,e.moveTo(s,l+a),e.lineTo(s+i,l-a),e.lineTo(s-i,l-a);break;case"triangle-up":i=Math.sqrt(o/E),a=i*E/2,e.moveTo(s,l-a),e.lineTo(s+i,l+a),e.lineTo(s-i,l+a)}e.closePath()}function a(e,t){var r=t[0],i=r.strokeWidth,a=r.strokeCap;e.lineWidth=null!=i?i:C.config.render.lineWidth,e.lineCap=null!=a?a:C.config.render.lineCap,n(e,t)}function o(e,t){var n=t.x||0,r=t.y||0,i=null!=t.x2?t.x2:n,a=null!=t.y2?t.y2:r,o=t.strokeWidth,s=t.strokeCap;e.lineWidth=null!=o?o:C.config.render.lineWidth,e.lineCap=null!=s?s:C.config.render.lineCap,e.beginPath(),e.moveTo(n,r),e.lineTo(i,a)}function s(e,t,n,r){var i,a,o,s=n.fill,l=n.stroke;e(t,r),i=null==n.opacity?1:n.opacity,0!=i&&(s||l)&&(s&&(t.globalAlpha=i*(null==n.fillOpacity?1:n.fillOpacity),t.fillStyle=m(t,n,s),t.fill()),l&&(o=null!=(o=n.strokeWidth)?o:C.config.render.lineWidth,o>0&&(t.globalAlpha=i*(null==n.strokeOpacity?1:n.strokeOpacity),t.strokeStyle=m(t,n,l),t.lineWidth=o,t.lineCap=null!=(a=n.strokeCap)?a:C.config.render.lineCap,t.vgLineDash(n.strokeDash||null),t.vgLineDashOffset(n.strokeDashOffset||0),t.stroke())))}function l(e,t,n,r){var i,a,o;for(i=0,a=n.items.length;a>i;++i)o=n.items[i],(!r||r.intersects(o.bounds))&&s(e,t,o,o)}function c(e,t,n){if(t.items.length)for(var r,i,a,o,s,l,c,u,d,f,p=t.items,h=0,g=p.length;g>h;++h)r=p[h],(!n||n.intersects(r.bounds))&&(c=r.x||0,u=r.y||0,d=r.width||0,f=r.height||0,o=null==r.opacity?1:r.opacity,0!=o&&((i=r.fill)&&(e.globalAlpha=o*(null==r.fillOpacity?1:r.fillOpacity),e.fillStyle=m(e,r,i),e.fillRect(c,u,d,f)),(a=r.stroke)&&(l=null!=(l=r.strokeWidth)?l:C.config.render.lineWidth,l>0&&(e.globalAlpha=o*(null==r.strokeOpacity?1:r.strokeOpacity),e.strokeStyle=m(e,r,a),e.lineWidth=l,e.lineCap=null!=(s=r.strokeCap)?s:C.config.render.lineCap,e.vgLineDash(r.strokeDash||null),e.vgLineDashOffset(r.strokeDashOffset||0),e.strokeRect(c,u,d,f)))))}function u(e,t,n){if(t.items.length)for(var r,i,a,o,s,l,c,u,d,f=t.items,p=0,h=f.length;h>p;++p)r=f[p],(!n||n.intersects(r.bounds))&&(l=r.x||0,c=r.y||0,u=null!=r.x2?r.x2:l,d=null!=r.y2?r.y2:c,a=null==r.opacity?1:r.opacity,0!=a&&(i=r.stroke)&&(s=null!=(s=r.strokeWidth)?s:C.config.render.lineWidth,s>0&&(e.globalAlpha=a*(null==r.strokeOpacity?1:r.strokeOpacity),e.strokeStyle=m(e,r,i),e.lineWidth=s,e.lineCap=null!=(o=r.strokeCap)?o:C.config.render.lineCap,e.vgLineDash(r.strokeDash||null),e.vgLineDashOffset(r.strokeDashOffset||0),e.beginPath(),e.moveTo(l,c),e.lineTo(u,d),e.stroke())))
}function d(e,t,n){if(t.items.length)for(var r,i=this,a=t.items,o=0,s=a.length;s>o;++o)if(r=a[o],!n||n.intersects(r.bounds)){r.image&&r.image.url===r.url||(r.image=i.loadImage(r.url),r.image.url=r.url);var l,c,u,d,f;u=r.width||r.image&&r.image.width||0,d=r.height||r.image&&r.image.height||0,l=(r.x||0)-("center"===r.align?u/2:"right"===r.align?u:0),c=(r.y||0)-("middle"===r.baseline?d/2:"bottom"===r.baseline?d:0),r.image.loaded&&(e.globalAlpha=null!=(f=r.opacity)?f:1,e.drawImage(r.image,l,c,u,d))}}function f(e,t,n){if(t.items.length)for(var r,i,a,o,s,l,c,u,d,f=t.items,p=0,h=f.length;h>p;++p)r=f[p],(!n||n.intersects(r.bounds))&&(e.font=C.scene.fontString(r),e.textAlign=r.align||"left",e.textBaseline=r.baseline||"alphabetic",o=null==r.opacity?1:r.opacity,0!=o&&(l=r.x||0,c=r.y||0,(u=r.radius)&&(d=(r.theta||0)-Math.PI/2,l+=u*Math.cos(d),c+=u*Math.sin(d)),r.angle?(e.save(),e.translate(l,c),e.rotate(r.angle*Math.PI/180),l=r.dx||0,c=r.dy||0):(l+=r.dx||0,c+=r.dy||0),(i=r.fill)&&(e.globalAlpha=o*(null==r.fillOpacity?1:r.fillOpacity),e.fillStyle=m(e,r,i),e.fillText(r.text,l,c)),(a=r.stroke)&&(s=null!=(s=r.strokeWidth)?s:1,s>0&&(e.globalAlpha=o*(null==r.strokeOpacity?1:r.strokeOpacity),e.strokeStyle=m(r,a),e.lineWidth=s,e.strokeText(r.text,l,c))),r.angle&&e.restore()))}function p(e){return function(t,n,r){l(e,t,n,r)}}function h(e){return function(t,n,r){n.items.length&&(!r||r.intersects(n.items[0].bounds))&&s(e,t,n.items[0],n.items)}}function g(e,t,n){if(t.items.length){var r,i,a,o,s,l,u,d,f,p=t.items,h=this;for(c(e,t,n),l=0,u=p.length;u>l;++l){for(r=p[l],i=r.axisItems||[],a=r.legendItems||[],o=r.x||0,s=r.y||0,e.save(),e.translate(o,s),r.clip&&(e.beginPath(),e.rect(0,0,r.width||0,r.height||0),e.clip()),n&&n.translate(-o,-s),d=0,f=i.length;f>d;++d)"back"===i[d].def.layer&&h.draw(e,i[d],n);for(d=0,f=r.items.length;f>d;++d)h.draw(e,r.items[d],n);for(d=0,f=i.length;f>d;++d)"back"!==i[d].def.layer&&h.draw(e,i[d],n);for(d=0,f=a.length;f>d;++d)h.draw(e,a[d],n);n&&n.translate(o,s),e.restore()}}}function m(e,t,n){return n.id?v(e,n,t.bounds):n}function v(e,t,n){var r,i,a=n.width(),o=n.height(),s=n.x1+t.x1*a,l=n.y1+t.y1*o,c=n.x1+t.x2*a,u=n.y1+t.y2*o,d=e.createLinearGradient(s,l,c,u),f=t.stops;for(r=0,i=f.length;i>r;++r)d.addColorStop(f[r].offset,f[r].color);return d}function y(e,t,n,r,i,a){if(0===t.items.length||t.bounds&&!t.bounds.contains(i,a))return!1;var o,s,l,c,u,d,f,p=t.items,h=this;for(d=p.length;--d>=0;){for(s=p[d],c=s.x||0,u=s.y||0,e.save(),e.translate(c,u),f=s.items.length;--f>=0;)if(o=s.items[f],o.interactive!==!1&&(l=h.pick(o,n,r,i-c,a-u)))return e.restore(),l;e.restore()}return t.interactive?b(L.group,e,t,n,r,i,a):!1}function b(e,t,n,r,i,a,o){if(!n.items.length)return!1;var s,l,c;for(1!==t._ratio&&(r*=t._ratio,i*=t._ratio),c=n.items.length;--c>=0;)if(s=n.items[c],l=s.bounds,(!l||l.contains(a,o))&&l&&e(t,s,r,i,a,o))return s;return!1}function x(e,t,n,r,i,a){if(!t.items.length)return!1;var o,s=t.items;return o=s[0].bounds,o&&!o.contains(i,a)?!1:(1!==e._ratio&&(n*=e._ratio,r*=e._ratio),L.area(e,s,n,r)?s[0]:!1)}function k(e,t,n,r,i,a){if(!t.items.length)return!1;var o,s=t.items;return o=s[0].bounds,o&&!o.contains(i,a)?!1:(1!==e._ratio&&(n*=e._ratio,r*=e._ratio),L.line(e,s,n,r)?s[0]:!1)}function w(e){return function(t,n,r,i,a,o){return b(e,t,n,r,i,a,o)}}function S(e,t,n,r,i,a){if(!t.fontSize)return!1;if(!t.angle)return!0;var o=C.scene.bounds.text(t,A,!0),s=-t.angle*Math.PI/180,l=Math.cos(s),c=Math.sin(s),n=t.x,r=t.y,u=l*i-c*a+(n-n*l+r*c),d=c*i+l*a+(r-n*c-r*l);return o.contains(u,d)}var _=C.canvas.path.parse,O=C.canvas.path.render,E=(Math.PI/2,Math.sqrt(3)),T=Math.tan(30*Math.PI/180),A=new C.Bounds,L={text:S,rect:function(){return!0},image:function(){return!0},group:function(e,t){return t.fill||t.stroke},rule:function(e,t,n,r){return e.isPointInStroke?(o(e,t),e.isPointInStroke(n,r)):!1},line:function(e,t,n,r){return e.isPointInStroke?(a(e,t),e.isPointInStroke(n,r)):!1},arc:function(t,n,r,i){return e(t,n),t.isPointInPath(r,i)},area:function(e,n,r,i){return t(e,n),e.isPointInPath(r,i)},path:function(e,t,n,i){return r(e,t),e.isPointInPath(n,i)},symbol:function(e,t,n,r){return i(e,t),e.isPointInPath(n,r)}};return{draw:{group:g,area:h(t),line:h(n),arc:p(e),path:p(r),symbol:p(i),rect:c,rule:u,text:f,image:d,drawOne:h,drawAll:p},pick:{group:y,area:x,line:k,arc:w(L.arc),path:w(L.path),symbol:w(L.symbol),rect:w(L.rect),rule:w(L.rule),text:w(L.text),image:w(L.image),pickAll:b}}}(),C.canvas.Renderer=function(){function t(e,t){var n=window.devicePixelRatio||1,r=t.webkitBackingStorePixelRatio||t.mozBackingStorePixelRatio||t.msBackingStorePixelRatio||t.oBackingStorePixelRatio||t.backingStorePixelRatio||1,i=n/r;if(n!==r){var a=e.width,o=e.height;e.setAttribute("width",a*i),e.setAttribute("height",o*i),e.style.width=a+"px",e.style.height=o+"px"}return i}function n(e){if(!e.vgLineDash){var t=[];e.setLineDash?(e.vgLineDash=function(e){this.setLineDash(e||t)},e.vgLineDashOffset=function(e){this.lineDashOffset=e}):void 0!==e.webkitLineDash?(e.vgLineDash=function(e){this.webkitLineDash=e||t},e.vgLineDashOffset=function(e){this.webkitLineDashOffset=e}):void 0!==e.mozDash?(e.vgLineDash=function(e){this.mozDash=e},e.vgLineDashOffset=function(){}):(e.vgLineDash=function(){},e.vgLineDashOffset=function(){})}}function r(e,t){for(var n=new C.Bounds(t);null!=(e=e.mark.group);)n.translate(e.x||0,e.y||0);return n}function i(e){return e?C.array(e).reduce(function(e,t){return e.union(r(t,t.bounds)).union(r(t,t["bounds:prev"]))},new C.Bounds):null}function a(e,t){var n=null;return t&&(n=new C.Bounds(t).round(),e.beginPath(),e.rect(n.x1,n.y1,n.width(),n.height()),e.clip()),n}var o=function(){this._ctx=null,this._el=null,this._bgcolor=null,this._imgload=0},s=o.prototype;return s.initialize=function(t,n,r,i,a){if(this._el=t,this.background(a),!t)return this;var o=e.select(t).selectAll("canvas.marks").data([1]);return o.enter().append("canvas").attr("class","marks"),o.exit().remove(),this.resize(n,r,i)},s.background=function(e){return this._bgcolor=e,this},s.resize=function(r,i,a){if(this._width=r,this._height=i,this._padding=a,this._el){var o=e.select(this._el).select("canvas.marks");o.attr("width",r+a.left+a.right).attr("height",i+a.top+a.bottom);var s;this._ctx=o.node().getContext("2d"),this._ctx._ratio=s=t(o.node(),this._ctx)||1,this._ctx.setTransform(s,0,0,s,s*a.left,s*a.top)}return n(this._ctx),this},s.context=function(e){return e?(this._ctx=e,this):this._ctx},s.element=function(){return this._el},s.pendingImages=function(){return this._imgload},s.render=function(e,t){var n,r=this._ctx,o=this._padding,s=this._width+o.left+o.right,l=this._height+o.top+o.bottom,c=null;this._scene=e,r.save(),c=a(r,i(t)),this.clear(-o.left,-o.top,s,l),this.draw(r,e,c),t&&(r.restore(),r.save(),n=a(r,i(t)),c.encloses(n)||(this.clear(-o.left,-o.top,s,l),this.draw(r,e,n))),r.restore(),this._scene=null},s.draw=function(e,t,n){var r=t.marktype,i=C.canvas.marks.draw[r];i.call(this,e,t,n)},s.clear=function(e,t,n,r){var i=this._ctx;i.clearRect(e,t,n,r),null!=this._bgcolor&&(i.fillStyle=this._bgcolor,i.fillRect(e,t,n,r))},s.renderAsync=function(e){var t=this;t._async_id&&clearTimeout(t._async_id),t._async_id=setTimeout(function(){t.render(e),delete t._async_id},50)},s.loadImage=function(e){var t,n=this,r=n._scene,i=null;if(C.config.isNode)n._imgload+=1,i=new(require("canvas").Image),C.data.load(e,function(t,r){return n._imgload-=1,t?void C.error(t):(C.log("LOAD IMAGE: "+e),i.src=r,void(i.loaded=!0))});else{if(i=new Image,t=C.data.load.sanitizeUrl(e),!t)return;n._imgload+=1,i.onload=function(){C.log("LOAD IMAGE: "+t),i.loaded=!0,n._imgload-=1,n.renderAsync(r)},i.src=t}return i},o}(),C.canvas.Handler=function(){function t(e){var t=e.indexOf(".");return 0>t?e:e.slice(0,t)}var n=function(e,t){this._active=null,this._down=null,this._handlers={},e&&this.initialize(e),t&&this.model(t)},r=n.prototype;r.initialize=function(t,n,a){this._el=e.select(t).node(),this._canvas=e.select(t).select("canvas.marks").node(),this._padding=n,this._obj=a||null;var o=this._canvas,s=this;return i.forEach(function(e){o.addEventListener(e,function(t){r[e].call(s,t)})}),this},r.padding=function(e){return this._padding=e,this},r.model=function(e){return arguments.length?(this._model=e,this):this._model},r.handlers=function(){var e=this._handlers;return C.keys(e).reduce(function(t,n){return e[n].reduce(function(e,t){return e.push(t),e},t)},[])};var i=["mouseup","dblclick","wheel","keydown","keypress","keyup","mousewheel"];return i.forEach(function(e){r[e]=function(t){this.fire(e,t)}}),i.push("mousedown"),i.push("mousemove"),i.push("mouseout"),i.push("click"),r.mousemove=function(e){var t=this._padding,n=e.target.getBoundingClientRect(),r=e.clientX-n.left,i=e.clientY-n.top,a=this._active,o=this.pick(this._model.scene(),r,i,r-t.left,i-t.top);return o===a?void this.fire("mousemove",e):(a&&this.fire("mouseout",e),this._active=o,void(o&&this.fire("mouseover",e)))},r.mouseout=function(e){this._active&&this.fire("mouseout",e),this._active=null},r.mousedown=function(e){this._down=this._active,this.fire("mousedown",e)},r.click=function(e){this._down===this._active&&(this.fire("click",e),this._down=null)},r.DOMMouseScroll=function(e){this.fire("mousewheel",e)},r.fire=function(e,t){var n=this._active,r=this._handlers[e];if(n&&r)for(var i=0,a=r.length;a>i;++i)r[i].handler.call(this._obj,t,n)},r.on=function(e,n){var r=t(e),i=this._handlers;return i=i[r]||(i[r]=[]),i.push({type:e,handler:n}),this},r.off=function(e,n){var r=t(e),i=this._handlers[r];if(i){for(var a=i.length;--a>=0;)i[a].type===e&&(n&&i[a].handler!==n||i.splice(a,1));return this}},r.context=function(){return this._canvas.getContext("2d")},r.pick=function(e,t,n,r,i){var a=this.context(),o=e.marktype,s=C.canvas.marks.pick[o];return s.call(this,a,e,t,n,r,i)},n}(),C.svg={},C.svg.marks=function(){function t(e){return e.x||0}function n(e){return e.y||0}function r(e){return e.x+e.width||0}function i(e){return e.y+e.height||0}function a(e){return null==e.size?100:e.size}function o(e){return e.shape||"circle"}function s(e){var t,n,r,i,a,o=e.mark?e:e.length?e[0]:null;if(null!==o)for(t=0,n=I.length;n>t;++t)r=I[t],i=P[r],a=o[r],null==a?"fill"===i?this.style.setProperty(i,"none",null):this.style.removeProperty(i):(a.id&&(C.svg._cur._defs.gradient[a.id]=a,a="url("+window.location.href+"#"+a.id+")"),this.style.setProperty(i,a+"",null))}function l(e){var t=e.x||0,n=e.y||0;this.setAttribute("transform","translate("+t+","+n+")"),this.setAttribute("d",_(e))}function c(e){if(e.length){var t=e[0],n="horizontal"===t.orient?E:O;n.interpolate(t.interpolate||"linear").tension(null==t.tension?.7:t.tension),this.setAttribute("d",n(e))}}function u(e){if(e.length){var t=e[0];T.interpolate(t.interpolate||"linear").tension(null==t.tension?.7:t.tension),this.setAttribute("d",T(e))}}function d(e){var t=e.x||0,n=e.y||0;this.setAttribute("transform","translate("+t+","+n+")"),null!=e.path&&this.setAttribute("d",e.path)}function f(e){this.setAttribute("x",e.x||0),this.setAttribute("y",e.y||0),this.setAttribute("width",e.width||0),this.setAttribute("height",e.height||0)}function p(e){var t=e.x||0,n=e.y||0;this.setAttribute("x1",t),this.setAttribute("y1",n),this.setAttribute("x2",null!=e.x2?e.x2:t),this.setAttribute("y2",null!=e.y2?e.y2:n)}function h(e){var t=e.x||0,n=e.y||0;this.setAttribute("transform","translate("+t+","+n+")"),this.setAttribute("d",A(e))}function g(e){var t=e.width||e.image&&e.image.width||0,n=e.height||e.image&&e.image.height||0,r=e.x-("center"===e.align?t/2:"right"===e.align?t:0),i=e.y-("middle"===e.baseline?n/2:"bottom"===e.baseline?n:0),a=C.data.load.sanitizeUrl(e.url);a&&this.setAttributeNS("http://www.w3.org/1999/xlink","href",a),this.setAttribute("x",r),this.setAttribute("y",i),this.setAttribute("width",t),this.setAttribute("height",n)}function m(e){var t=(e.fontStyle?e.fontStyle+" ":"")+(e.fontVariant?e.fontVariant+" ":"")+(e.fontWeight?e.fontWeight+" ":"")+(null!=e.fontSize?e.fontSize:C.config.render.fontSize)+"px "+(e.font||C.config.render.font);return t}function v(e){var t=e.x||0,n=e.y||0,r=e.dx||0,i=e.dy||0,a=e.angle||0,o=e.radius||0,s=N[e.align||"left"],l="top"===e.baseline?".9em":"middle"===e.baseline?".35em":0;if(o){var c=(e.theta||0)-Math.PI/2;t+=o*Math.cos(c),n+=o*Math.sin(c)}this.setAttribute("x",t+r),this.setAttribute("y",n+i),this.setAttribute("text-anchor",s),a?this.setAttribute("transform","rotate("+a+" "+t+","+n+")"):this.removeAttribute("transform"),l?this.setAttribute("dy",l):this.removeAttribute("dy"),this.textContent=e.text,this.style.setProperty("font",m(e),null)}function y(e){var t=e.x||0,n=e.y||0;if(this.setAttribute("transform","translate("+t+","+n+")"),e.clip){var r={width:e.width||0,height:e.height||0},i=e.clip_id||(e.clip_id="clip"+M++);C.svg._cur._defs.clipping[i]=r,this.setAttribute("clip-path","url(#"+i+")")}}function b(e){var t=e.width||0,n=e.height||0;this.setAttribute("width",t),this.setAttribute("height",n)}function x(e){var t="type-"+e.type;return e.name&&(t+=" "+e.name),t}function k(e,t,n){return function(r,i,a){w(r,i,a,e,t,n)}}function w(t,n,r,i,a,o){var l=o?[n.items]:n.items,c=n.interactive===!1?"none":null,u=t.node().childNodes,d="g"!==i,f=(f=u[r+1])?e.select(f):t.append("g").attr("id","g"+ ++L).attr("class",x(n.def)),p=f.attr("id"),h="#"+p+" > "+i,g=f.selectAll(h).data(l),m=g.enter().append(i);return d?(f.style("pointer-events",c),m.each(function(e){e.mark?e._svg=this:e.length&&(e[0]._svg=this)})):m.append("rect").attr("class","background").style("pointer-events",c),g.exit().remove(),g.each(a),d?g.each(s):f.selectAll(h+" > rect.background").each(b).each(s),f}function S(t,n,r){var i,a,o,s=w(t,n,r,"g",y),l=s.node().childNodes,c=l.length;for(i=0;c>i;++i){var u=l[i].__data__.items,d=l[i].__data__.legendItems||[],f=l[i].__data__.axisItems||[],p=e.select(l[i]),h=0;for(a=0,o=f.length;o>a;++a)"back"===f[a].def.layer&&S.call(this,p,f[a],h++);for(a=0,o=u.length;o>a;++a)this.draw(p,u[a],h++);for(a=0,o=f.length;o>a;++a)"back"!==f[a].def.layer&&S.call(this,p,f[a],h++);for(a=0,o=d.length;o>a;++a)S.call(this,p,d[a],h++)}}var _=e.svg.arc(),O=e.svg.area().x(t).y1(n).y0(i),E=e.svg.area().y(n).x0(r).x1(t),T=e.svg.line().x(t).y(n),A=e.svg.symbol().type(o).size(a),L=0,M=0,N={left:"start",center:"middle",right:"end"},P={fill:"fill",fillOpacity:"fill-opacity",stroke:"stroke",strokeWidth:"stroke-width",strokeOpacity:"stroke-opacity",strokeCap:"stroke-linecap",strokeDash:"stroke-dasharray",strokeDashOffset:"stroke-dashoffset",opacity:"opacity"},I=C.keys(P);return{update:{group:f,area:c,line:u,arc:l,path:d,symbol:h,rect:f,rule:p,text:v,image:g},nested:{area:!0,line:!0},style:s,draw:{group:S,area:k("path",c,!0),line:k("path",u,!0),arc:k("path",l),path:k("path",d),symbol:k("path",h),rect:k("rect",f),rule:k("line",p),text:k("text",v),image:k("image",g),draw:k}}}(),C.svg.Renderer=function(){var t=function(){this._svg=null,this._ctx=null,this._el=null,this._defs={gradient:{},clipping:{}}},n=t.prototype;return n.initialize=function(t,n,r,i,a){return this._el=t,e.select(t).select("svg.marks").remove(),this._svg=e.select(t).append("svg").attr("class","marks"),null!=a&&this._svg.style("background-color",a),this._ctx=this._svg.append("g"),this.resize(n,r,i)},n.resize=function(e,t,n){return this._width=e,this._height=t,this._padding=n,this._svg.attr("width",e+n.left+n.right).attr("height",t+n.top+n.bottom),this._ctx.attr("transform","translate("+n.left+","+n.top+")"),this},n.context=function(){return this._ctx},n.element=function(){return this._el},n.updateDefs=function(){var t,n,r=this._svg,i=this._defs,a=C.keys(i.gradient),o=C.keys(i.clipping),s=r.select("defs");return 0===a.length&&0==o.length?void s.remove():(s.empty()&&(s=r.insert("defs",":first-child")),t=s.selectAll("linearGradient").data(a,C.identity),t.enter().append("linearGradient").attr("id",C.identity),t.exit().remove(),t.each(function(t){var n=i.gradient[t],r=e.select(this);r.attr({x1:n.x1,x2:n.x2,y1:n.y1,y2:n.y2}),stop=r.selectAll("stop").data(n.stops),stop.enter().append("stop"),stop.exit().remove(),stop.attr("offset",function(e){return e.offset}).attr("stop-color",function(e){return e.color})}),n=s.selectAll("clipPath").data(o,C.identity),n.enter().append("clipPath").attr("id",C.identity),n.exit().remove(),void n.each(function(t){var n=i.clipping[t],r=e.select(this).selectAll("rect").data([1]);r.enter().append("rect"),r.attr("x",0).attr("y",0).attr("width",n.width).attr("height",n.height)}))},n.render=function(e,t){C.svg._cur=this,t?this.renderItems(C.array(t)):this.draw(this._ctx,e,-1),this.updateDefs(),delete C.svg._cur},n.renderItems=function(e){var t,n,r,i,a,o=C.svg.marks;for(i=0,a=e.length;a>i;++i)t=e[i],n=t._svg,r=t.mark.marktype,t=o.nested[r]?t.mark.items:t,o.update[r].call(n,t),o.style.call(n,t)},n.draw=function(e,t,n){var r=t.marktype,i=C.svg.marks.draw[r];i.call(this,e,t,n)},t}(),C.svg.Handler=function(){function t(e){var t=this;return function(n){var r=n.target,i=r.__data__;i&&(i=i.mark?i:i[0],e.call(t._obj,n,i))}}function n(e){var t=e.indexOf(".");return 0>t?e:e.slice(0,t)}var r=function(e,t){this._active=null,this._handlers={},e&&this.initialize(e),t&&this.model(t)},i=r.prototype;return i.initialize=function(t,n,r){return this._el=e.select(t).node(),this._svg=e.select(t).select("svg.marks").node(),this._padding=n,this._obj=r||null,this},i.padding=function(e){return this._padding=e,this},i.model=function(e){return arguments.length?(this._model=e,this):this._model},i.handlers=function(){var e=this._handlers;return C.keys(e).reduce(function(t,n){return e[n].reduce(function(e,t){return e.push(t),e},t)},[])},i.on=function(r,i){var a=n(r),o=this._handlers,s=e.select(this._svg).node(),l={type:r,handler:i,svg:t.call(this,i)};return o=o[a]||(o[a]=[]),o.push(l),s.addEventListener(a,l.svg),this},i.off=function(t,r){var i=n(t),a=this._handlers[i],o=e.select(this._svg).node();if(a){for(var s=a.length;--s>=0;)a[s].type===t&&(r&&a[s].handler!==r||(o.removeEventListener(i,a[s].svg),a.splice(s,1)));return this}},r}(),C.data={},C.data.ingestAll=function(e){return C.isTree(e)?l(C.data.ingestTree(e[0],e.children)):e.map(C.data.ingest)},C.data.ingest=function(e,t){return{data:e,index:t}},C.data.ingestTree=function(e,t,n){var r,i,a=C.data.ingest(e,n||0),o=e[t];if(o&&(r=o.length))for(a.values=Array(r),i=0;r>i;++i)a.values[i]=C.data.ingestTree(o[i],t,i);return a},C.data.mapper=function(e){return function(t){return t.forEach(e),t}},C.data.size=function(e,t){return e=C.isArray(e)?e:[0,e],e=e.map(function(e){return"string"==typeof e?t[e]:e})},C.data.load=function(){function t(e){if(C.config.baseURL&&!o.test(e)&&(C.startsWith(e,"/")||"/"===C.config.baseURL[C.config.baseURL.length-1]||(e="/"+e),e=C.config.baseURL+e),C.config.isNode&&C.startsWith(e,"//")&&(e=C.config.defaultProtocol+e),C.config.domainWhiteList){var t,n;if(C.config.isNode){var r=require("url").parse(e);if(C.config.safeMode&&"http:"!==r.protocol&&"https:"!==r.protocol)return!1;t=r.hostname,n=null}else{var i=document.createElement("a");i.href=e,""==i.host&&(i.href=i.href),t=i.hostname.toLowerCase(),n=window.location.hostname}if(n!==t){var a=C.config.domainWhiteList.some(function(e){var n=t.length-e.length;return e===t||n>1&&"."===t[n-1]&&t.lastIndexOf(e)===n});a||(C.error("URL is not whitelisted: "+e),e=!1)}}return e}function n(e,t){var n=C.data.load.sanitizeUrl(e);n?C.config.isNode?C.startsWith(n,s)?i(n.slice(s.length),t):a(n,t):r(n,t):t("Bad URL",null)}function r(t,n){C.log("LOAD XHR: "+t),e.xhr(t,function(e,t){t&&(t=t.responseText),n(e,t)})}function i(e,t){C.log("LOAD FILE: "+e),require("fs").readFile(e,t)}function a(e,t){C.log("LOAD HTTP: "+e);require("request")(e,function(e,n,r){e||200!==n.statusCode?t(e,null):t(null,r)})}var o=/^([A-Za-z]+:)?\/\//,s="file://";return n.sanitizeUrl=t,n}(),C.data.read=function(){function n(e,t){var n=t&&t.type||"json";return e=a[n](e,t),t&&t.parse&&r(e,t.parse),e}function r(e,t){var n=C.keys(t),r=n.map(function(e){return o[t[e]]}),a=C.isTree(e);i(a?[e]:e,n,r,a)}function i(e,t,n,i){var a,o,s,l,c;for(o=0,l=e.length;l>o;++o){for(a=e[o],s=0,c=t.length;c>s;++s)a[t[s]]=n[s](a[t[s]]);i&&a.values&&r(a,t,n,!0)}}var a={},o={number:C.number,"boolean":C.boolean,date:C.date};return a.json=function(e,t){var n=C.isObject(e)?e:JSON.parse(e);return t&&t.property&&(n=C.accessor(t.property)(n)),n},a.csv=function(t){var n=e.csv.parse(t);return n},a.tsv=function(t){var n=e.tsv.parse(t);return n},a.topojson=function(e,n){if(null==t)return C.error("TopoJSON library not loaded."),[];var r=C.isObject(e)?e:JSON.parse(e),i=[];return n&&n.feature?i=(i=r.objects[n.feature])?t.feature(r,i).features:(C.error("Invalid TopoJSON object: "+n.feature),[]):n&&n.mesh?i=(i=r.objects[n.mesh])?[t.mesh(r,r.objects[n.mesh])]:(C.error("Invalid TopoJSON object: "+n.mesh),[]):C.error("Missing TopoJSON feature or mesh parameter."),i},a.treejson=function(e,t){return e=C.isObject(e)?e:JSON.parse(e),C.tree(e,t.children)},n.formats=a,n.parse=r,n}(),C.data.aggregate=function(){function e(e){this.field=e,this.ops=[],this.flags=0,this.count=0}var t=1,n=2,r=4,a=8,o=16,s=32;return e.prototype.clone=function(){var t,n,r=new e(this.field);for(t in this)n=this[t],r[t]=C.isArray(n)?n.slice():n;return r},e.prototype.init=function(e){"sum"===e?(this.flags|=t,this.sum=0):"avg"===e?(this.flags|=n,this.avg=0):"var"===e||"std"===e?(this.flags|=r|n,this.avg=0,this.dev=0):"min"===e?(this.flags|=a,this.min=+1/0):"max"===e?(this.flags|=o,this.max=-1/0):"median"===e&&(this.flags|=s,this.vals=[]),this.ops.push(e)},e.prototype.update=function(e){var i,l=this,c=l.flags;l.count+=1,c&t&&(l.sum+=e),c&n&&(i=e-l.avg,l.avg+=i/l.count),c&r&&(l.dev+=i*(e-l.avg)),c&a&&(l.min=e<l.min?e:l.min),c&o&&(l.max=e>l.max?e:l.max),c&s&&l.vals.push(e)},e.prototype.value=function(e){switch(e){case"sum":return this.sum;case"avg":return this.avg;case"var":return this.dev/(this.count-1);case"std":return Math.sqrt(this.dev/(this.count-1));case"min":return this.min;case"max":return this.max;case"median":var t=this.vals,n=t.length,r=~~(n/2);return n?n%2?t[r]:.5*(t[r-1]+t[r]):0}},e.prototype.done=function(e){this.vals&&this.vals.sort(C.numcmp);for(var t=this.ops,n=0;n<t.length;++n)"count"===t[n]?e.count=this.count:e[t[n]+"_"+this.field]=this.value(t[n]);return e},function(){function t(e){var t=o.reduce(function(t,n){return t.push(n(e)),t},[]).join("|");return c[t]||(c[t]=n(e))}function n(e){var t=a.map(function(e){return e.clone()});for(t.data={},i=0;i<l.length;++i)t.data[l[i]]=o[i](e);return t}function r(e){var n,r,i,a,o;for(r=0;r<e.length;++r)for(a=e[r],o=t(a),i=0;i<o.length;++i)o[i].update(s[i](a));var l=[],u=0;for(n in c){for(o=c[n],r=0;r<o.length;++r)o[r].done(o.data);l.push({index:u++,data:o.data})}return c={},l}var a,o,s,l=[],c={};return r.fields=function(t){var n={};return s=[],a=C.array(t).reduce(function(t,r){var i,a=r.field;return n[a]||(s.push(C.accessor(a)),i=0===a.indexOf("data.")?a.slice(5):a,t.push(n[a]=new e(i))),n[a].init(r.op),t},[]),r},r.groupby=function(e){return l=C.array(e),o=l.map(function(e,t){return 0===e.indexOf("data.")&&(l[t]=e.slice(5)),C.accessor(e)}),r},r}}(),C.data.array=function(){function e(e){return e.map(function(e){for(var n=[],r=0,i=t.length;i>r;++r)n.push(t[r](e));return n})}var t=[];return e.fields=function(n){return t=C.array(n).map(C.accessor),e},e},C.data.bin=function(){function e(e){var t={min:null!=i?i:+1/0,max:null!=a?a:-1/0,step:null!=o?o:null,maxbins:s};(null==i||null==a)&&e.forEach(function(e){var r=n(e);null==i&&r>t.max&&(t.max=r),null==a&&r<t.min&&(t.min=r)});var l=C.bins(t);return e.forEach(function(e){var t=n(e);r(e,l.start+l.step*~~((t-l.start)/l.step))}),e}var t,n,r,i=void 0,a=void 0,o=void 0,s=20,l="bin";return e.min=function(t){return i=t,e},e.max=function(t){return a=t,e},e.step=function(t){return o=t,e},e.maxbins=function(t){return s=t,e},e.field=function(r){return t=r,n=C.accessor(r),e},e.output=function(t){return l=t,r=C.mutator(t),e},e},C.data.copy=function(){var e=C.accessor("data"),t=[],n=null,r=C.data.mapper(function(r){var i,a,o=e(r),s=n||t;for(i=0,a=t.length;a>i;++i)r[s[i]]=o[t[i]];return r});return r.from=function(t){return e=C.accessor(t),r},r.fields=function(e){return t=C.array(e),r},r.as=function(e){return n=C.array(e),r},r},C.data.cross=function(){function e(e){var i,a,o,s=[],l=t||e,c=e.length;for(a=0;c>a;++a)for(o=0;c>o;++o)n&&a===o||(i={},i[r.left]=e[a],i[r.right]=l[o],s.push(i));return s}var t=null,n=!1,r={left:"a",right:"b"};return e["with"]=function(n){return t=n,e},e.diagonal=function(t){return n=!t,e},e.output=function(t){return C.keys(r).forEach(function(e){void 0!==t[e]&&(r[e]=t[e])}),e},e},C.data.facet=function(){function e(e){var r,i,a,o,s,l,c,u={key:"",keys:[],values:[]},d={},f=u.values;if(0===t.length)return f.push(r={key:"",keys:[],index:0,values:n?e.slice():e}),n&&n(r.values),u;for(s=0,o=e.length;o>s;++s){for(l=0,i=[],a="";l<t.length;++l)c=t[l](e[s]),i.push(c),a+=(l>0?"|":"")+String(c);r=d[a],void 0===r&&f.push(r=d[a]={key:a,keys:i,index:f.length,values:[]}),r.values.push(e[s])}if(n)for(s=0,o=f.length;o>s;++s)n(f[s].values);return u}var t=[],n=null;return e.keys=function(n){return t=C.array(n).map(C.accessor),e},e.sort=function(t){return n=C.data.sort().by(t),e},e},C.data.filter=function(){function e(e){return t?e.filter(t):e}var t=null;return e.test=function(n){return t=C.isFunction(n)?n:C.parse.expr(n),e},e},C.data.flatten=function(){function e(e){return t(e,[])}function t(e,n){if(e.values)for(var r=0,i=e.values.length;i>r;++r)t(e.values[r],n);else n.push(e);return n}return e},C.data.fold=function(){function e(e){var i,a,o,s,l=[],c=t.length;for(a=0,s=e.length;s>a;++a)for(i=e[a],o=0;c>o;++o){var u={index:l.length,data:i.data};u[r.key]=t[o],u[r.value]=n[o](i),l.push(u)}return l}var t=[],n=[],r={key:"key",value:"value"};return e.fields=function(r){return t=C.array(r),n=t.map(C.accessor),e},e.output=function(t){return C.keys(r).forEach(function(e){void 0!==t[e]&&(r[e]=t[e])}),e},e},C.data.force=function(){function t(e,t,i){n.size(C.data.size(l,i)).nodes(e),r&&t[r]&&n.links(t[r]),n.start();for(var a=0;s>a;++a)n.tick();return n.stop(),e}var n=e.layout.force(),r=null,i=20,a=1,o=-30,s=500,l=["width","height"],c=["friction","theta","gravity","alpha"];return t.links=function(e){return r=e,t},t.size=function(e){return l=e,t},t.linkDistance=function(e){return i="number"==typeof e?e:C.accessor(e),n.linkDistance(i),t},t.linkStrength=function(e){return a="number"==typeof e?e:C.accessor(e),n.linkStrength(a),t},t.charge=function(e){return o="number"==typeof e?e:C.accessor(e),n.charge(o),t},t.iterations=function(e){return s=e,t},c.forEach(function(e){t[e]=function(r){return n[e](r),t}}),t},C.data.force.dependencies=["links"],C.data.formula=function(){return function(){var e,t=null,n=C.identity,r=C.data.mapper(function(r,i,a){return t&&e(r,n.call(null,r,i,a)),r});return r.field=function(n){return t=n,e=C.mutator(t),r},r.expr=function(e){return n=C.isFunction(e)?e:C.parse.expr(e),r},r}}(),C.data.geo=function(){function t(){var t={},r="mercator",i=e.geo[r](),a=C.identity,o=C.identity,s={x:"x",y:"y"},l=C.data.mapper(function(e){var t=[o(e),a(e)],n=i(t);return e[s.x]=n[0],e[s.y]=n[1],e});return l.func=function(){return i},l.projection=function(n){if(r!==n){r=n,i=e.geo[r]();for(var a in t)i[a](t[a])}return l},n.forEach(function(e){l[e]=function(n){return t[e]=n,i[e](n),l}}),l.lon=function(e){return o=C.accessor(e),l},l.lat=function(e){return a=C.accessor(e),l},l.output=function(e){return C.keys(s).forEach(function(t){void 0!==e[t]&&(s[t]=e[t])}),e},l}var n=["center","scale","translate","rotate","precision","clipAngle"];return t.params=n,t}(),C.data.geopath=function(){var t=e.geo.path().projection(e.geo.mercator()),n="mercator",r=C.identity,i={},a={path:"path"},o=C.data.mapper(function(e){return e[a.path]=t(r(e)),e});return o.projection=function(r){if(n!==r){n=r;var a=e.geo[n]();for(var s in i)a[s](i[s]);t.projection(a)}return o},C.data.geo.params.forEach(function(e){o[e]=function(n){return i[e]=n,t.projection()[e](n),o}}),o.value=function(e){return r=C.accessor(e),o},o.output=function(e){return C.keys(a).forEach(function(t){void 0!==e[t]&&(a[t]=e[t])}),e},o},C.data.link=function(){function e(e){var t=o(e),n=s(e);return"M"+t.x+","+t.y+"L"+n.x+","+n.y}function t(e){var t=o(e),n=s(e),r=n.x-t.x,i=n.y-t.y,a=l*(r+i),c=l*(i-r);return"M"+t.x+","+t.y+"C"+(t.x+a)+","+(t.y+c)+" "+(n.x+c)+","+(n.y-a)+" "+n.x+","+n.y}function n(e){var t=o(e),n=s(e),r=(t.x+n.x)/2;return"M"+t.x+","+t.y+"C"+r+","+t.y+" "+r+","+n.y+" "+n.x+","+n.y}function r(e){var t=o(e),n=s(e),r=(t.y+n.y)/2;return"M"+t.x+","+t.y+"C"+t.x+","+r+" "+n.x+","+r+" "+n.x+","+n.y}function i(e){var t=u[a];return e.forEach(function(e){e[c.path]=t(e)}),e}var a="line",o=C.accessor("source"),s=C.accessor("target"),l=.2,c={path:"path"},u={line:e,curve:t,diagonal:n,diagonalX:n,diagonalY:r};return i.shape=function(e){return a=e,i},i.tension=function(e){return l=e,i},i.source=function(e){return o=C.accessor(e),i},i.target=function(e){return s=C.accessor(e),i},i.output=function(e){return C.keys(c).forEach(function(t){void 0!==e[t]&&(c[t]=e[t])}),i},i},C.data.pie=function(){function t(t){var n=t.map(function(e){return+r(e)}),l=i,c=(a-i)/e.sum(n),u=e.range(t.length);return o&&u.sort(function(e,t){return n[e]-n[t]}),u.forEach(function(e){var r;t[e].value=r=n[e],t[e][s.startAngle]=l,t[e][s.midAngle]=l+.5*r*c,t[e][s.endAngle]=l+=r*c}),t}var n=function(){return 1},r=n,i=0,a=2*Math.PI,o=!1,s={startAngle:"startAngle",endAngle:"endAngle",midAngle:"midAngle"};return t.sort=function(e){return o=e,t},t.value=function(e){return r=e?C.accessor(e):n,t},t.startAngle=function(e){return i=Math.PI*e/180,t},t.endAngle=function(e){return a=Math.PI*e/180,t},t.output=function(e){return C.keys(s).forEach(function(t){void 0!==e[t]&&(s[t]=e[t])}),t},t},C.data.slice=function(){function e(e){if(e=C.values(e),"min"===t)e=[e[C.minIndex(e,n)]];else if("max"===t)e=[e[C.maxIndex(e,n)]];else if("median"===t){var r=e.slice().sort(function(e,t){return e=n(e),t=n(t),t>e?-1:e>t?1:0});e=[e[~~(r.length/2)]]}else{var i=C.array(t);e=e.slice(i[0],i[1])}return e}var t=null,n=C.accessor("data");return e.by=function(n){return t=n,e},e.field=function(t){return n=C.accessor(t),e},e},C.data.sort=function(){function e(e){e=C.isArray(e)?e:e.values||[],e.sort(t);for(var n=0,r=e.length;r>n;++n)e[n].index=n;return e}var t=null;return e.by=function(n){return t=C.comparator(n),e},e},C.data.stack=function(){function t(e){var t=s.y0,i=s.y1,a=s.cy,o=n(e);return 0===o.length?e:(r.out(function(e,n,r){e.datum&&(e.datum[t]=n,e.datum[i]=r+n,e.datum[a]=n+r/2)})(o),e)}function n(e){var t,n,r,o,s,l,c,u,d=C.values(e),f=[],p=[];if(0===d.length)return p;for(n=0,r=d.length;r>n;++n){for(t=C.values(d[n]),o=0,s=t.length;s>o;++o)f.push({x:i(t[o]),y:a(t[o]),z:n,datum:t[o]});p.push([])}for(f.sort(function(e,t){return e.x<t.x?-1:e.x>t.x?1:e.z<t.z?-1:e.z>t.z?1:0}),u=f[0].x,n=0,o=0,l=0,r=f.length;r>l;++l){if(c=f[l],c.x!==u){for(;n<p.length;)p[n++].push({x:o,y:0});u=c.x,n=0,o+=1}for(;c.z>n;)p[n++].push({x:o,y:0});c.x=o,p[n++].push(c)}for(;n<p.length;)p[n++].push({x:o,y:0});return p}var r=e.layout.stack(),i=C.accessor("index"),a=C.accessor("data"),o=["offset","order"],s={y0:"y2",y1:"y",cy:"cy"};return t.point=function(e){return i=C.accessor(e),t},t.height=function(e){return a=C.accessor(e),t},o.forEach(function(e){t[e]=function(n){return r[e](n),t}}),t.output=function(n){return e.keys(s).forEach(function(e){void 0!==n[e]&&(s[e]=n[e])}),t},t},C.data.stats=function(){function e(e){var t,o,s,l,c=+1/0,u=-1/0,d=0,f=0,p=0,h=(C.isArray(e)?e:e.values||[]).map(n);for(t=0,o=h.length;o>t;++t)s=h[t],c>s&&(c=s),s>u&&(u=s),d+=s,l=s-f,f+=l/(t+1),p+=l*(s-f);p/=o-1;var g=C.isArray(e)?{}:e;if(i&&(h.sort(C.numcmp),t=h.length>>1,g[a.median]=h.length%2?h[t]:(h[t-1]+h[t])/2),g[a.count]=o,g[a.min]=c,g[a.max]=u,g[a.sum]=d,g[a.mean]=f,g[a.variance]=p,g[a.stdev]=Math.sqrt(p),r){for(h=C.isArray(e)?e:e.values,s={},s[a.count]=o,s[a.min]=c,s[a.max]=u,s[a.sum]=d,s[a.mean]=f,s[a.variance]=p,s[a.stdev]=Math.sqrt(p),i&&(s[a.median]=g[a.median]),t=0,o=h.length;o>t;++t)h[t].stats=s;C.isArray(e)&&(g=h)}return g}function t(t){return C.isArray(t)?e(t):(t.values||[]).map(e)
}var n=C.accessor("data"),r=!1,i=!1,a={count:"count",min:"min",max:"max",sum:"sum",mean:"mean",variance:"variance",stdev:"stdev",median:"median"};return t.median=function(e){return i=e||!1,t},t.value=function(e){return n=C.accessor(e),t},t.assign=function(e){return r=e,t},t.output=function(e){return C.keys(a).forEach(function(t){void 0!==e[t]&&(a[t]=e[t])}),t},t},C.data.treemap=function(){function t(e,t,a){e=n.size(C.data.size(i,a)).value(r).nodes(C.isTree(e)?e:{values:e});var s=C.keys(o),l=s.length;return e.forEach(function(e){for(var t,n,r=0;l>r;++r)t=s[r],t!==o[t]&&(n=e[t],delete e[t],e[o[t]]=n)}),e}var n=e.layout.treemap().children(function(e){return e.values}),r=C.accessor("data"),i=["width","height"],a=["round","sticky","ratio","padding"],o={x:"x",y:"y",dx:"width",dy:"height"};return t.size=function(e){return i=e,t},t.value=function(e){return r=C.accessor(e),t},a.forEach(function(e){t[e]=function(r){return n[e](r),t}}),t.output=function(e){return C.keys(o).forEach(function(t){void 0!==e[t]&&(o[t]=e[t])}),t},t},C.data.truncate=function(){var e,t=C.accessor("data"),n="truncate",r="right",i="...",a=!0,o=100,s=C.data.mapper(function(n){var s=C.truncate(t(n),o,r,a,i);return e(n,s),n});return s.value=function(e){return t=C.accessor(e),s},s.output=function(t){return n=t,e=C.mutator(t),s},s.limit=function(e){return o=+e,s},s.position=function(e){return r=e,s},s.ellipsis=function(e){return i=e+"",s},s.wordbreak=function(e){return a=!!e,s},s},C.data.unique=function(){function e(e){return C.unique(e,t).map(function(e){var t={};return t[n]=e,t})}var t=null,n="field";return e.field=function(n){return t=C.accessor(n),e},e.as=function(t){return n=t,e},e},C.data.window=function(){function e(e){e=C.isArray(e)?e:e.values||[];var r,i,a,o=[],s=e.length-t;for(r=0;s>=r;r+=n){for(i=0,a=[];t>i;++i)a.push(e[r+i]);o.push({key:r,values:a})}return{values:o}}var t=2,n=1;return e.size=function(n){return t=n,e},e.step=function(t){return n=t,e},e},C.data.wordcloud=function(){function t(e,t,s){function c(t){var r,i,o,s,c,u=n.size(),d=u[0]/2,f=u[1]/2,p=C.keys(l),h=p.length;for(e.sort(function(e,t){return a(t)-a(e)}),o=0,s=t.length;s>o;++o)for(i=e[o],c=0;h>c;++c)r=p[c],i[l[r]]=t[o][r],"x"===r&&(i[l.x]+=d),"y"===r&&(i[l.y]+=f)}return n.size(C.data.size(i,s)).text(r).fontSize(a).rotate(o).words(e).on("end",c).start(),e}var n=e.layout.cloud().size([900,500]),r=C.accessor("data"),i=["width","height"],a=function(){return 14},o=function(){return 0},s=["font","fontStyle","fontWeight","padding"],l={x:"x",y:"y",size:"fontSize",font:"font",rotate:"angle"};return t.text=function(e){return r=C.accessor(e),t},t.size=function(e){return i=e,t},t.fontSize=function(e){return a=C.accessor(e),t},t.rotate=function(e){var n;return C.isObject(e)&&!Array.isArray(e)?void 0!==e.random?(n=(n=e.random)?C.array(n):[0],o=function(){return n[~~(Math.random()*n.length-1e-5)]}):void 0!==e.alternate&&(n=(n=e.alternate)?C.array(n):[0],o=function(e,t){return n[t%n.length]}):o=C.accessor(field),t},s.forEach(function(e){t[e]=function(r){return n[e](r),t}}),t.output=function(e){return C.keys(l).forEach(function(t){void 0!==e[t]&&(l[t]=e[t])}),t},t},C.data.zip=function(){function e(e,o){var s,l,c,u,d,f=o[t],p=f.length;for(a&&(d={},f.forEach(function(e){d[a(e)]=e})),c=0,u=e.length;u>c;++c)l=e[c],l[n]=d?null!=(s=d[r(l)])?s:i:f[c%p];return e}var t=null,n="zip",r=C.accessor("data"),i=void 0,a=null;return e["with"]=function(n){return t=n,e},e["default"]=function(t){return i=t,e},e.as=function(t){return n=t,e},e.key=function(t){return r=C.accessor(t),e},e.withKey=function(t){return a=C.accessor(t),e},e},C.data.zip.dependencies=["with"],C.expression={},C.expression.parse=function(e,t){return j.parse("("+e+")",t)},C.expression.code=function(e){return z(e)};var R={NaN:"NaN",E:"Math.E",LN2:"Math.LN2",LN10:"Math.LN10",LOG2E:"Math.LOG2E",LOG10E:"Math.LOG10E",PI:"Math.PI",SQRT1_2:"Math.SQRT1_2",SQRT2:"Math.SQRT2"},D=function(e){function t(t,n,r,i){var a=e(n[0]);return r&&(a=r+"("+a+")",C.startsWith(r,"new ")&&(a="("+a+")")),a+"."+t+(0>i?"":0===i?"()":"("+n.slice(1).map(e).join(",")+")")}var n="new Date",r="String",i="RegExp";return{isNaN:"isNaN",isFinite:"isFinite",abs:"Math.abs",acos:"Math.acos",asin:"Math.asin",atan:"Math.atan",atan2:"Math.atan2",ceil:"Math.ceil",cos:"Math.cos",exp:"Math.exp",floor:"Math.floor",log:"Math.log",max:"Math.max",min:"Math.min",pow:"Math.pow",random:"Math.random",round:"Math.round",sin:"Math.sin",sqrt:"Math.sqrt",tan:"Math.tan",now:"Date.now",datetime:"new Date",date:function(e){return t("getDate",e,n,0)},day:function(e){return t("getDay",e,n,0)},year:function(e){return t("getFullYear",e,n,0)},month:function(e){return t("getMonth",e,n,0)},hours:function(e){return t("getHours",e,n,0)},minutes:function(e){return t("getMinutes",e,n,0)},seconds:function(e){return t("getSeconds",e,n,0)},milliseconds:function(e){return t("getMilliseconds",e,n,0)},time:function(e){return t("getTime",e,n,0)},timezoneoffset:function(e){return t("getTimezoneOffset",e,n,0)},utcdate:function(e){return t("getUTCDate",e,n,0)},utcday:function(e){return t("getUTCDay",e,n,0)},utcyear:function(e){return t("getUTCFullYear",e,n,0)},utcmonth:function(e){return t("getUTCMonth",e,n,0)},utchours:function(e){return t("getUTCHours",e,n,0)},utcminutes:function(e){return t("getUTCMinutes",e,n,0)},utcseconds:function(e){return t("getUTCSeconds",e,n,0)},utcmilliseconds:function(e){return t("getUTCMilliseconds",e,n,0)},parseFloat:"parseFloat",parseInt:"parseInt",length:function(e){return t("length",e,null,-1)},upper:function(e){return t("toUpperCase",e,r,0)},lower:function(e){return t("toLowerCase",e,r,0)},slice:function(e){return t("slice",e,r)},substring:function(e){return t("substring",e,r)},test:function(e){return t("test",e,i)},"if":function(t){if(t.length<3)throw new Error("Missing arguments to if function.");if(t.length>3)throw new Error("Too many arguments to if function.");var n=t.map(e);return n[0]+"?"+n[1]+":"+n[2]}}},z=function(e){function t(e){if(e instanceof String)return e;var t=s[e.type];if(null==t)throw new Error("Unsupported type: "+e.type);return t(e)}e=e||{};var n=e.constants||R,r=(e.functions||D)(t),i=e.idWhiteList?C.toMap(e.idWhiteList):null,a=e.idBlackList?C.toMap(e.idBlackList):null,o=0,s={Literal:function(e){return e.raw},Identifier:function(e){var t=e.name;if(o>0)return t;if(n.hasOwnProperty(t))return n[t];if(i){if(i.hasOwnProperty(t))return t;throw new Error("Illegal identifier: "+t)}if(a&&a.hasOwnProperty(t))throw new Error("Illegal identifier: "+t);return t},Program:function(e){return e.body.map(t).join("\n")},MemberExpression:function(e){var n=!e.computed,r=t(e.object);n&&(o+=1);var i=t(e.property);return n&&(o-=1),r+(n?"."+i:"["+i+"]")},CallExpression:function(e){if("Identifier"!==e.callee.type)throw new Error("Illegal callee type: "+e.callee.type);var n=e.callee.name,i=e.arguments,a=r.hasOwnProperty(n)&&r[n];if(!a)throw new Error("Unrecognized function: "+n);return a instanceof Function?a(i):a+"("+i.map(t).join(",")+")"},ArrayExpression:function(e){return"["+e.elements.map(t).join(",")+"]"},BinaryExpression:function(e){return"("+t(e.left)+e.operator+t(e.right)+")"},UnaryExpression:function(e){return"("+e.operator+t(e.argument)+")"},UpdateExpression:function(e){return"("+(prefix?e.operator+t(e.argument):t(e.argument)+e.operator)+")"},ConditionalExpression:function(e){return"("+t(e.test)+"?"+t(e.consequent)+":"+t(e.alternate)+")"},LogicalExpression:function(e){return"("+t(e.left)+e.operator+t(e.right)+")"},ObjectExpression:function(e){return"{"+e.properties.map(t).join(",")+"}"},Property:function(e){o+=1;var n=t(e.key);return o-=1,n+":"+t(e.value)},ExpressionStatement:function(e){return t(e.expression)}};return t},j=function(){"use strict";function e(e,t){if(!e)throw new Error("ASSERT: "+t)}function t(e){return e>=48&&57>=e}function n(e){return"0123456789abcdefABCDEF".indexOf(e)>=0}function r(e){return"01234567".indexOf(e)>=0}function i(e){return 32===e||9===e||11===e||12===e||160===e||e>=5760&&[5760,6158,8192,8193,8194,8195,8196,8197,8198,8199,8200,8201,8202,8239,8287,12288,65279].indexOf(e)>=0}function a(e){return 10===e||13===e||8232===e||8233===e}function o(e){return 36===e||95===e||e>=65&&90>=e||e>=97&&122>=e||92===e||e>=128&&_t.NonAsciiIdentifierStart.test(String.fromCharCode(e))}function s(e){return 36===e||95===e||e>=65&&90>=e||e>=97&&122>=e||e>=48&&57>=e||92===e||e>=128&&_t.NonAsciiIdentifierPart.test(String.fromCharCode(e))}function l(e){switch(e){case"class":case"enum":case"export":case"extends":case"import":case"super":return!0;default:return!1}}function c(e){switch(e){case"implements":case"interface":case"package":case"private":case"protected":case"public":case"static":case"yield":case"let":return!0;default:return!1}}function u(e){if(Et&&c(e))return!0;switch(e.length){case 2:return"if"===e||"in"===e||"do"===e;case 3:return"var"===e||"for"===e||"new"===e||"try"===e||"let"===e;case 4:return"this"===e||"else"===e||"case"===e||"void"===e||"with"===e||"enum"===e;case 5:return"while"===e||"break"===e||"catch"===e||"throw"===e||"const"===e||"yield"===e||"class"===e||"super"===e;case 6:return"return"===e||"typeof"===e||"delete"===e||"switch"===e||"export"===e||"import"===e;case 7:return"default"===e||"finally"===e||"extends"===e;case 8:return"function"===e||"continue"===e||"debugger"===e;case 10:return"instanceof"===e;default:return!1}}function d(){var e,t;for(t=0===Tt;Ct>Tt;)if(e=Ot.charCodeAt(Tt),i(e))++Tt;else{if(!a(e))break;++Tt,13===e&&10===Ot.charCodeAt(Tt)&&++Tt,++At,Lt=Tt,t=!0}}function f(e){var t,r,i,a=0;for(r="u"===e?4:2,t=0;r>t;++t){if(!(Ct>Tt&&n(Ot[Tt])))return"";i=Ot[Tt++],a=16*a+"0123456789abcdef".indexOf(i.toLowerCase())}return String.fromCharCode(a)}function p(){var e,t,r,i;for(e=Ot[Tt],t=0,"}"===e&&U({},St.UnexpectedToken,"ILLEGAL");Ct>Tt&&(e=Ot[Tt++],n(e));)t=16*t+"0123456789abcdef".indexOf(e.toLowerCase());return(t>1114111||"}"!==e)&&U({},St.UnexpectedToken,"ILLEGAL"),65535>=t?String.fromCharCode(t):(r=(t-65536>>10)+55296,i=(t-65536&1023)+56320,String.fromCharCode(r,i))}function h(){var e,t;for(e=Ot.charCodeAt(Tt++),t=String.fromCharCode(e),92===e&&(117!==Ot.charCodeAt(Tt)&&U({},St.UnexpectedToken,"ILLEGAL"),++Tt,e=f("u"),e&&"\\"!==e&&o(e.charCodeAt(0))||U({},St.UnexpectedToken,"ILLEGAL"),t=e);Ct>Tt&&(e=Ot.charCodeAt(Tt),s(e));)++Tt,t+=String.fromCharCode(e),92===e&&(t=t.substr(0,t.length-1),117!==Ot.charCodeAt(Tt)&&U({},St.UnexpectedToken,"ILLEGAL"),++Tt,e=f("u"),e&&"\\"!==e&&s(e.charCodeAt(0))||U({},St.UnexpectedToken,"ILLEGAL"),t+=e);return t}function g(){var e,t;for(e=Tt++;Ct>Tt;){if(t=Ot.charCodeAt(Tt),92===t)return Tt=e,h();if(!s(t))break;++Tt}return Ot.slice(e,Tt)}function m(){var e,t,n;return e=Tt,t=92===Ot.charCodeAt(Tt)?h():g(),n=1===t.length?bt.Identifier:u(t)?bt.Keyword:"null"===t?bt.NullLiteral:"true"===t||"false"===t?bt.BooleanLiteral:bt.Identifier,{type:n,value:t,lineNumber:At,lineStart:Lt,start:e,end:Tt}}function v(){var e,t,n,r,i=Tt,a=Ot.charCodeAt(Tt),o=Ot[Tt];switch(a){case 46:case 40:case 41:case 59:case 44:case 123:case 125:case 91:case 93:case 58:case 63:case 126:return++Tt,Pt.tokenize&&(40===a?Pt.openParenToken=Pt.tokens.length:123===a&&(Pt.openCurlyToken=Pt.tokens.length)),{type:bt.Punctuator,value:String.fromCharCode(a),lineNumber:At,lineStart:Lt,start:i,end:Tt};default:if(e=Ot.charCodeAt(Tt+1),61===e)switch(a){case 43:case 45:case 47:case 60:case 62:case 94:case 124:case 37:case 38:case 42:return Tt+=2,{type:bt.Punctuator,value:String.fromCharCode(a)+String.fromCharCode(e),lineNumber:At,lineStart:Lt,start:i,end:Tt};case 33:case 61:return Tt+=2,61===Ot.charCodeAt(Tt)&&++Tt,{type:bt.Punctuator,value:Ot.slice(i,Tt),lineNumber:At,lineStart:Lt,start:i,end:Tt}}}return r=Ot.substr(Tt,4),">>>="===r?(Tt+=4,{type:bt.Punctuator,value:r,lineNumber:At,lineStart:Lt,start:i,end:Tt}):(n=r.substr(0,3),">>>"===n||"<<="===n||">>="===n?(Tt+=3,{type:bt.Punctuator,value:n,lineNumber:At,lineStart:Lt,start:i,end:Tt}):(t=n.substr(0,2),o===t[1]&&"+-<>&|".indexOf(o)>=0||"=>"===t?(Tt+=2,{type:bt.Punctuator,value:t,lineNumber:At,lineStart:Lt,start:i,end:Tt}):"<>=!+-*%&|^/".indexOf(o)>=0?(++Tt,{type:bt.Punctuator,value:o,lineNumber:At,lineStart:Lt,start:i,end:Tt}):void U({},St.UnexpectedToken,"ILLEGAL")))}function y(e){for(var t="";Ct>Tt&&n(Ot[Tt]);)t+=Ot[Tt++];return 0===t.length&&U({},St.UnexpectedToken,"ILLEGAL"),o(Ot.charCodeAt(Tt))&&U({},St.UnexpectedToken,"ILLEGAL"),{type:bt.NumericLiteral,value:parseInt("0x"+t,16),lineNumber:At,lineStart:Lt,start:e,end:Tt}}function b(e){for(var n="0"+Ot[Tt++];Ct>Tt&&r(Ot[Tt]);)n+=Ot[Tt++];return(o(Ot.charCodeAt(Tt))||t(Ot.charCodeAt(Tt)))&&U({},St.UnexpectedToken,"ILLEGAL"),{type:bt.NumericLiteral,value:parseInt(n,8),octal:!0,lineNumber:At,lineStart:Lt,start:e,end:Tt}}function x(){var n,i,a;if(a=Ot[Tt],e(t(a.charCodeAt(0))||"."===a,"Numeric literal must start with a decimal digit or a decimal point"),i=Tt,n="","."!==a){if(n=Ot[Tt++],a=Ot[Tt],"0"===n){if("x"===a||"X"===a)return++Tt,y(i);if(r(a))return b(i);a&&t(a.charCodeAt(0))&&U({},St.UnexpectedToken,"ILLEGAL")}for(;t(Ot.charCodeAt(Tt));)n+=Ot[Tt++];a=Ot[Tt]}if("."===a){for(n+=Ot[Tt++];t(Ot.charCodeAt(Tt));)n+=Ot[Tt++];a=Ot[Tt]}if("e"===a||"E"===a)if(n+=Ot[Tt++],a=Ot[Tt],("+"===a||"-"===a)&&(n+=Ot[Tt++]),t(Ot.charCodeAt(Tt)))for(;t(Ot.charCodeAt(Tt));)n+=Ot[Tt++];else U({},St.UnexpectedToken,"ILLEGAL");return o(Ot.charCodeAt(Tt))&&U({},St.UnexpectedToken,"ILLEGAL"),{type:bt.NumericLiteral,value:parseFloat(n),lineNumber:At,lineStart:Lt,start:i,end:Tt}}function k(){var t,n,i,o,s,l,c,u,d="",h=!1;for(c=At,u=Lt,t=Ot[Tt],e("'"===t||'"'===t,"String literal must starts with a quote"),n=Tt,++Tt;Ct>Tt;){if(i=Ot[Tt++],i===t){t="";break}if("\\"===i)if(i=Ot[Tt++],i&&a(i.charCodeAt(0)))++At,"\r"===i&&"\n"===Ot[Tt]&&++Tt,Lt=Tt;else switch(i){case"u":case"x":"{"===Ot[Tt]?(++Tt,d+=p()):(l=Tt,s=f(i),s?d+=s:(Tt=l,d+=i));break;case"n":d+="\n";break;case"r":d+="\r";break;case"t":d+="	";break;case"b":d+="\b";break;case"f":d+="\f";break;case"v":d+="";break;default:r(i)?(o="01234567".indexOf(i),0!==o&&(h=!0),Ct>Tt&&r(Ot[Tt])&&(h=!0,o=8*o+"01234567".indexOf(Ot[Tt++]),"0123".indexOf(i)>=0&&Ct>Tt&&r(Ot[Tt])&&(o=8*o+"01234567".indexOf(Ot[Tt++]))),d+=String.fromCharCode(o)):d+=i}else{if(a(i.charCodeAt(0)))break;d+=i}}return""!==t&&U({},St.UnexpectedToken,"ILLEGAL"),{type:bt.StringLiteral,value:d,octal:h,startLineNumber:c,startLineStart:u,lineNumber:At,lineStart:Lt,start:n,end:Tt}}function w(e,t){var n,r=e;t.indexOf("u")>=0&&(r=r.replace(/\\u\{([0-9a-fA-F]+)\}/g,function(e,t){return parseInt(t,16)<=1114111?"x":void U({},St.InvalidRegExp)}).replace(/[\uD800-\uDBFF][\uDC00-\uDFFF]/g,"x"));try{n=new RegExp(r)}catch(i){U({},St.InvalidRegExp)}try{return new RegExp(e,t)}catch(a){return null}}function S(){var t,n,r,i,o;for(t=Ot[Tt],e("/"===t,"Regular expression literal must start with a slash"),n=Ot[Tt++],r=!1,i=!1;Ct>Tt;)if(t=Ot[Tt++],n+=t,"\\"===t)t=Ot[Tt++],a(t.charCodeAt(0))&&U({},St.UnterminatedRegExp),n+=t;else if(a(t.charCodeAt(0)))U({},St.UnterminatedRegExp);else if(r)"]"===t&&(r=!1);else{if("/"===t){i=!0;break}"["===t&&(r=!0)}return i||U({},St.UnterminatedRegExp),o=n.substr(1,n.length-2),{value:o,literal:n}}function _(){var e,t,n,r;for(t="",n="";Ct>Tt&&(e=Ot[Tt],s(e.charCodeAt(0)));)if(++Tt,"\\"===e&&Ct>Tt)if(e=Ot[Tt],"u"===e){if(++Tt,r=Tt,e=f("u"))for(n+=e,t+="\\u";Tt>r;++r)t+=Ot[r];else Tt=r,n+="u",t+="\\u";F({},St.UnexpectedToken,"ILLEGAL")}else t+="\\",F({},St.UnexpectedToken,"ILLEGAL");else n+=e,t+=e;return{value:n,literal:t}}function O(){var e,t,n,r;return Mt=null,d(),e=Tt,t=S(),n=_(),r=w(t.value,n.value),Pt.tokenize?{type:bt.RegularExpression,value:r,regex:{pattern:t.value,flags:n.value},lineNumber:At,lineStart:Lt,start:e,end:Tt}:{literal:t.literal+n.literal,value:r,regex:{pattern:t.value,flags:n.value},start:e,end:Tt}}function E(){var e,t,n,r;return d(),e=Tt,t={start:{line:At,column:Tt-Lt}},n=O(),t.end={line:At,column:Tt-Lt},Pt.tokenize||(Pt.tokens.length>0&&(r=Pt.tokens[Pt.tokens.length-1],r.range[0]===e&&"Punctuator"===r.type&&("/"===r.value||"/="===r.value)&&Pt.tokens.pop()),Pt.tokens.push({type:"RegularExpression",value:n.literal,regex:n.regex,range:[e,Tt],loc:t})),n}function T(e){return e.type===bt.Identifier||e.type===bt.Keyword||e.type===bt.BooleanLiteral||e.type===bt.NullLiteral}function A(){var e,t;if(e=Pt.tokens[Pt.tokens.length-1],!e)return E();if("Punctuator"===e.type){if("]"===e.value)return v();if(")"===e.value)return t=Pt.tokens[Pt.openParenToken-1],!t||"Keyword"!==t.type||"if"!==t.value&&"while"!==t.value&&"for"!==t.value&&"with"!==t.value?v():E();if("}"===e.value){if(Pt.tokens[Pt.openCurlyToken-3]&&"Keyword"===Pt.tokens[Pt.openCurlyToken-3].type){if(t=Pt.tokens[Pt.openCurlyToken-4],!t)return v()}else{if(!Pt.tokens[Pt.openCurlyToken-4]||"Keyword"!==Pt.tokens[Pt.openCurlyToken-4].type)return v();if(t=Pt.tokens[Pt.openCurlyToken-5],!t)return E()}return v()}return E()}return"Keyword"===e.type&&"this"!==e.value?E():v()}function L(){var e;return d(),Tt>=Ct?{type:bt.EOF,lineNumber:At,lineStart:Lt,start:Tt,end:Tt}:(e=Ot.charCodeAt(Tt),o(e)?m():40===e||41===e||59===e?v():39===e||34===e?k():46===e?t(Ot.charCodeAt(Tt+1))?x():v():t(e)?x():Pt.tokenize&&47===e?A():v())}function C(){var e,t,n,r;return d(),e={start:{line:At,column:Tt-Lt}},t=L(),e.end={line:At,column:Tt-Lt},t.type!==bt.EOF&&(n=Ot.slice(t.start,t.end),r={type:xt[t.type],value:n,range:[t.start,t.end],loc:e},t.regex&&(r.regex={pattern:t.regex.pattern,flags:t.regex.flags}),Pt.tokens.push(r)),t}function M(){var e;return e=Mt,Tt=e.end,At=e.lineNumber,Lt=e.lineStart,Mt="undefined"!=typeof Pt.tokens?C():L(),Tt=e.end,At=e.lineNumber,Lt=e.lineStart,e}function N(){var e,t,n;e=Tt,t=At,n=Lt,Mt="undefined"!=typeof Pt.tokens?C():L(),Tt=e,At=t,Lt=n}function P(){this.line=At,this.column=Tt-Lt}function I(){this.start=new P,this.end=null}function R(e){this.start=e.type===bt.StringLiteral?{line:e.startLineNumber,column:e.start-e.startLineStart}:{line:e.lineNumber,column:e.start-e.lineStart},this.end=null}function D(){Tt=Mt.start,Mt.type===bt.StringLiteral?(At=Mt.startLineNumber,Lt=Mt.startLineStart):(At=Mt.lineNumber,Lt=Mt.lineStart),Pt.range&&(this.range=[Tt,0]),Pt.loc&&(this.loc=new I)}function z(e){Pt.range&&(this.range=[e.start,0]),Pt.loc&&(this.loc=new R(e))}function j(){var e,t,n,r;return e=Tt,t=At,n=Lt,d(),r=At!==t,Tt=e,At=t,Lt=n,r}function U(t,n){var r,i=Array.prototype.slice.call(arguments,2),a=n.replace(/%(\d)/g,function(t,n){return e(n<i.length,"Message reference must be in range"),i[n]});throw"number"==typeof t.lineNumber?(r=new Error("Line "+t.lineNumber+": "+a),r.index=t.start,r.lineNumber=t.lineNumber,r.column=t.start-Lt+1):(r=new Error("Line "+At+": "+a),r.index=Tt,r.lineNumber=At,r.column=Tt-Lt+1),r.description=a,r}function F(){try{U.apply(null,arguments)}catch(e){if(!Pt.errors)throw e;Pt.errors.push(e)}}function W(e){if(e.type===bt.EOF&&U(e,St.UnexpectedEOS),e.type===bt.NumericLiteral&&U(e,St.UnexpectedNumber),e.type===bt.StringLiteral&&U(e,St.UnexpectedString),e.type===bt.Identifier&&U(e,St.UnexpectedIdentifier),e.type===bt.Keyword){if(l(e.value))U(e,St.UnexpectedReserved);else if(Et&&c(e.value))return void F(e,St.StrictReservedWord);U(e,St.UnexpectedToken,e.value)}U(e,St.UnexpectedToken,e.value)}function B(e){var t=M();(t.type!==bt.Punctuator||t.value!==e)&&W(t)}function H(e){if(Pt.errors){var t=Mt;t.type!==bt.Punctuator&&t.value!==e?F(t,St.UnexpectedToken,t.value):M()}else B(e)}function X(e){return Mt.type===bt.Punctuator&&Mt.value===e}function q(e){return Mt.type===bt.Keyword&&Mt.value===e}function G(){var e;return 59===Ot.charCodeAt(Tt)||X(";")?void M():(e=At,d(),void(At===e&&(Mt.type===bt.EOF||X("}")||W(Mt))))}function Y(){var e=[],t=new D;for(B("[");!X("]");)X(",")?(M(),e.push(null)):(e.push(ct()),X("]")||B(","));return M(),t.finishArrayExpression(e)}function K(){var e,t=new D;return e=M(),e.type===bt.StringLiteral||e.type===bt.NumericLiteral?(Et&&e.octal&&F(e,St.StrictOctalLiteral),t.finishLiteral(e)):t.finishIdentifier(e.value)}function V(){var e,t,n,r,i=new D;return e=Mt,e.type===bt.Identifier?(n=K(),B(":"),r=ct(),i.finishProperty("init",n,r)):e.type!==bt.EOF&&e.type!==bt.Punctuator?(t=K(),B(":"),r=ct(),i.finishProperty("init",t,r)):void W(e)}function Q(){var e,t,n,r,i=[],a={},o=String,s=new D;for(B("{");!X("}");)e=V(),t=e.key.type===kt.Identifier?e.key.name:o(e.key.value),r="init"===e.kind?wt.Data:"get"===e.kind?wt.Get:wt.Set,n="$"+t,Object.prototype.hasOwnProperty.call(a,n)?(a[n]===wt.Data?Et&&r===wt.Data?F({},St.StrictDuplicateProperty):r!==wt.Data&&F({},St.AccessorDataProperty):r===wt.Data?F({},St.AccessorDataProperty):a[n]&r&&F({},St.AccessorGetSet),a[n]|=r):a[n]=r,i.push(e),X("}")||H(",");return B("}"),s.finishObjectExpression(i)}function Z(){var e;return B("("),++Nt.parenthesisCount,e=ut(),B(")"),e}function $(){var e,t,n,r;if(X("("))return Z();if(X("["))return Y();if(X("{"))return Q();if(e=Mt.type,r=new D,e===bt.Identifier||It[Mt.value])n=r.finishIdentifier(M().value);else if(e===bt.StringLiteral||e===bt.NumericLiteral)Et&&Mt.octal&&F(Mt,St.StrictOctalLiteral),n=r.finishLiteral(M());else{if(e===bt.Keyword)throw new Error("Disabled.");e===bt.BooleanLiteral?(t=M(),t.value="true"===t.value,n=r.finishLiteral(t)):e===bt.NullLiteral?(t=M(),t.value=null,n=r.finishLiteral(t)):X("/")||X("/=")?(n=r.finishLiteral("undefined"!=typeof Pt.tokens?E():O()),N()):W(M())}return n}function J(){var e=[];if(B("("),!X(")"))for(;Ct>Tt&&(e.push(ct()),!X(")"));)H(",");return B(")"),e}function et(){var e,t=new D;return e=M(),T(e)||W(e),t.finishIdentifier(e.value)}function tt(){return B("."),et()}function nt(){var e;return B("["),e=ut(),B("]"),e}function rt(){var e,t,n,r,i=Nt.allowIn;for(r=Mt,Nt.allowIn=!0,e=$();;)if(X("."))n=tt(),e=new z(r).finishMemberExpression(".",e,n);else if(X("("))t=J(),e=new z(r).finishCallExpression(e,t);else{if(!X("["))break;n=nt(),e=new z(r).finishMemberExpression("[",e,n)}return Nt.allowIn=i,e}function it(){var e;if(e=rt(),Mt.type===bt.Punctuator&&(X("++")||X("--"))&&!j())throw new Error("Disabled.");return e}function at(){var e,t,n;if(Mt.type!==bt.Punctuator&&Mt.type!==bt.Keyword)t=it();else{if(X("++")||X("--"))throw new Error("Disabled.");if(X("+")||X("-")||X("~")||X("!"))n=Mt,e=M(),t=at(),t=new z(n).finishUnaryExpression(e.value,t);else{if(q("delete")||q("void")||q("typeof"))throw new Error("Disabled.");t=it()}}return t}function ot(e,t){var n=0;if(e.type!==bt.Punctuator&&e.type!==bt.Keyword)return 0;switch(e.value){case"||":n=1;break;case"&&":n=2;break;case"|":n=3;break;case"^":n=4;break;case"&":n=5;break;case"==":case"!=":case"===":case"!==":n=6;break;case"<":case">":case"<=":case">=":case"instanceof":n=7;break;case"in":n=t?7:0;break;case"<<":case">>":case">>>":n=8;break;case"+":case"-":n=9;break;case"*":case"/":case"%":n=11}return n}function st(){var e,t,n,r,i,a,o,s,l,c;if(e=Mt,l=at(),r=Mt,i=ot(r,Nt.allowIn),0===i)return l;for(r.prec=i,M(),t=[e,Mt],o=at(),a=[l,r,o];(i=ot(Mt,Nt.allowIn))>0;){for(;a.length>2&&i<=a[a.length-2].prec;)o=a.pop(),s=a.pop().value,l=a.pop(),t.pop(),n=new z(t[t.length-1]).finishBinaryExpression(s,l,o),a.push(n);r=M(),r.prec=i,a.push(r),t.push(Mt),n=at(),a.push(n)}for(c=a.length-1,n=a[c],t.pop();c>1;)n=new z(t.pop()).finishBinaryExpression(a[c-1].value,a[c-2],n),c-=2;return n}function lt(){var e,t,n,r,i;return i=Mt,e=st(),X("?")&&(M(),t=Nt.allowIn,Nt.allowIn=!0,n=ct(),Nt.allowIn=t,B(":"),r=ct(),e=new z(i).finishConditionalExpression(e,n,r)),e}function ct(){var e,t,n,r;return e=Nt.parenthesisCount,r=Mt,t=Mt,n=lt()}function ut(){var e;if(e=ct(),X(","))throw new Error("Disabled.");return e}function dt(e){var t=ut();return G(),e.finishExpressionStatement(t)}function ft(){var e,t,n=Mt.type;if(n===bt.EOF&&W(Mt),n===bt.Punctuator&&"{"===Mt.value)throw new Error("Disabled.");if(t=new D,n===bt.Punctuator)switch(Mt.value){case";":throw new Error("Disabled.");case"(":return dt(t)}else if(n===bt.Keyword)throw new Error("Disabled.");return e=ut(),G(),t.finishExpressionStatement(e)}function pt(){if(Mt.type===bt.Keyword)switch(Mt.value){case"const":case"let":throw new Error("Disabled.");case"function":throw new Error("Disabled.");default:return ft()}return Mt.type!==bt.EOF?ft():void 0}function ht(){for(var e,t,n,r,i=[];Ct>Tt&&(t=Mt,t.type===bt.StringLiteral)&&(e=pt(),i.push(e),e.expression.type===kt.Literal);)n=Ot.slice(t.start+1,t.end-1),"use strict"===n?(Et=!0,r&&F(r,St.StrictOctalLiteral)):!r&&t.octal&&(r=t);for(;Ct>Tt&&(e=pt(),"undefined"!=typeof e);)i.push(e);return i}function gt(){var e,t;return d(),N(),t=new D,Et=!0,e=ht(),t.finishProgram(e)}function mt(){var e,t,n,r=[];for(e=0;e<Pt.tokens.length;++e)t=Pt.tokens[e],n={type:t.type,value:t.value},t.regex&&(n.regex={pattern:t.regex.pattern,flags:t.regex.flags}),Pt.range&&(n.range=t.range),Pt.loc&&(n.loc=t.loc),r.push(n);Pt.tokens=r}function vt(e,t){var n,r;n=String,"string"==typeof e||e instanceof String||(e=n(e)),Ot=e,Tt=0,At=Ot.length>0?1:0,Lt=0,Ct=Ot.length,Mt=null,Nt={allowIn:!0,labelSet:{},inFunctionBody:!1,inIteration:!1,inSwitch:!1,lastCommentStart:-1},Pt={},t=t||{},t.tokens=!0,Pt.tokens=[],Pt.tokenize=!0,Pt.openParenToken=-1,Pt.openCurlyToken=-1,Pt.range="boolean"==typeof t.range&&t.range,Pt.loc="boolean"==typeof t.loc&&t.loc,"boolean"==typeof t.tolerant&&t.tolerant&&(Pt.errors=[]);try{if(N(),Mt.type===bt.EOF)return Pt.tokens;for(M();Mt.type!==bt.EOF;)try{M()}catch(i){if(Pt.errors){Pt.errors.push(i);break}throw i}mt(),r=Pt.tokens,"undefined"!=typeof Pt.errors&&(r.errors=Pt.errors)}catch(a){throw a}finally{Pt={}}return r}function yt(e,t){var n,r;r=String,"string"==typeof e||e instanceof String||(e=r(e)),Ot=e,Tt=0,At=Ot.length>0?1:0,Lt=0,Ct=Ot.length,Mt=null,Nt={allowIn:!0,labelSet:{},parenthesisCount:0,inFunctionBody:!1,inIteration:!1,inSwitch:!1,lastCommentStart:-1},Pt={},"undefined"!=typeof t&&(Pt.range="boolean"==typeof t.range&&t.range,Pt.loc="boolean"==typeof t.loc&&t.loc,Pt.loc&&null!==t.source&&void 0!==t.source&&(Pt.source=r(t.source)),"boolean"==typeof t.tokens&&t.tokens&&(Pt.tokens=[]),"boolean"==typeof t.tolerant&&t.tolerant&&(Pt.errors=[]));try{n=gt(),"undefined"!=typeof Pt.tokens&&(mt(),n.tokens=Pt.tokens),"undefined"!=typeof Pt.errors&&(n.errors=Pt.errors)}catch(i){throw i}finally{Pt={}}return n}var bt,xt,kt,wt,St,_t,Ot,Et,Tt,At,Lt,Ct,Mt,Nt,Pt;bt={BooleanLiteral:1,EOF:2,Identifier:3,Keyword:4,NullLiteral:5,NumericLiteral:6,Punctuator:7,StringLiteral:8,RegularExpression:9},xt={},xt[bt.BooleanLiteral]="Boolean",xt[bt.EOF]="<end>",xt[bt.Identifier]="Identifier",xt[bt.Keyword]="Keyword",xt[bt.NullLiteral]="Null",xt[bt.NumericLiteral]="Numeric",xt[bt.Punctuator]="Punctuator",xt[bt.StringLiteral]="String",xt[bt.RegularExpression]="RegularExpression",kt={AssignmentExpression:"AssignmentExpression",ArrayExpression:"ArrayExpression",BinaryExpression:"BinaryExpression",CallExpression:"CallExpression",ConditionalExpression:"ConditionalExpression",ExpressionStatement:"ExpressionStatement",Identifier:"Identifier",Literal:"Literal",LogicalExpression:"LogicalExpression",MemberExpression:"MemberExpression",ObjectExpression:"ObjectExpression",Program:"Program",Property:"Property",UnaryExpression:"UnaryExpression",UpdateExpression:"UpdateExpression"},wt={Data:1,Get:2,Set:4},St={UnexpectedToken:"Unexpected token %0",UnexpectedNumber:"Unexpected number",UnexpectedString:"Unexpected string",UnexpectedIdentifier:"Unexpected identifier",UnexpectedReserved:"Unexpected reserved word",UnexpectedEOS:"Unexpected end of input",NewlineAfterThrow:"Illegal newline after throw",InvalidRegExp:"Invalid regular expression",UnterminatedRegExp:"Invalid regular expression: missing /",InvalidLHSInAssignment:"Invalid left-hand side in assignment",InvalidLHSInForIn:"Invalid left-hand side in for-in",MultipleDefaultsInSwitch:"More than one default clause in switch statement",NoCatchOrFinally:"Missing catch or finally after try",UnknownLabel:"Undefined label '%0'",Redeclaration:"%0 '%1' has already been declared",IllegalContinue:"Illegal continue statement",IllegalBreak:"Illegal break statement",IllegalReturn:"Illegal return statement",StrictModeWith:"Strict mode code may not include a with statement",StrictCatchVariable:"Catch variable may not be eval or arguments in strict mode",StrictVarName:"Variable name may not be eval or arguments in strict mode",StrictParamName:"Parameter name eval or arguments is not allowed in strict mode",StrictParamDupe:"Strict mode function may not have duplicate parameter names",StrictFunctionName:"Function name may not be eval or arguments in strict mode",StrictOctalLiteral:"Octal literals are not allowed in strict mode.",StrictDelete:"Delete of an unqualified identifier in strict mode.",StrictDuplicateProperty:"Duplicate data property in object literal not allowed in strict mode",AccessorDataProperty:"Object literal may not have data and accessor property with the same name",AccessorGetSet:"Object literal may not have multiple get/set accessors with the same name",StrictLHSAssignment:"Assignment to eval or arguments is not allowed in strict mode",StrictLHSPostfix:"Postfix increment/decrement may not have eval or arguments operand in strict mode",StrictLHSPrefix:"Prefix increment/decrement may not have eval or arguments operand in strict mode",StrictReservedWord:"Use of future reserved word in strict mode"},_t={NonAsciiIdentifierStart:new RegExp("[--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------]"),NonAsciiIdentifierPart:new RegExp("[--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------]")},z.prototype=D.prototype={finish:function(){Pt.range&&(this.range[1]=Tt),Pt.loc&&(this.loc.end=new P,Pt.source&&(this.loc.source=Pt.source))},finishArrayExpression:function(e){return this.type=kt.ArrayExpression,this.elements=e,this.finish(),this},finishAssignmentExpression:function(e,t,n){return this.type=kt.AssignmentExpression,this.operator=e,this.left=t,this.right=n,this.finish(),this},finishBinaryExpression:function(e,t,n){return this.type="||"===e||"&&"===e?kt.LogicalExpression:kt.BinaryExpression,this.operator=e,this.left=t,this.right=n,this.finish(),this},finishCallExpression:function(e,t){return this.type=kt.CallExpression,this.callee=e,this.arguments=t,this.finish(),this},finishConditionalExpression:function(e,t,n){return this.type=kt.ConditionalExpression,this.test=e,this.consequent=t,this.alternate=n,this.finish(),this
},finishExpressionStatement:function(e){return this.type=kt.ExpressionStatement,this.expression=e,this.finish(),this},finishIdentifier:function(e){return this.type=kt.Identifier,this.name=e,this.finish(),this},finishLiteral:function(e){return this.type=kt.Literal,this.value=e.value,this.raw=Ot.slice(e.start,e.end),e.regex&&(this.regex=e.regex),this.finish(),this},finishMemberExpression:function(e,t,n){return this.type=kt.MemberExpression,this.computed="["===e,this.object=t,this.property=n,this.finish(),this},finishObjectExpression:function(e){return this.type=kt.ObjectExpression,this.properties=e,this.finish(),this},finishProgram:function(e){return this.type=kt.Program,this.body=e,this.finish(),this},finishProperty:function(e,t,n){return this.type=kt.Property,this.key=t,this.value=n,this.kind=e,this.finish(),this},finishUnaryExpression:function(e,t){return this.type="++"===e||"--"===e?kt.UpdateExpression:kt.UnaryExpression,this.operator=e,this.argument=t,this.prefix=!0,this.finish(),this}};var It={"if":1,"this":1};return{tokenize:vt,parse:yt}}();C.parse={},C.parse.axes=function(){function e(e,n,r){(e||[]).forEach(function(e,i){n[i]=n[i]||C.scene.axis(),t(e,i,n[i],r)})}function t(e,t,r,i){void 0!==e.scale&&r.scale(i[e.scale]),r.orient(e.orient||n[e.type]),r.offset(e.offset||0),r.layer(e.layer||"front"),r.grid(e.grid||!1),r.title(e.title||null),r.titleOffset(null!=e.titleOffset?e.titleOffset:C.config.axis.titleOffset),r.tickValues(e.values||null),r.tickFormat(e.format||null),r.tickSubdivide(e.subdivide||0),r.tickPadding(e.tickPadding||C.config.axis.padding);var a=[];if(void 0!==e.tickSize)for(var o=0;3>o;++o)a.push(e.tickSize);else{var s=C.config.axis.tickSize;a=[s,s,s]}null!=e.tickSizeMajor&&(a[0]=e.tickSizeMajor),null!=e.tickSizeMinor&&(a[1]=e.tickSizeMinor),null!=e.tickSizeEnd&&(a[2]=e.tickSizeEnd),a.length&&r.tickSize.apply(r,a),r.tickCount(e.ticks||C.config.axis.ticks);var l=e.properties;l&&l.ticks?(r.majorTickProperties(l.majorTicks?C.extend({},l.ticks,l.majorTicks):l.ticks),r.minorTickProperties(l.minorTicks?C.extend({},l.ticks,l.minorTicks):l.ticks)):(r.majorTickProperties(l&&l.majorTicks||{}),r.minorTickProperties(l&&l.minorTicks||{})),r.tickLabelProperties(l&&l.labels||{}),r.titleProperties(l&&l.title||{}),r.gridLineProperties(l&&l.grid||{}),r.domainProperties(l&&l.axis||{})}var n={x:"bottom",y:"left",top:"top",bottom:"bottom",left:"left",right:"right"};return e}(),C.parse.background=function(t){return null==t?null:e.rgb(t)+""},C.parse.data=function(e,t){function n(e){return function(n,r){n?C.error("LOADING FAILED: "+e.url):i.load[e.name]=C.data.read(r.toString(),e.format),0===--a&&t()}}function r(e){1!==c[e]&&(c[e]||(c[e]=1,(i.source[e]||[]).forEach(r),(i.deps[e]||[]).forEach(r),c[e]=2,l.push(e)))}var i={defs:e,load:{},flow:{},deps:{},source:{},sorted:null},a=0;(e||[]).forEach(function(e){if(e.url?(a+=1,C.data.load(e.url,n(e))):e.values?i.load[e.name]=C.data.read(e.values,e.format):e.source&&(i.source[e.source]||(i.source[e.source]=[])).push(e.name),e.transform){var t=C.parse.dataflow(e);i.flow[e.name]=t,t.dependencies.forEach(function(t){(i.deps[t]||(i.deps[t]=[])).push(e.name)})}});for(var o,s=(e||[]).map(C.accessor("name")),l=[],c={};s.length;)2!==c[o=s.pop()]&&r(o);return i.sorted=l.reverse(),0===a&&setTimeout(t,1),i},C.parse.dataflow=function(e){var t=(e.transform||[]).map(C.parse.transform),n=t.length?function(e,n,r){return t.reduce(function(e,t){return t(e,n,r)},e)}:C.identity;return n.transforms=t,n.dependencies=C.keys((e.transform||[]).reduce(function(e,t){var n=C.data[t.type].dependencies;return n&&n.forEach(function(n){t[n]&&(e[t[n]]=1)}),e},{})),n},C.parse.expr=function(){var e=C.expression.parse,t=C.expression.code({idWhiteList:["d","index","data"]});return function(n){var r=t(e(n));return Function("d","index","data",'"use strict"; return ('+r+");")}}(),C.parse.legends=function(){function e(e,n,r){(e||[]).forEach(function(e,i){n[i]=n[i]||C.scene.legend(),t(e,i,n[i],r)})}function t(e,t,n,r){n.size(e.size?r[e.size]:null),n.shape(e.shape?r[e.shape]:null),n.fill(e.fill?r[e.fill]:null),n.stroke(e.stroke?r[e.stroke]:null),e.orient&&n.orient(e.orient),null!=e.offset&&n.offset(e.offset),n.title(e.title||null),n.values(e.values||null),n.format(void 0!==e.format?e.format:null);var i=e.properties;n.titleProperties(i&&i.title||{}),n.labelProperties(i&&i.labels||{}),n.legendProperties(i&&i.legend||{}),n.symbolProperties(i&&i.symbols||{}),n.gradientProperties(i&&i.gradient||{})}return e}(),C.parse.mark=function(e){var t=e.properties,n=e.marks;if(C.keys(t).forEach(function(n){t[n]=C.parse.properties(e.type,t[n])}),e.delay&&(e.delay=C.parse.properties(e.type,{delay:e.delay})),e.from){var r=e.from.data,i=C.parse.dataflow(e.from);e.from=function(e,t,n){var a=C.scene.data(r?e[r]:null,n);return i(a,e,t)}}return n&&(e.marks=n.map(C.parse.mark)),e},C.parse.marks=function(e,t,n){return{type:"group",width:t,height:n,scales:e.scales||[],axes:e.axes||[],legends:e.legends||[],marks:(e.marks||[]).map(C.parse.mark)}},C.parse.padding=function(e){if(null==e)return"auto";if(C.isString(e))return"strict"===e?"strict":"auto";if(C.isObject(e))return e;var t=C.isNumber(e)?e:20;return{top:t,left:t,right:t,bottom:t}},C.parse.properties=function(){function e(e,r){var i,a,o,s,l="",c=C.keys(r),u={};for(l+="var o = trans ? {} : item;\n",i=0,a=c.length;a>i;++i)s=r[o=c[i]],l+=i>0?"\n  ":"  ",l+="o."+o+" = "+n(o,s)+";",u[o]=!0;u.x2&&(u.x?(l+="\n  if (o.x > o.x2) { var t = o.x; o.x = o.x2; o.x2 = t; };",l+="\n  o.width = (o.x2 - o.x);"):l+=u.width?"\n  o.x = (o.x2 - o.width);":"\n  o.x = o.x2;"),u.xc&&(l+=u.width?"\n  o.x = (o.xc - o.width/2);":"\n  o.x = o.xc;"),u.y2&&(u.y?(l+="\n  if (o.y > o.y2) { var t = o.y; o.y = o.y2; o.y2 = t; };",l+="\n  o.height = (o.y2 - o.y);"):l+=u.height?"\n  o.y = (o.y2 - o.height);":"\n  o.y = o.y2;"),u.yc&&(l+=u.height?"\n  o.y = (o.yc - o.height/2);":"\n  o.y = o.yc;"),t(e,u)&&(l+="\n  item.touch();"),l+="\n  if (trans) trans.interpolate(item, o);";try{return Function("item","group","trans",l)}catch(d){C.error(d),C.log(l)}}function t(e,t){return t.path||("area"===e||"line"===e)&&(t.x||t.x2||t.width||t.y||t.y2||t.height||t.tension||t.interpolate)}function n(e,t){if(null==t)return null;var n="fill"===e||"stroke"===e;if(n){if(t.c)return r("hcl",t.h,t.c,t.l);if(t.h||t.s)return r("hsl",t.h,t.s,t.l);if(t.l||t.a)return r("lab",t.l,t.a,t.b);if(t.r||t.g||t.b)return r("rgb",t.r,t.g,t.b)}if(t.template)return C.parse.template.source(t.template,"item.datum");var a="item.datum.data";if(void 0!==t.value&&(a=C.str(t.value)),null!=t.group){var o="group.datum";C.isString(t.group)&&(o=i[t.group]?"group."+t.group:"group.datum["+C.field(t.group).map(C.str).join("][")+"]")}if(null!=t.field?C.isString(t.field)?(a="item.datum["+C.field(t.field).map(C.str).join("][")+"]",null!=t.group&&(a="this.accessor("+a+")("+o+")")):a="this.accessor(group.datum["+C.field(t.field.group).map(C.str).join("][")+"])(item.datum.data)":null!=t.group&&(a=o),null!=t.scale){var s=C.isString(t.scale)?C.str(t.scale):(t.scale.group?"group":"item")+".datum["+C.str(t.scale.group||t.scale.field)+"]";s="group.scales["+s+"]",a=s+(t.band?".rangeBand()":"("+a+")")}return a="("+(null!=t.mult?C.number(t.mult)+" * ":"")+a+")"+(t.offset?" + "+C.number(t.offset):"")}function r(e,t,r,i){var a=t?n("",t):C.config.color[e][0],o=r?n("",r):C.config.color[e][1],s=i?n("",i):C.config.color[e][2];return"(this.d3."+e+"("+[a,o,s].join(",")+') + "")'}var i={width:1,height:1,"mark.group.width":1,"mark.group.height":1};return e}(),C.parse.scales=function(){function t(e,t,r,i){return(e||[]).reduce(function(e,t){var a=t.name,o=a+":prev";return e[a]=n(t,e[a],r,i),e[o]=e[o]||e[a],e},t||{})}function n(e,t,n,o){var s=r(e,t),l=s.type===d?i:a,u=c(e,o),f=C.values(o.datum);return l(e,s,u,n,f),s}function r(t,n){var r=t.type||u;if(!n||r!==n.type){var i=C.config.scale[r]||e.scale[r];i||C.error("Unrecognized scale type: "+r),(n=i()).type=n.type||r,n.scaleName=t.name}return n}function i(e,t,n,r,i){var a,l,c,u,d=!1,f=e.padding||0,p=null==e.outerPadding?f:e.outerPadding;if(C.isObject(e.range)&&!C.isArray(e.range)&&(d=!0,u=e.range.fields||C.array(e.range),n=o(u,r,i)),l=e.sort&&!d,a=s(e,r,i,l),a&&t.domain(a),e.bandWidth){var h=e.bandWidth,g=a.length,m=n[0]||0,v=e.points?f*h:f*h*(g-1)+2*p;n=[m,m+(h*g+v)]}c="string"==typeof n[0],c||n.length>2||1===n.length||d?t.range(n):e.points&&(e.round||null==e.round)?t.rangeRoundPoints(n,f):e.points?t.rangePoints(n,f):e.round||null==e.round?t.rangeRoundBands(n,f,p):t.rangeBands(n,f,p)}function a(t,n,r,i,a){var o,c;o=t.type===g?s(t,i,a,!1):l(t,i,a),n.domain(o),"height"===t.range&&(r=r.reverse()),n[t.round&&n.rangeRound?"rangeRound":"range"](r),t.exponent&&t.type===p&&n.exponent(t.exponent),t.clamp&&n.clamp(!0),t.nice&&(t.type===h?(c=e.time[t.nice],c||C.error("Unrecognized interval: "+c),n.nice(c)):n.nice())}function o(e,t,n){return e.reduce(function(e,r){var i=C.values(t[r.data]||n),a=C.accessor(C.isString(r.field)?r.field:"data."+C.accessor(r.field.group)(n));return C.unique(i,a,e)},[])}function s(e,t,n,r){var i,a,s=e.domain;return C.isArray(s)?i=r?s.slice():s:C.isObject(s)&&(a=s.fields||C.array(s),i=o(a,t,n)),i&&r&&i.sort(C.cmp),i}function l(t,n,r){function i(t,i,a,o){var l=C.values(n[t.data]||r),c=C.array(t.field).map(function(e){return C.isString(e)?e:"data."+C.accessor(e.group)(r)});c.forEach(function(t){t=C.accessor(t),i&&(s[0]=e.min([s[0],e.min(l,t)])),a&&(s[o]=e.max([s[o],e.max(l,t)]))})}var a,o,s=[null,null];return void 0!==t.domain&&(C.isArray(t.domain)?s=t.domain.slice():C.isObject(t.domain)?(a=t.domain.fields||C.array(t.domain),a.forEach(function(e){i(e,1,1,1)})):s=t.domain),o=s.length-1,void 0!==t.domainMin&&(C.isObject(t.domainMin)?(s[0]=null,a=t.domainMin.fields||C.array(t.domainMin),a.forEach(function(e){i(e,1,0,o)})):s[0]=t.domainMin),void 0!==t.domainMax&&(C.isObject(t.domainMax)?(s[o]=null,a=t.domainMax.fields||C.array(t.domainMax),a.forEach(function(e){i(e,0,1,o)})):s[o]=t.domainMax),t.type===f||t.type===h||!t.zero&&void 0!==t.zero||(s[0]=Math.min(0,s[0]),s[o]=Math.max(0,s[o])),s}function c(e,t){var n=[null,null];if(void 0!==e.range)if("string"==typeof e.range)if(m[e.range])n=[0,t[e.range]];else{if(!C.config.range[e.range])return C.error("Unrecogized range: "+e.range),n;n=C.config.range[e.range]}else if(C.isArray(e.range))n=C.duplicate(e.range);else{if(C.isObject(e.range))return null;n=[0,e.range]}if(void 0!==e.rangeMin&&(n[0]=e.rangeMin),void 0!==e.rangeMax&&(n[n.length-1]=e.rangeMax),void 0!==e.reverse){var r=e.reverse;C.isObject(r)&&(r=C.accessor(r.field)(t.datum)),r&&(n=n.reverse())}return n}var u="linear",d="ordinal",f="log",p="pow",h="time",g="quantile",m={width:1,height:1};return t}(),C.parse.spec=function(t,n,r){function i(e){e=C.duplicate(e);var t=e.width||500,i=e.height||500,a=e.viewport||null,o={width:t,height:i,viewport:a,background:C.parse.background(e.background),padding:C.parse.padding(e.padding),marks:C.parse.marks(e,t,i),data:C.parse.data(e.data,function(){n(s)})},s=r(o)}r=r||C.ViewFactory,C.isObject(t)?i(t):e.json(t,function(e,t){e?C.error(e):i(t)})},C.parse.template=function(e){var t=C.parse.template.source(e,"d");t="var __t; return "+t+";";try{return new Function("d",t).bind(C)}catch(n){throw n.source=t,n}},C.parse.template.source=function(e,t){t=t||"obj";var n=0,r="'",i=F;return e.replace(i,function(i,a,o){return r+=e.slice(n,o).replace(B,H),n=o+i.length,a&&(r+="'\n+((__t=("+U(a,t)+"))==null?'':__t)+\n'"),i}),r+"'"};var U=function(t,n){function r(e){return e=e||"",o?(o=!1,s="String("+s+")"+e):s+=e,s}var i=t.split("|"),a=i.shift().trim(),o=!0,s=C.field(a).map(C.str).join("][");s=n+"["+s+"]";for(var l=0;l<i.length;++l){var c,u,d,f=i[l],p=null;switch((c=f.indexOf(":"))>0&&(f=f.slice(0,c),p=i[l].slice(c+1).split(",").map(function(e){return e.trim()})),f=f.trim()){case"length":r(".length");break;case"lower":r(".toLowerCase()");break;case"upper":r(".toUpperCase()");break;case"lower-locale":r(".toLocaleLowerCase()");break;case"upper-locale":r(".toLocaleUpperCase()");break;case"trim":r(".trim()");break;case"left":u=C.number(p[0]),r(".slice(0,"+u+")");break;case"right":u=C.number(p[0]),r(".slice(-"+u+")");break;case"mid":u=C.number(p[0]),d=u+C.number(p[1]),r(".slice(+"+u+","+d+")");break;case"slice":u=C.number(p[0]),r(".slice("+u+(p.length>1?","+C.number(p[1]):"")+")");break;case"truncate":u=C.number(p[0]),d=p[1],d="left"!==d&&"middle"!==d&&"center"!==d?"right":d,s="this.truncate("+r()+","+u+',"'+d+'")';break;case"number":u=G(p[0],e.format),o=!1,s="this.__formats["+u+"]("+s+")";break;case"time":u=G(p[0],e.time.format),o=!1,s="this.__formats["+u+"]("+s+")";break;default:throw Error("Unrecognized template filter: "+f)}}return s},F=/\{\{(.+?)\}\}|$/g,W={"'":"'","\\":"\\","\r":"r","\n":"n","\u2028":"u2028","\u2029":"u2029"},B=/\\|'|\r|\n|\u2028|\u2029/g,H=function(e){return"\\"+W[e]},X=[],q={},G=function(e,t){if(!("'"===e[0]&&"'"===e[e.length-1]||'"'!==e[0]&&'"'===e[e.length-1]))throw Error("Format pattern must be quoted: "+e);if(e=e.slice(1,-1),!q[e]){var n=t(e),r=X.length;X.push(n),q[e]=r}return q[e]};C.__formats=X,C.parse.transform=function(e){var t=C.data[e.type]();return C.keys(e).forEach(function(n){"type"!==n&&t[n](e[n])}),t},C.scene={},C.scene.GROUP="group",C.scene.ENTER=0,C.scene.UPDATE=1,C.scene.EXIT=2,C.scene.DEFAULT_DATA={sentinel:1},C.scene.data=function(e,t){var n=C.scene.DEFAULT_DATA;return e=C.values(e||t||[n]),e===n&&(e=[n]),e},C.scene.fontString=function(e){return(e.fontStyle?e.fontStyle+" ":"")+(e.fontVariant?e.fontVariant+" ":"")+(e.fontWeight?e.fontWeight+" ":"")+(null!=e.fontSize?e.fontSize:C.config.render.fontSize)+"px "+(e.font||C.config.render.font)},C.scene.Item=function(){function e(e){this.mark=e}var t=e.prototype;return t.hasPropertySet=function(e){var t=this.mark.def.properties;return t&&null!=t[e]},t.cousin=function(e,t){if(0===e)return this;e=e||-1;var n=this.mark,r=n.group,i=null==t?n.items.indexOf(this):t,a=r.items.indexOf(n)+e;return r.items[a].items[i]},t.sibling=function(e){if(0===e)return this;e=e||-1;var t=this.mark,n=t.items.indexOf(this)+e;return t.items[n]},t.remove=function(){var e=this,t=e.mark.items,n=t.indexOf(e);return n>=0&&(n===t.length-1?t.pop():t.splice(n,1)),e},t.touch=function(){this.pathCache&&(this.pathCache=null),this.mark.pathCache&&(this.mark.pathCache=null)},e}(),C.scene.item=function(e){return new C.scene.Item(e)},C.scene.visit=function(e,t){var n,r,i,a,o;if(t(e))return!0;var s=["items","axisItems","legendItems"];for(i=0,a=s.length;a>i;++i)if(o=e[s[i]])for(n=0,r=o.length;r>n;++n)if(C.scene.visit(o[n],t))return!0},C.scene.build=function(){function t(e,t,o,l,c){var u=C.scene.data(e.from?e.from(t,o,l):null,l);return o=n(e,o),o.items=r(e,u,o),a(e,o),e.type===s&&i(e,t,o,c),o}function n(e,t){return t=t||{},t.def=e,t.marktype=e.type,t.interactive=!(e.interactive===!1),t}function r(e,t,n){var r,i,a,s,d,f,p=o(e.key),h=n.items||[],g=[],m={};for(r=0,a=h.length;a>r;++r)s=h[r],s.status=u,p&&(m[s.key]=s);for(r=0,a=t.length;a>r;++r)d=t[r],i=r,s=p?m[i=p(d)]:h[r],f=s?!1:(s=C.scene.item(n),!0),s.status=f?l:c,s.datum=d,s.key=i,g.push(s);for(r=0,a=h.length;a>r;++r)s=h[r],s.status===u&&(s.key=p?s.key:g.length,g.splice(s.index,0,s));return g}function i(e,n,r,i){var a,o,s,l,c,u,d=r.items,f=e.marks;for(a=0,o=d.length;o>a;++a){if(u=d[a],!i&&u.scales)for(c in u.scales)c.indexOf(":prev")<0&&(u.scales[c+":prev"]=u.scales[c].copy());for(u.items=u.items||[],s=0,l=f.length;l>s;++s)u.items[s]=t(f[s],n,u.items[s],u.datum),u.items[s].group=u}}function a(t,n){if(t.duration&&(n.duration=t.duration),t.ease&&(n.ease=e.ease(t.ease)),t.delay){var r,i=n.items,a=n.group,o=i.length;for(r=0;o>r;++r)t.delay.call(this,i[r],a)}}function o(e){if(null==e)return null;var t=C.array(e).map(C.accessor);return function(e){for(var n="",r=0,i=t.length;i>r;++r)r>0&&(n+="|"),n+=String(t[r](e));return n}}var s=C.scene.GROUP,l=C.scene.ENTER,c=C.scene.UPDATE,u=C.scene.EXIT;return t}(),C.scene.bounds=function(){function t(){return w||(w=(C.config.isNode?new(require("canvas"))(1,1):e.select("body").append("canvas").attr("class","vega_hidden").attr("width",1).attr("height",1).style("display","none").node()).getContext("2d"))}function n(e,t,n){return null==t?n.set(0,0,0,0):(m(t,n),e.stroke&&0!==e.opacity&&e.strokeWidth>0&&n.expand(e.strokeWidth)),n}function r(e,t){var r=e.path?e.pathCache||(e.pathCache=g(e.path)):null;return n(e,r,t)}function i(e,t){var r=e.mark.items,e=r[0],i=e.pathCache||(e.pathCache=g(v(r)));return n(r[0],i,t)}function a(e,t){var r=e.mark.items,e=r[0],i=e.pathCache||(e.pathCache=g(y(r)));return n(r[0],i,t)}function o(e,t){var n=e.x||0,r=e.y||0,i=n+e.width||0,a=r+e.height||0;return t.set(n,r,i,a),e.stroke&&0!==e.opacity&&e.strokeWidth>0&&t.expand(e.strokeWidth),t}function s(e,t){var n=e.width||0,r=e.height||0,i=(e.x||0)-("center"===e.align?n/2:"right"===e.align?n:0),a=(e.y||0)-("middle"===e.baseline?r/2:"bottom"===e.baseline?r:0);return t.set(i,a,i+n,a+r)}function l(e,t){var n,r;return t.set(n=e.x||0,r=e.y||0,null!=e.x2?e.x2:n,null!=e.y2?e.y2:r),e.stroke&&0!==e.opacity&&e.strokeWidth>0&&t.expand(e.strokeWidth),t}function c(e,t){var n,r,i,a,o,s,l,c,u,d=e.x||0,f=e.y||0,p=e.innerRadius||0,h=e.outerRadius||0,g=(e.startAngle||0)-b,m=(e.endAngle||0)-b,v=1/0,y=-1/0,x=1/0,k=-1/0,w=[g,m],S=g-g%b;for(r=0;4>r&&m>S;++r,S+=b)w.push(S);for(r=0,i=w.length;i>r;++r)n=w[r],a=Math.cos(n),s=p*a,c=h*a,o=Math.sin(n),l=p*o,u=h*o,v=Math.min(v,s,c),y=Math.max(y,s,c),x=Math.min(x,l,u),k=Math.max(k,l,u);return t.set(d+v,f+x,d+y,f+k),e.stroke&&0!==e.opacity&&e.strokeWidth>0&&t.expand(e.strokeWidth),t}function u(e,t){var n,r,i,a,o=null!=e.size?e.size:100,s=e.x||0,l=e.y||0;switch(e.shape){case"cross":n=Math.sqrt(o/5)/2,r=3*n,t.set(s-r,l-n,s+r,l+n);break;case"diamond":a=Math.sqrt(o/(2*k)),i=a*k,t.set(s-i,l-a,s+i,l+a);break;case"square":r=Math.sqrt(o),n=r/2,t.set(s-n,l-n,s+n,l+n);break;case"triangle-down":i=Math.sqrt(o/x),a=i*x/2,t.set(s-i,l-a,s+i,l+a);break;case"triangle-up":i=Math.sqrt(o/x),a=i*x/2,t.set(s-i,l-a,s+i,l+a);break;default:n=Math.sqrt(o/Math.PI),t.set(s-n,l-n,s+n,l+n)}return e.stroke&&0!==e.opacity&&e.strokeWidth>0&&t.expand(e.strokeWidth),t}function d(e,n,r){var i,a,o=(e.x||0)+(e.dx||0),s=(e.y||0)+(e.dy||0),l=e.fontSize||C.config.render.fontSize,c=e.align,u=e.baseline,d=e.radius||0,f=t();return f.font=C.scene.fontString(e),f.textAlign=c||"left",f.textBaseline=u||"alphabetic",i=f.measureText(e.text||"").width,d&&(a=(e.theta||0)-Math.PI/2,o+=d*Math.cos(a),s+=d*Math.sin(a)),"center"===c?o-=i/2:"right"===c&&(o-=i),"top"===u?s+=l/5:"bottom"===u?s-=l:"middle"===u?s=s-l/2+l/10:s-=4*l/5,n.set(o,s,o+i,s+l),e.angle&&!r&&n.rotate(e.angle*Math.PI/180,e.x||0,e.y||0),n.expand(r?0:1)}function f(e,t,n){var r,i,a=e.axisItems||[],o=e.legendItems||[];for(r=0,i=a.length;i>r;++r)t.union(a[r].bounds);for(r=0,i=e.items.length;i>r;++r)t.union(e.items[r].bounds);if(n){for(r=0,i=o.length;i>r;++r)t.union(o[r].bounds);null!=e.width&&null!=e.height&&t.add(e.width,e.height),null!=e.x&&null!=e.y&&t.add(0,0)}return t.translate(e.x||0,e.y||0),t}function p(e,t,n){t=t||S[e.mark.marktype],e.bounds_prev||(e["bounds:prev"]=new C.Bounds);var r=e.bounds,i=e["bounds:prev"];return r&&i.clear().union(r),e.bounds=t(e,r?r.clear():new C.Bounds,n),r||i.clear().union(e.bounds),e.bounds}function h(e,t,n){t=t||e.bounds&&e.bounds.clear()||new C.Bounds;var r,i,a=e.marktype,o=S[a],s=e.items;if("area"===a||"line"===a)s.length&&(s[0].bounds=o(s[0],t));else for(r=0,i=s.length;i>r;++r)t.union(p(s[r],o,n));e.bounds=t}var g=C.canvas.path.parse,m=C.canvas.path.bounds,v=C.canvas.path.area,y=C.canvas.path.line,b=Math.PI/2,x=Math.sqrt(3),k=Math.tan(30*Math.PI/180),w=null,S={group:f,symbol:u,image:s,rect:o,rule:l,arc:c,text:d,path:r,area:i,line:a};return{mark:h,item:p,text:d,group:f}}(),C.scene.encode=function(){function e(e,r,i,a,o){return a&&o?t.call(this,e,r,i,a,o):n.call(this,e,e,r,i,a),e}function t(e,t,n,r,i){i=C.array(i);var a,o,s,l,c,u;for(a=0,o=i.length;o>a;++a)s=i[a],l=s.mark.group||null,c=s.mark.def.properties,u=c&&c[r],u&&(u.call(C,s,l,n),C.scene.bounds.item(s))}function n(e,t,n,r,s){a.call(this,e,t.items,n,r,s),t.marktype===o?i.call(this,t,n,e,r,s):C.scene.bounds.mark(t)}function r(e,t,n,r,o){i.call(this,t,n,e,r,o),a.call(this,e,t.items,n,r,o),C.scene.bounds.mark(t,null,!0)}function i(e,t,i,a,o){var s,l,c,u,d,f,p,h,g,m,v,y;for(s=0,l=e.items.length;l>s;++s)for(d=e.items[s],f=d.scales||(d.scales=t.scales?C.extend({},i.scales):i.scales),t.scales&&C.parse.scales(t.scales,f,this._data,d),t.axes&&(p=d.axes||(d.axes=[]),h=d.axisItems||(d.axisItems=[]),C.parse.axes(t.axes,p,d.scales),p.forEach(function(e,t){g=e.def(),h[t]=C.scene.build(g,this._data,h[t],null,1),h[t].group=d,n.call(this,d,d.axisItems[t],g,a)})),c=0,u=d.items.length;u>c;++c)n.call(this,d,d.items[c],t.marks[c],a,o);if(C.scene.bounds.mark(e,null,!t.legends),t.legends){for(s=0,l=e.items.length;l>s;++s)d=e.items[s],m=d.legends||(d.legends=[]),v=d.legendItems||(d.legendItems=[]),C.parse.legends(t.legends,m,d.scales),m.forEach(function(e,t){y=e.def(),v[t]=C.scene.build(y,this._data,v[t],null,1),v[t].group=d,r.call(this,d,d.legendItems[t],y,a)});C.scene.bounds.mark(e,null,!0)}}function a(e,t,n,r,i){var a,o,d,f,p=n.properties||u,h=p.enter,g=p.update,m=p.exit;if(i){if(f=p[i])for(a=0,o=t.length;o>a;++a)f.call(C,t[a],e,r)}else for(a=0;a<t.length;++a)d=t[a],d.status===s&&(h&&h.call(C,d,e),d.status=l),d.status!==c&&g&&g.call(C,d,e,r),d.status===c&&(m&&m.call(C,d,e,r),r&&!m?r.interpolate(d,u):r||t[a--].remove())}var o=C.scene.GROUP,s=C.scene.ENTER,l=C.scene.UPDATE,c=C.scene.EXIT,u={};return e}(),C.scene.Transition=function(){function t(t,n){this.duration=t||500,this.ease=n&&e.ease(n)||e.ease("cubic-in-out"),this.updates={next:null}}function n(e){for(var t,n,r,i,a,o,s=this.updates,l=s,c=l.next,u=this.duration,d=!0;null!=c;l=c,c=l.next)if(t=c.item,n=t.delay||0,r=(e-n)/u,0>r)d=!1;else{for(r>1&&(r=1),i=c.ease(r),a=0,o=c.length;o>a;++a)t[c[a].property]=c[a](i);t.touch(),C.scene.bounds.item(t),1===r?(c.remove&&t.remove(),l.next=c.next,c=l):d=!1}return this.callback(),d}var r=t.prototype,i={text:1,url:1};return r.interpolate=function(t,n){var r,a,o,s,l=null;for(r in n)a=t[r],o=n[r],a!==o&&(i[r]||void 0===a?t[r]=o:"number"!=typeof a||isFinite(a)?(s=e.interpolate(a,o),s.property=r,(l||(l=[])).push(s)):t[r]=o);return null===l&&t.status===C.scene.EXIT&&(l=[]),null!=l&&(l.item=t,l.ease=t.mark.ease||this.ease,l.next=this.updates.next,this.updates.next=l),this},r.start=function(t){for(var r=this,i=r.updates,a=i.next;null!=a;i=a,a=i.next)a.item.status===C.scene.EXIT&&(a.remove=!0);r.callback=t,e.timer(function(e){return n.call(r,e)})},t}(),C.scene.transition=function(e,t){return new C.scene.Transition(e,t)},C.scene.axis=function(){function t(){u=null}function n(){return M||("log"===o.type?".1s":null)}function r(){var t=n();return o.tickFormat?o.tickFormat(P,t):t?"time"===o.type?e.time.format(t):e.format(t):String}function i(e){var t={major:L,minor:null};return null==t.major&&(t.major=o.ticks?o.ticks(P):o.domain()),t.minor=d(o,t.major,N).map(C.data.ingest),t.major=t.major.map(function(t){return t=C.data.ingest(t),t.label=e(t.data),t}),t}function a(e){var t,n,r;"ordinal"===e.type?(t={scale:e.scaleName,offset:.5+e.rangeBand()/2},n=t):(t={scale:e.scaleName,offset:.5},n={scale:e.scaleName+":prev",offset:.5}),r=p(e);var i=b(),a=b(),o=b(),l=x(),u=w(),d=k();i.properties.enter.stroke={value:C.config.axis.gridColor},g(s,i,n,t,1/0),g(s,a,n,t,O),g(s,o,n,t,E),h(s,l,n,t,O,A),v(s,u,r,T),m(s,d,r,c),C.extend(i.properties.update,I),C.extend(a.properties.update,D),C.extend(o.properties.update,z),C.extend(l.properties.update,R),C.extend(u.properties.update,U),C.extend(d.properties.update,j);var f=[i,a,o,l,u,d];return{type:"group",interactive:!1,properties:{enter:y,update:y},marks:f.map(C.parse.mark)}}var o,s=C.config.axis.orient,l=0,c=C.config.axis.titleOffset,u=null,f="front",S=!1,_=null,O=C.config.axis.tickSize,E=C.config.axis.tickSize,T=C.config.axis.tickSize,A=C.config.axis.padding,L=null,M=null,N=0,P=C.config.axis.ticks,I={},R={},D={},z={},j={},U={},F={};return F.def=function(){var e=u?u:u=a(o),t=r(),n=i(t),c=_?[_].map(C.data.ingest):[];return e.marks[0].from=function(){return S?n.major:[]},e.marks[1].from=function(){return n.major},e.marks[2].from=function(){return n.minor},e.marks[3].from=e.marks[1].from,e.marks[4].from=function(){return[1]},e.marks[5].from=function(){return c},e.offset=l,e.orient=s,e.layer=f,e},F.scale=function(e){return arguments.length?(o!==e&&(o=e,t()),F):o},F.orient=function(e){return arguments.length?(s!==e&&(s=e in Y?e+"":C.config.axis.orient,t()),F):s},F.title=function(e){return arguments.length?(_!==e&&(_=e,t()),F):_},F.tickCount=function(e){return arguments.length?(P=e,F):P},F.tickValues=function(e){return arguments.length?(L=e,F):L},F.tickFormat=function(e){return arguments.length?(M!==e&&(M=e,t()),F):M},F.tickSize=function(e,n){if(!arguments.length)return O;var r=arguments.length-1,i=+e,a=r>1?+n:O,o=r>0?+arguments[r]:O;return(O!==i||E!==a||T!==o)&&t(),O=i,E=a,T=o,F},F.tickSubdivide=function(e){return arguments.length?(N=+e,F):N},F.offset=function(e){return arguments.length?(l=C.isObject(e)?e:+e,F):l},F.tickPadding=function(e){return arguments.length?(A!==+e&&(A=+e,t()),F):A},F.titleOffset=function(e){return arguments.length?(c!==+e&&(c=+e,t()),F):c},F.layer=function(e){return arguments.length?(f!==e&&(f=e,t()),F):f},F.grid=function(e){return arguments.length?(S!==e&&(S=e,t()),F):S},F.gridLineProperties=function(e){return arguments.length?(I!==e&&(I=e),F):I},F.majorTickProperties=function(e){return arguments.length?(D!==e&&(D=e),F):D},F.minorTickProperties=function(e){return arguments.length?(z!==e&&(z=e),F):z},F.tickLabelProperties=function(e){return arguments.length?(R!==e&&(R=e),F):R},F.titleProperties=function(e){return arguments.length?(j!==e&&(j=e),F):j},F.domainProperties=function(e){return arguments.length?(U!==e&&(U=e),F):U},F.reset=function(){t()},F};var Y={top:1,right:1,bottom:1,left:1},K={bottom:"center",top:"center",left:"right",right:"left"},V={bottom:"top",top:"bottom",left:"middle",right:"middle"};C.scene.legend=function(){function t(){s=null}function n(e){return"ordinal"===e||"quantize"===e||"quantile"===e||"threshold"===e}function r(t){var n,r,a,o=i(l,c,u,d),s=(null==p?t.ticks?t.ticks.apply(t,x):t.domain():p).map(C.data.ingest),g=null==h?t.tickFormat?t.tickFormat.apply(t,x):String:h,v=5,y=e.range(s.length);l?(r=s.map(function(e){return Math.sqrt(l(e.data))}),a=e.max(r),r=r.reduce(function(e,t,n,r){return n>0&&(e[n]=e[n-1]+r[n-1]/2+v),e[n]+=t/2,e},[0]).map(Math.round)):(a=Math.round(Math.sqrt(C.config.legend.symbolSize)),r=f||(n=P.fontSize)&&n.value+v||C.config.legend.labelFontSize+v,r=y.map(function(e,t){return Math.round(a/2+t*r)}));var k,w=b;m&&(k=N.fontSize,w+=5+(k&&k.value||C.config.legend.titleFontSize));for(var S=0,_=r.length;_>S;++S)r[S]+=w;var t={name:"legend",type:"ordinal",points:!0,domain:y,range:r},O=(m?[m]:[]).map(C.data.ingest);return s.forEach(function(e){e.label=g(e.data),e.offset=a}),o.scales=[t],o.marks[0].from=function(){return O},o.marks[1].from=function(){return s},o.marks[2].from=o.marks[1].from,o}function i(e,t,n,r){var i=O(),a=E(),o=T();return _(a,e,t,n,r),C.extend(i.properties.update,N),C.extend(a.properties.update,w),C.extend(o.properties.update,P),i.properties.enter.x.value+=b,i.properties.enter.y.value+=b,o.properties.enter.x.offset+=b+1,a.properties.enter.x.offset=b+1,o.properties.update.x.offset+=b+1,a.properties.update.x.offset=b+1,{type:"group",interactive:!1,properties:{enter:C.parse.properties("group",k),update:S},marks:[i,a,o].map(C.parse.mark)}}function a(e){var t=o(e),n=e.domain(),r=n.map(C.data.ingest),i=M.width&&M.width.value||C.config.legend.gradientWidth,a=null==h?e.tickFormat?e.tickFormat.apply(e,x):String:h,s={name:"legend",type:e.type,round:!0,zero:!1,domain:[n[0],n[n.length-1]],range:[b,i+b]};"pow"===e.type&&(s.exponent=e.exponent());var l=(m?[m]:[]).map(C.data.ingest);return r.forEach(function(e,t){e.label=a(e.data),e.align=t==r.length-1?"right":0==t?"left":"center"}),t.scales=[s],t.marks[0].from=function(){return l},t.marks[1].from=function(){return[1]},t.marks[2].from=function(){return r},t}function o(e){var t=O(),n=A(),r=L(),i=new C.Gradient,a=e.domain(),o=a[0],s=a[a.length-1],l=e.copy().domain([o,s]).range([0,1]),c="linear"!==e.type&&e.ticks?e.ticks.call(e,15):a;o!==c[0]&&c.unshift(o),s!==c[c.length-1]&&c.push(s);for(var u=0,d=c.length;d>u;++u)i.stop(l(c[u]),e(c[u]));n.properties.enter.fill={value:i},C.extend(t.properties.update,N),C.extend(n.properties.update,M),C.extend(r.properties.update,P);var f=n.properties,p=M.height,h=p&&p.value||f.enter.height.value;if(r.properties.enter.y.value=h,r.properties.update.y.value=h,m){var g=t.properties,v=N.fontSize,y=4+(v&&v.value||g.enter.fontSize.value);n.properties.enter.y.value+=y,r.properties.enter.y.value+=y,n.properties.update.y.value+=y,r.properties.update.y.value+=y}return t.properties.enter.x.value+=b,t.properties.enter.y.value+=b,n.properties.enter.x.value+=b,n.properties.enter.y.value+=b,r.properties.enter.y.value+=b,n.properties.update.x.value+=b,n.properties.update.y.value+=b,r.properties.update.y.value+=b,{type:"group",interactive:!1,properties:{enter:C.parse.properties("group",k),update:S},marks:[t,n,r].map(C.parse.mark)}}var s,l=null,c=null,u=null,d=null,f=null,p=null,h=null,g=null,m=void 0,v="right",y=C.config.legend.offset,b=C.config.legend.padding,x=[5],k={},w={},M={},N={},P={},I={},s=null;return I.def=function(){var t=l||c||u||d;return h=g?"time"===t.type?e.time.format(g):e.format(g):null,s||(s=t!==u&&t!==d||n(t.type)?r(t):a(t)),s.orient=v,s.offset=y,s.padding=b,s},I.size=function(e){return arguments.length?(l!==e&&(l=e,t()),I):l},I.shape=function(e){return arguments.length?(c!==e&&(c=e,t()),I):c},I.fill=function(e){return arguments.length?(u!==e&&(u=e,t()),I):u},I.stroke=function(e){return arguments.length?(d!==e&&(d=e,t()),I):d},I.title=function(e){return arguments.length?(m!==e&&(m=e,t()),I):m},I.format=function(e){return arguments.length?(g!==e&&(g=e,t()),I):g},I.spacing=function(e){return arguments.length?(f!==+e&&(f=+e,t()),I):f},I.orient=function(e){return arguments.length?(v=e in Q?e+"":C.config.legend.orient,I):v},I.offset=function(e){return arguments.length?(y=+e,I):y},I.values=function(e){return arguments.length?(p=e,I):p},I.legendProperties=function(e){return arguments.length?(k=e,I):k},I.symbolProperties=function(e){return arguments.length?(w=e,I):w},I.gradientProperties=function(e){return arguments.length?(M=e,I):M},I.labelProperties=function(e){return arguments.length?(P=e,I):P},I.titleProperties=function(e){return arguments.length?(N=e,I):N},I.reset=function(){t()},I};var Q={right:1,left:1};return C.Model=function(){function e(){this._defs=null,this._data={},this._scene=null,this._reset={axes:!1,legends:!1}}var t=e.prototype;return t.defs=function(e){return arguments.length?(this._defs=e,this):this._defs},t.data=function(e){function t(e){(s[e]||[]).forEach(function(n){a[n]=e,t(n)})}if(!arguments.length)return this._data;var n,r,i,a={},o=this._defs,s=o.data.source,c=o.data.flow||{},d=o.data.sorted,f=d.length;for(C.keys(e).forEach(t),n=0;f>n;++n){if(e[r=d[n]])i=e[r];else{if(!a[r])continue;i=u(this._data[a[r]]),C.isTree(e)&&l(i)}this._data[r]=c[r]?c[r](i,this._data,o.marks):i}return this._reset.legends=!0,this},t.width=function(e){return this._defs&&(this._defs.width=e),this._defs&&this._defs.marks&&(this._defs.marks.width=e),this._scene&&(this._scene.items[0].width=e),this._reset.axes=!0,this},t.height=function(e){return this._defs&&(this._defs.height=e),this._defs&&this._defs.marks&&(this._defs.marks.height=e),this._scene&&(this._scene.items[0].height=e),this._reset.axes=!0,this},t.scene=function(e){return arguments.length?(this._scene=e,this):this._scene},t.build=function(){var e=this,t=e._data,n=e._defs.marks;return e._scene=C.scene.build.call(e,n,t,e._scene),e._scene.items[0].width=n.width,e._scene.items[0].height=n.height,e._scene.interactive=!1,this},t.encode=function(e,t,n){this.reset();var r=this,i=r._scene,a=r._defs;return C.scene.encode.call(r,i,a.marks,e,t,n),this
},t.reset=function(){return this._scene&&this._reset.axes&&(C.scene.visit(this._scene,function(e){e.axes&&e.axes.forEach(function(e){e.reset()})}),this._reset.axes=!1),this._scene&&this._reset.legends&&(C.scene.visit(this._scene,function(e){e.legends&&e.legends.forEach(function(e){e.reset()})}),this._reset.legends=!1),this},e}(),C.View=function(){var t=function(e,t,n){this._el=null,this._build=!1,this._model=new C.Model,this._width=this.__width=t||500,this._height=this.__height=n||500,this._bgcolor=null,this._autopad=1,this._padding={top:0,left:0,bottom:0,right:0},this._viewport=null,this._renderer=null,this._handler=null,this._io=C.canvas,e&&this.initialize(e)},n=t.prototype;return n.width=function(e){return arguments.length?(this.__width!==e&&(this._width=this.__width=e,this._el&&this.initialize(this._el.parentNode),this._model.width(e),this._strict&&(this._autopad=1)),this):this.__width},n.height=function(e){return arguments.length?(this.__height!==e&&(this._height=this.__height=e,this._el&&this.initialize(this._el.parentNode),this._model.height(this._height),this._strict&&(this._autopad=1)),this):this.__height},n.background=function(e){return arguments.length?(this._bgcolor!==e&&(this._bgcolor=e,this._el&&this.initialize(this._el.parentNode)),this):this._bgcolor},n.padding=function(e){return arguments.length?(this._padding!==e&&(C.isString(e)?(this._autopad=1,this._padding={top:0,left:0,bottom:0,right:0},this._strict="strict"===e):(this._autopad=0,this._padding=e,this._strict=!1),this._el&&(this._renderer.resize(this._width,this._height,e),this._handler.padding(e))),this):this._padding},n.autopad=function(e){if(this._autopad<1)return this;this._autopad=0;var t=this._padding,n=this.model().scene().bounds,r=C.config.autopadInset,i=n.x1<0?Math.ceil(-n.x1)+r:0,a=n.y1<0?Math.ceil(-n.y1)+r:0,o=n.x2>this._width?Math.ceil(+n.x2-this._width)+r:0,n=n.y2>this._height?Math.ceil(+n.y2-this._height)+r:0;return t={left:i,top:a,right:o,bottom:n},this._strict?(this._autopad=0,this._padding=t,this._width=Math.max(0,this.__width-(i+o)),this._height=Math.max(0,this.__height-(a+n)),this._model.width(this._width),this._model.height(this._height),this._el&&this.initialize(this._el.parentNode),this.update({props:"enter"}).update({props:"update"})):this.padding(t).update(e),this},n.viewport=function(e){return arguments.length?(this._viewport!==e&&(this._viewport=e,this._el&&this.initialize(this._el.parentNode)),this):this._viewport},n.renderer=function(e){return arguments.length?("canvas"===e&&(e=C.canvas),"svg"===e&&(e=C.svg),this._io!==e&&(this._io=e,this._renderer=null,this._el&&this.initialize(this._el.parentNode),this._build&&this.render()),this):this._io},n.defs=function(e){return arguments.length?(this._model.defs(e),this):this._model.defs()},n.data=function(e){if(!arguments.length)return this._model.data();var t=C.keys(e).reduce(function(t,n){return t[n]=C.data.ingestAll(e[n]),t},{});return this._model.data(t),this._build=!1,this},n.model=function(e){return arguments.length?(this._model!==e&&(this._model=e,this._handler&&this._handler.model(e)),this):this._model},n.initialize=function(t){var n,r=this,i=r._width,a=r._height,o=r._bgcolor,s=r._padding;return e.select(t).select("div.vega").remove(),this._el=t=e.select(t).append("div").attr("class","vega").style("position","relative").node(),r._viewport&&e.select(t).style("width",(r._viewport[0]||i)+"px").style("height",(r._viewport[1]||a)+"px").style("overflow","auto"),r._renderer=(r._renderer||new this._io.Renderer).initialize(t,i,a,s,o),n=r._handler,r._handler=(new this._io.Handler).initialize(t,s,r).model(r._model),n&&n.handlers().forEach(function(e){r._handler.on(e.type,e.handler)}),this},n.render=function(e){return this._renderer.render(this._model.scene(),e),this},n.on=function(){return this._handler.on.apply(this._handler,arguments),this},n.off=function(){return this._handler.off.apply(this._handler,arguments),this},n.update=function(e){e=e||{};var t=this,n=e.duration?C.scene.transition(e.duration,e.ease):null;return t._build=t._build||(t._model.build(),!0),t._model.encode(n,e.props,e.items),n?n.start(function(e){t._renderer.render(t._model.scene(),e)}):t.render(e.items),t.autopad(e)},t}(),C.ViewFactory=function(e){return function(t){t=t||{};var n=(new C.View).width(e.width).height(e.height).background(e.background).padding(e.padding).viewport(e.viewport).renderer(t.renderer||"canvas").defs(e);return e.data.load&&n.data(e.data.load),t.data&&n.data(t.data),t.el&&n.initialize(t.el),t.hover!==!1&&n.on("mouseover",function(e,t){t.hasPropertySet("hover")&&this.update({props:"hover",items:t})}).on("mouseout",function(e,t){t.hasPropertySet("hover")&&this.update({props:"update",items:t})}),n}},C.Spec=function(){var e=function(e){this.spec={width:500,height:500,padding:0,data:[],scales:[],axes:[],marks:[]},e&&C.extend(this.spec,e)},t=e.prototype;return t.width=function(e){return this.spec.width=e,this},t.height=function(e){return this.spec.height=e,this},t.padding=function(e){return this.spec.padding=e,this},t.viewport=function(e){return this.spec.viewport=e,this},t.data=function(e,t){return t?t.name=e:t=C.isString(e)?{name:e}:e,this.spec.data.push(t),this},t.scale=function(e,t){return t?t.name=e:t=C.isString(e)?{name:e}:e,this.spec.scales.push(t),this},t.axis=function(e){return this.spec.axes.push(e),this},t.mark=function(e,t){t?t.type=e:t={type:e},t.properties={},this.spec.marks.push(t);var n=this;return{from:function(e,n){return t.from=n?(n.data=e,n):C.isString(e)?{data:e}:e,this},prop:function(e,n){return t.properties[e]=C.keys(n).reduce(function(e,t){var r=n[t];return e[t]=C.isObject(r)?r:{value:r},e},{}),this},done:function(){return n}}},t.parse=function(e){C.parse.spec(this.spec,e)},t.json=function(){return this.spec},e}(),C.spec=function(e){return new C.Spec(e)},C.headless={},C.headless.canvas=C.canvas.Renderer,C.headless.svg=function(){function t(e,t,n){var r="<"+e;if(t)for(var i in t){var a=t[i];null!=a&&(r+=" "+i+'="'+a+'"')}return n&&(r+=" "+n),r+">"}function n(e){return"</"+e+">"}function r(e){return e=null==e?"":String(e),e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}function i(e){return String(e).replace(/\"/g,"'")}function a(e){var r=e.width||0,i=e.height||0;return 0===r&&0===i?"":t("rect",{"class":"background",width:r,height:i},S(e,"rect"))+n("rect")}function o(e,t){var n=e.x||0,r=e.y||0,i={transform:"translate("+n+","+r+")"};if(e.clip){var a={width:e.width||0,height:e.height||0},o=e.clip_id||(e.clip_id="clip"+I++);t.clipping[o]=a,i["clip-path"]="url(#"+o+")"}return i}function s(e){var t=e.x||0,n=e.y||0;return{transform:"translate("+t+","+n+")",d:A(e)}}function l(e){if(e.length){var t=e[0],n="horizontal"===t.orient?M:L;return n.interpolate(t.interpolate||"linear").tension(null==t.tension?.7:t.tension),{d:n(e)}}}function c(e){if(e.length){var t=e[0];return N.interpolate(t.interpolate||"linear").tension(null==t.tension?.7:t.tension),{d:N(e)}}}function u(e){var t=e.x||0,n=e.y||0;return{transform:"translate("+t+","+n+")",d:e.path}}function d(e){return{x:e.x||0,y:e.y||0,width:e.width||0,height:e.height||0}}function f(e){var t=e.x||0,n=e.y||0;return{x1:t,y1:n,x2:null!=e.x2?e.x2:t,y2:null!=e.y2?e.y2:n}}function p(e){var t=e.x||0,n=e.y||0;return{transform:"translate("+t+","+n+")",d:P(e)}}function h(e){var t=e.width||e.image&&e.image.width||0,n=e.height||e.image&&e.image.height||0,r=e.x-("center"===e.align?t/2:"right"===e.align?t:0),i=e.y-("middle"===e.baseline?n/2:"bottom"===e.baseline?n:0),a=C.config.baseURL+e.url;return{"xlink:href":a,x:r,y:i,width:t,height:n}}function g(e){var t=e.x||0,n=e.y||0,r=e.dx||0,i=e.dy||0,a=e.angle||0,o=e.radius||0,s=R[e.align||"left"],l="top"===e.baseline?".9em":"middle"===e.baseline?".35em":0;if(o){var c=(e.theta||0)-Math.PI/2;t+=o*Math.cos(c),n+=o*Math.sin(c)}return{x:t+r,y:n+i,"text-anchor":s,transform:a?"rotate("+a+" "+t+","+n+")":null,dy:l?l:null}}function m(e){var t="type-"+e.type;return e.name&&(t+=" "+e.name),t}function v(e){return e.x||0}function y(e){return e.y||0}function b(e){return e.x+e.width||0}function x(e){return e.y+e.height||0}function k(e){return null==e.size?100:e.size}function w(e){return e.shape||"circle"}function S(e,t,n){var r,i,a,o,s,l=e.mark?e:e.length?e[0]:null;if(null===l)return null;var c="";for(r=0,i=z.length;i>r;++r)a=z[r],o=D[a],s=l[a],null==s?"fill"===o&&(c+="fill:none;"):(s.id&&(n.gradient[s.id]=s,s="url("+window.location.href+"#"+s.id+")"),c+=o+":"+s+";");return"text"===t&&(c+="font:"+_(l)),c.length?'style="'+c+'"':null}function _(e){var t=(e.fontStyle?e.fontStyle+" ":"")+(e.fontVariant?e.fontVariant+" ":"")+(e.fontWeight?e.fontWeight+" ":"")+(null!=e.fontSize?e.fontSize:C.config.render.fontSize)+"px "+(e.font&&i(e.font)||C.config.render.font);return t}var O=function(){this._text={head:"",root:"",foot:"",defs:"",body:""},this._defs={gradient:{},clipping:{}}},E=O.prototype;E.initialize=function(e,r,i,a,o){var s=this._text,l={width:r,height:i};null!=o&&(l.style="background-color:"+o+";"),s.head=t("svg",l,C.config.svgNamespace),s.root=t("g",{transform:"translate("+a.left+","+a.top+")"}),s.foot=n("g")+n("svg")},E.svg=function(){var e=this._text;return e.head+e.defs+e.root+e.body+e.foot},E.buildDefs=function(){var e,r,i=this._defs,a=C.keys(i.gradient),o=C.keys(i.clipping),s="";for(e=0;e<a.length;++e){var l=a[e],c=i.gradient[l],u=c.stops;for(s+=t("linearGradient",{id:l,x1:c.x1,x2:c.x2,y1:c.y1,y2:c.y2}),r=0;r<u.length;++r)s+=t("stop",{offset:u[r].offset,"stop-color":u[r].color})+n("stop");s+=n("linearGradient")}for(e=0;e<o.length;++e){var l=o[e],c=i.clipping[l];s+=t("clipPath",{id:l}),s+=t("rect",{x:0,y:0,width:c.width,height:c.height})+n("rect"),s+=n("clipPath")}return s},E.render=function(e){this._text.body=this.draw(e),this._text.defs=this.buildDefs()},E.draw=function(e){var i,a,o=T[e.marktype],s=o[0],l=o[1],c=o[2]||!1,u=c?[e.items]:e.items,d=this._defs,f="";for(f+=t("g",{"class":m(e.def)}),i=0;i<u.length;++i)a="g"===s?null:S(u[i],s,d),f+=t(s,l(u[i],d),a),"text"===s&&(f+=r(u[i].text)),"g"===s&&(f+=this.drawGroup(u[i])),f+=n(s);return f+n("g")};var T={group:["g",o],area:["path",l,!0],line:["path",c,!0],arc:["path",s],path:["path",u],symbol:["path",p],rect:["rect",d],rule:["line",f],text:["text",g],image:["image",h]};E.drawGroup=function(e){var t,n,r="",i=e.axisItems||[],o=e.items,s=e.legendItems||[];for(r+=a(e),t=0,n=i.length;n>t;++t)"back"===i[t].def.layer&&(r+=this.draw(i[t]));for(t=0,n=o.length;n>t;++t)r+=this.draw(o[t]);for(t=0,n=i.length;n>t;++t)"back"!==i[t].def.layer&&(r+=this.draw(i[t]));for(t=0,n=s.length;n>t;++t)r+=this.draw(s[t]);return r};var A=e.svg.arc(),L=e.svg.area().x(v).y1(y).y0(x),M=e.svg.area().y(y).x0(b).x1(v),N=e.svg.line().x(v).y(y),P=e.svg.symbol().type(w).size(k),I=0,R={left:"start",center:"middle",right:"end"},D={fill:"fill",fillOpacity:"fill-opacity",stroke:"stroke",strokeWidth:"stroke-width",strokeOpacity:"stroke-opacity",strokeCap:"stroke-linecap",strokeDash:"stroke-dasharray",strokeDashOffset:"stroke-dashoffset",opacity:"opacity"},z=C.keys(D);return O}(),C.headless.View=function(){var e=function(e,t,n,r,i,a){this._canvas=null,this._type=i,this._el="body",this._build=!1,this._model=new C.Model,this._width=this.__width=e||500,this._height=this.__height=t||500,this._bgcolor=r||null,this._padding=n||{top:0,left:0,bottom:0,right:0},this._autopad=C.isString(this._padding)?1:0,this._renderer=new C.headless[i],this._viewport=a||null,this.initialize()},t=e.prototype;return t.el=function(e){return arguments.length?(this._el!==e&&(this._el=e,this.initialize()),this):this._el},t.model=function(){return this._model},t.width=function(e){return arguments.length?(this._width!==e&&(this._width=e,this.initialize(),this._model.width(e)),this):this._width},t.height=function(e){return arguments.length?(this._height!==e&&(this._height=e,this.initialize(),this._model.height(this._height)),this):this._height},t.background=function(e){return arguments.length?(this._bgcolor!==e&&(this._bgcolor=e,this.initialize()),this):this._bgcolor},t.padding=function(e){return arguments.length?(this._padding!==e&&(C.isString(e)?(this._autopad=1,this._padding={top:0,left:0,bottom:0,right:0},this._strict="strict"===e):(this._autopad=0,this._padding=e,this._strict=!1),this.initialize()),this):this._padding},t.autopad=function(e){if(this._autopad<1)return this;this._autopad=0;var t=this._padding,n=this._model.scene().bounds,r=C.config.autopadInset,i=n.x1<0?Math.ceil(-n.x1)+r:0,a=n.y1<0?Math.ceil(-n.y1)+r:0,o=n.x2>this._width?Math.ceil(+n.x2-this._width)+r:0,n=n.y2>this._height?Math.ceil(+n.y2-this._height)+r:0;return t={left:i,top:a,right:o,bottom:n},this._strict?(this._autopad=0,this._padding=t,this._width=Math.max(0,this.__width-(i+o)),this._height=Math.max(0,this.__height-(a+n)),this._model.width(this._width),this._model.height(this._height),this._el&&this.initialize(),this.update({props:"enter"}).update({props:"update"})):this.padding(t).update(e),this},t.viewport=function(e){return arguments.length?(this._viewport=e,this.initialize(),this):_viewport},t.defs=function(e){return arguments.length?(this._model.defs(e),this):this._model.defs()},t.data=function(e){if(!arguments.length)return this._model.data();var t=C.keys(e).reduce(function(t,n){return t[n]=C.data.ingestAll(e[n]),t},{});return this._model.data(t),this._build=!1,this},t.renderer=function(){return this._renderer},t.canvas=function(){return this._canvas},t.canvasAsync=function(e){function t(){0===n.pendingImages()?(r.render(),e(r._canvas)):setTimeout(t,10)}var n=this._renderer,r=this;n.pendingImages()>0?t():e(this._canvas)},t.svg=function(){return"svg"===this._type?this._renderer.svg():null},t.initialize=function(){var e=this._width,t=this._height,n=this._bgcolor,r=this._padding;return this._viewport&&(e=this._viewport[0]-(r?r.left+r.right:0),t=this._viewport[1]-(r?r.top+r.bottom:0)),"svg"===this._type?this.initSVG(e,t,r,n):this.initCanvas(e,t,r,n),this},t.initCanvas=function(e,t,n,r){var i=require("canvas"),a=e+(n?n.left+n.right:0),o=t+(n?n.top+n.bottom:0),s=this._canvas=new i(a,o),l=s.getContext("2d");l.setTransform(1,0,0,1,n.left,n.top),this._renderer.context(l),this._renderer.resize(e,t,n),this._renderer.background(r)},t.initSVG=function(e,t,n,r){var i=e+(n?n.left+n.right:0),a=t+(n?n.top+n.bottom:0);this._renderer.initialize(this._el,i,a,n,r)},t.render=function(e){return this._renderer.render(this._model.scene(),e),this},t.update=function(e){e=e||{};var t=this;return t._build=t._build||(t._model.build(),!0),t._model.encode(null,e.props,e.items),t.render(e.items),t.autopad(e)},e}(),C.headless.View.Factory=function(e){return function(t){t=t||{};var n=e.width,r=e.height,i=e.padding,a=e.background,o=e.viewport,s=t.renderer||"canvas",l=new C.headless.View(n,r,i,a,s,o).defs(e);return e.data.load&&l.data(e.data.load),t.data&&l.data(t.data),l}},C.headless.render=function(e,t){function n(n){try{var r=n({data:e.data,renderer:e.renderer}).update();"svg"===e.renderer?t(null,{svg:r.svg(),view:r}):r.canvasAsync(function(e){t(null,{canvas:e,view:r})})}catch(i){t(i,null)}}C.parse.spec(e.spec,n,C.headless.View.Factory)},C}),!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var t;"undefined"!=typeof window?t=window:"undefined"!=typeof global?t=global:"undefined"!=typeof self&&(t=self),t.vl=e()}}(function(){return function e(t,n,r){function i(o,s){if(!n[o]){if(!t[o]){var l="function"==typeof require&&require;if(!s&&l)return l(o,!0);if(a)return a(o,!0);var c=new Error("Cannot find module '"+o+"'");throw c.code="MODULE_NOT_FOUND",c}var u=n[o]={exports:{}};t[o][0].call(u.exports,function(e){var n=t[o][1][e];return i(n?n:e)},u,u.exports,e,t,n,r)}return n[o].exports}for(var a="function"==typeof require&&require,o=0;o<r.length;o++)i(r[o]);return i}({1:[function(e,t){"use strict";var n=(e("./globals"),e("./util")),r=e("./consts"),i=n.merge(r,n);i.version="0.6.2",i.Encoding=e("./Encoding"),i.compile=e("./compile/compile"),i.data=e("./data"),i.field=e("./field"),i.enc=e("./enc"),i.schema=e("./schema/schema"),i.toShorthand=i.Encoding.shorthand,t.exports=i},{"./Encoding":2,"./compile/compile":6,"./consts":20,"./data":21,"./enc":22,"./field":23,"./globals":24,"./schema/schema":25,"./util":27}],2:[function(e,t){"use strict";{var n=(e("./globals"),e("./consts")),r=e("./util"),i=e("./field"),a=e("./enc"),o=e("./schema/schema");e("./compile/time"),t.exports=function(){function e(e,t,r,i,a,s){var l=o.instantiate(),c={data:r,marktype:e,enc:t,config:i,filter:a||[]};for(var u in l.enc)l.enc[u].type=n.dataTypes[l.enc[u].type];var d=o.util.merge(l,s||{},c);this._data=d.data,this._marktype=d.marktype,this._enc=d.enc,this._config=d.config,this._filter=d.filter}var t=e.prototype;return t.marktype=function(){return this._marktype},t.is=function(e){return this._marktype===e},t.has=function(e){return void 0!==this._enc[e].name},t.enc=function(e){return this._enc[e]},t.filter=function(){var e=[],t=this.fields(),n=this;return r.forEach(t,function(t,r){"*"!==r&&(n.config("filterNull").Q&&t.containsType[Q]||n.config("filterNull").T&&t.containsType[T]||n.config("filterNull").O&&t.containsType[O])&&e.push({operands:[r],operator:"notNull"})}),e.concat(this._filter)},t.field=function(e,t,n){if(!this.has(e))return null;var r=t?"":"data.";return"count"===this._enc[e].aggr?r+"count":!n&&this._enc[e].bin?r+"bin_"+this._enc[e].name:!n&&this._enc[e].aggr?r+this._enc[e].aggr+"_"+this._enc[e].name:!n&&this._enc[e].fn?r+this._enc[e].fn+"_"+this._enc[e].name:r+this._enc[e].name},t.fieldName=function(e){return this._enc[e].name},t.fields=function(){return a.fields(this._enc)},t.fieldTitle=function(e){if(i.isCount(this._enc[e]))return i.count.displayName;var t=this._enc[e].aggr||this._enc[e].fn||this._enc[e].bin&&"bin";return t?t.toUpperCase()+"("+this._enc[e].name+")":this._enc[e].name},t.scale=function(e){return this._enc[e].scale||{}},t.axis=function(e){return this._enc[e].axis||{}},t.band=function(e){return this._enc[e].band||{}},t.bandSize=function(e,t){return t=t||e===Y&&this.has(ROW)&&this.has(Y)||e===X&&this.has(COL)&&this.has(X),this.band(e).size||this.config(t?"smallBandSize":"largeBandSize")},t.aggr=function(e){return this._enc[e].aggr},t.bin=function(e){var t=this._enc[e].bin;return t==={}?!1:t===!0?{maxbins:o.MAXBINS_DEFAULT}:t},t.legend=function(e){return this._enc[e].legend},t.value=function(e){return this._enc[e].value},t.fn=function(e){return this._enc[e].fn},t.sort=function(t,n){var r=this._enc[t].sort,a=this._enc,o=i.isType.byCode;if((!r||0===r.length)&&e.toggleSort.support({enc:this._enc},n,!0)&&"Q"===this.config("toggleSort")){var s=o(a.x,O)?a.y:a.x;o(a[t],O)&&(r=[{name:s.name,aggr:s.aggr,type:s.type,reverse:!0}])}return r},t.any=function(e){return r.any(this._enc,e)},t.all=function(e){return r.all(this._enc,e)},t.length=function(){return r.keys(this._enc).length},t.map=function(e){return a.map(this._enc,e)},t.reduce=function(e,t){return a.reduce(this._enc,e,t)},t.forEach=function(e){return a.forEach(this._enc,e)},t.type=function(e){return this.has(e)?this._enc[e].type:null},t.role=function(e){return this.has(e)?i.role(this._enc[e]):null},t.text=function(e){var t=this._enc[TEXT].text;return e?t[e]:t},t.font=function(e){var t=this._enc[TEXT].font;return e?t[e]:t},t.isType=function(t,n){var r=this.enc(t);return r&&e.isType(r,n)},e.isType=function(e,t){return(e.type&t)>0},e.isOrdinalScale=function(e,t){return i.isOrdinalScale(e.enc(t),!0)},e.isDimension=function(e,t){return i.isDimension(e.enc(t),!0)},e.isMeasure=function(e,t){return i.isMeasure(e.enc(t),!0)},t.isOrdinalScale=function(t){return this.has(t)&&e.isOrdinalScale(this,t)},t.isDimension=function(t){return this.has(t)&&e.isDimension(this,t)},t.isMeasure=function(t){return this.has(t)&&e.isMeasure(this,t)},t.isAggregate=function(){return a.isAggregate(this._enc)},e.isAggregate=function(e){return a.isAggregate(e.enc)},e.alwaysNoOcclusion=function(e){return a.isAggregate(e.enc)},e.isStack=function(e){return("bar"===e.marktype||"area"===e.marktype)&&e.enc.color},t.isStack=function(){return(this.is("bar")||this.is("area"))&&this.has("color")},t.cardinality=function(e,t){return i.cardinality(this.enc(e),t,this.config("filterNull"),!0)},t.isRaw=function(){return!this.isAggregate()},t.data=function(e){return this._data[e]},t.config=function(e){return this._config[e]},t.toSpec=function(e){var t,i=r.duplicate(this._enc);for(var a in i)i[a].type=n.dataTypeNames[i[a].type];t={marktype:this._marktype,enc:i,filter:this._filter},e||(t.config=r.duplicate(this._config));var s=o.instantiate();return o.util.subtract(t,s)},t.toShorthand=function(){var e=n.shorthand;return"mark"+e.assign+this._marktype+e.delim+a.shorthand(this._enc)},e.shorthand=function(e){var t=n.shorthand;return"mark"+t.assign+e.marktype+t.delim+a.shorthand(e.enc)},e.fromShorthand=function(t,r,i,o){var s=n.shorthand,l=t.split(s.delim),c=l.shift().split(s.assign)[1].trim(),u=a.fromShorthand(l,!0);return new e(c,u,r,i,null,o)},e.specFromShorthand=function(t,n,r,i){return e.fromShorthand(t,n,r).toSpec(i)},e.fromSpec=function(t,i){var a=r.duplicate(t.enc||{});for(var o in a)a[o].type=n.dataTypes[a[o].type];return new e(t.marktype,a,t.data,t.config,t.filter,i)},e.transpose=function(e){var t=e.enc,n=r.duplicate(e.enc);return n.x=t.y,n.y=t.x,n.row=t.col,n.col=t.row,e.enc=n,e},e.toggleSort=function(e){return e.config=e.config||{},e.config.toggleSort="Q"===e.config.toggleSort?"O":"Q",e},e.toggleSort.direction=function(t,n){if(e.toggleSort.support(t,n)){var r=t.enc;return"O"===r.x.type?"x":"y"}},e.toggleSort.mode=function(e){return e.config.toggleSort},e.toggleSort.support=function(t,n,r){var o=t.enc,s=i.isType.get(r);return!a.has(o,ROW)&&!a.has(o,COL)&&a.has(o,X)&&a.has(o,Y)&&e.alwaysNoOcclusion(t,n)?s(o.x,O)&&i.isMeasure(o.y,r)?"x":s(o.y,O)&&i.isMeasure(o.x,r)?"y":!1:!1},e.toggleFilterNullO=function(e){return e.config=e.config||{},e.config.filterNull=e.config.filterNull||{T:!0,Q:!0},e.config.filterNull.O=!e.config.filterNull.O,e},e.toggleFilterNullO.support=function(e,t){var n=a.fields(e.enc);for(var r in n){var i=n[r];if(i.containsType.O&&r in t&&t[r].numNulls>0)return!0}return!1},e}()}},{"./compile/time":19,"./consts":20,"./enc":22,"./field":23,"./globals":24,"./schema/schema":25,"./util":27}],3:[function(e,t){"use strict";function n(e,t,n){n=n||{};var i={},a={},o={},s={},l=e.data[1];return t.forEach(function(e,n){e.aggr?"count"===e.aggr?a.count={op:"count",field:"*"}:a[e.aggr+"|"+e.name]={op:e.aggr,field:"data."+e.name}:(i[e.name]=t.field(n),n==ROW||n==COL?s[e.name]=i[e.name]:n!==X&&n!==Y&&(o[e.name]=i[e.name]))}),i=r.vals(i),a=r.vals(a),a.length>0&&!n.preaggregatedData&&(l.transform||(l.transform=[]),l.transform.push({type:"aggregate",groupby:i,fields:a})),{details:r.vals(o),dims:i,facets:r.vals(s),aggregated:a.length>0}}var r=(e("../globals"),e("../util"));t.exports=n},{"../globals":24,"../util":27}],4:[function(e,t){"use strict";function n(e,t,n,r){var s=null,l=n.fieldTitle(t);return t===X?s=r.cellWidth/n.config("characterWidth"):t===Y&&(s=r.cellHeight/n.config("characterWidth")),e.title=s?a.truncate(l,s):l,t===ROW&&o(e,["properties","title"],{angle:{value:0},align:{value:"right"},baseline:{value:"middle"},dy:{value:-r.height/2-20}}),e.titleOffset=i(n,r,t),e}function r(e,t,n){var r;n.isType(t,T)&&(r=n.fn(t))&&l.hasScale(r)&&o(e,["properties","labels","text","scale"],"time-"+r);var i=["properties","labels","text","template"];return n.axis(t).format?e.format=n.axis(t).format:n.isType(t,Q)?o(e,i,"{{data | number:'.3s'}}"):n.isType(t,T)&&!n.fn(t)?o(e,i,"{{data | time:'%Y-%m-%d'}}"):n.isType(t,T)&&"year"===n.fn(t)?o(e,i,"{{data | number:'d'}}"):n.isType(t,O)&&n.axis(t).maxLabelLength&&o(e,i,"{{data | truncate:"+n.axis(t).maxLabelLength+"}}"),e}function i(e,t,n){var r=e.axis(n).titleOffset;if(r)return r;switch(n){case ROW:return 0;case COL:return 35}return s(t,[n,"axisTitleOffset"])}var a=(e("../globals"),e("../util")),o=a.setter,s=a.getter,l=e("./time"),c=t.exports={};c.names=function(e){return a.keys(a.keys(e).reduce(function(t,n){var r=e[n].scale;return(r===X||r===Y)&&(t[e[n].scale]=1),t},{}))},c.defs=function(e,t,n,r,i){return e.reduce(function(e,a){return e.push(c.def(a,t,n,r,i)),e},[])},c.def=function(e,t,a,s,l){var c=e,u=e==COL,d=e==ROW,f=i(t,a,Y)+20,p=a.cellPadding;u&&(c="x"),d&&(c="y");var h={type:c,scale:e};return t.axis(e).grid&&(h.grid=!0,h.layer=d||u?"front":"back",u?o(h,["properties","grid"],{x:{offset:a.cellWidth*(1+p/2),scale:"col"},y:{value:-a.cellHeight*(p/2)},stroke:{value:t.config("cellGridColor")}}):d?o(h,["properties","grid"],{y:{offset:-a.cellHeight*(p/2),scale:"row"},x:{value:f},x2:{offset:f+.05*a.cellWidth,group:"mark.group.width",mult:1},stroke:{value:t.config("cellGridColor")}}):o(h,["properties","grid","stroke"],{value:t.config("gridColor")})),t.axis(e).title&&(h=n(h,e,t,a,l)),(d||u)&&(o(h,["properties","ticks"],{opacity:{value:0}}),o(h,["properties","majorTicks"],{opacity:{value:0}}),o(h,["properties","axis"],{opacity:{value:0}})),u&&(h.orient="top"),d&&(h.offset=f),e==X&&(t.has(Y)&&t.isOrdinalScale(Y)&&t.cardinality(Y,s)>30&&(h.orient="top"),t.isDimension(X)||t.isType(X,T)?o(h,["properties","labels"],{angle:{value:270},align:{value:"right"},baseline:{value:"middle"}}):h.ticks=5),h=r(h,e,t,a,l)}},{"../globals":24,"../util":27,"./time":19}],5:[function(e,t){"use strict";function n(e,t,n){n=n||{};n.preaggregatedData||(e.transform||(e.transform=[]),t.forEach(function(n,r){t.bin(r)&&e.transform.push({type:"bin",field:"data."+n.name,output:"data.bin_"+n.name,maxbins:t.bin(r).maxbins})}))}e("../globals"),e("../util");t.exports=n},{"../globals":24,"../util":27}],6:[function(e,t){"use strict";function n(e,t,i){return n.encoding(r.fromSpec(e,i),t)}e("../globals"),e("../util");t.exports=n;var r=e("../Encoding"),i=n.template=e("./template"),a=n.axis=e("./axis"),o=n.filter=e("./filter"),s=n.legend=e("./legend"),l=n.marks=e("./marks"),c=n.scale=e("./scale"),u=n.sort=e("./sort"),d=n.style=e("./style"),f=n.time=e("./time"),p=n.aggregate=e("./aggregate"),h=n.bin=e("./bin"),g=n.facet=e("./facet"),m=n.stack=e("./stack"),v=n.subfacet=e("./subfacet");n.layout=e("./layout"),n.group=e("./group"),n.shorthand=function(e,t,i,a){return n.encoding(r.fromShorthand(e,i,a),t)},n.encoding=function(e,t){var r=n.layout(e,t),y=d(e,t),b=i(e,r,t),x=b.marks[0],k=l[e.marktype()],w=l.def(k,e,r,y),S=w[0];o.addFilters(b,e);for(var _=u(b,e,t),O=e.has(ROW),E=e.has(COL),T=!!e.data("vegaServer"),A=0;A<w.length;A++)x.marks.push(w[A]);h(b.data[1],e,{preaggregatedData:T});var L=l[e.marktype()].line;T||(b=f(b,e));var C=p(b,e,{preaggregatedData:T}),M=C.details,N=M&&M.length>0,P=N&&m(b,e,S,C.facets);if(N&&(P||L)&&v(x,S,M,P,e),L){var I=e.isMeasure(X)&&e.isDimension(Y)?Y:X;S.from||(S.from={}),S.from.transform=[{type:"sort",by:"-"+e.field(I)}]}return O||E?(b=g(x,e,r,y,_,b,S,P,t),b.legends=s.defs(e)):(x.scales=c.defs(c.names(S.properties.update),e,r,y,_,{stack:P,stats:t}),x.axes=a.defs(a.names(S.properties.update),e,r,t),x.legends=s.defs(e)),o.filterLessThanZero(b,e),b}},{"../Encoding":2,"../globals":24,"../util":27,"./aggregate":3,"./axis":4,"./bin":5,"./facet":7,"./filter":8,"./group":9,"./layout":10,"./legend":11,"./marks":12,"./scale":13,"./sort":14,"./stack":15,"./style":16,"./subfacet":17,"./template":18,"./time":19}],7:[function(e,t){"use strict";function n(e,t,n,s,l,c,u,d,f){var p,h,g=e.properties.enter,m=[],v=[],y=t.has(ROW),b=t.has(COL);g.fill={value:t.config("cellBackgroundColor")},e.from={data:e.marks[0].from.data};for(var x=0;x<e.marks.length;x++){var k=e.marks[x];k.from.transform?delete k.from.data:delete k.from}y?(t.isDimension(ROW)||r.error("Row encoding should be ordinal."),g.y={scale:ROW,field:"keys."+m.length},g.height={value:n.cellHeight},m.push(t.field(ROW)),b&&(p=r.duplicate(e.from),p.transform=p.transform||[],p.transform.unshift({type:"facet",keys:[t.field(COL)]})),h=a("x-axes",{axes:t.has(X)?i.defs(["x"],t,n,f):void 0,x:b?{scale:COL,field:"keys.0"}:{value:0},width:b&&{value:n.cellWidth},from:p}),c.marks.unshift(h),c.axes=c.axes||[],c.axes.push.apply(c.axes,i.defs(["row"],t,n,f))):t.has(X)&&v.push.apply(v,i.defs(["x"],t,n,f)),b?(t.isDimension(COL)||r.error("Col encoding should be ordinal."),g.x={scale:COL,field:"keys."+m.length},g.width={value:n.cellWidth},m.push(t.field(COL)),y&&(p=r.duplicate(e.from),p.transform=p.transform||[],p.transform.unshift({type:"facet",keys:[t.field(ROW)]})),h=a("y-axes",{axes:t.has(Y)?i.defs(["y"],t,n,f):void 0,y:y&&{scale:ROW,field:"keys.0"},x:y&&{value:0},height:y&&{value:n.cellHeight},from:p}),c.marks.unshift(h),c.axes=c.axes||[],c.axes.push.apply(c.axes,i.defs(["col"],t,n,f))):t.has(Y)&&v.push.apply(v,i.defs(["y"],t,n,f)),c.scales=(c.scales||[]).concat(o.defs(o.names(g).concat(o.names(u.properties.update)),t,n,s,l,{stack:d,facet:!0,stats:f})),v.length>0&&(e.axes=v);var w=e.from.transform||(e.from.transform=[]);return w.unshift({type:"facet",keys:m}),c}var r=(e("../globals"),e("../util")),i=e("./axis"),a=e("./group").def,o=e("./scale");t.exports=n},{"../globals":24,"../util":27,"./axis":4,"./group":9,"./scale":13}],8:[function(e,t){"use strict";var n=(e("../globals"),t.exports={}),r={">":!0,">=":!0,"=":!0,"!=":!0,"<":!0,"<=":!0};n.addFilters=function(e,t){var n=t.filter(),i=e.data[0];i.transform||(i.transform=[]);for(var a in n){var o=n[a],s="",l=o.operator,c=o.operands;if(r[l]){"="===l&&(l="==");var u=c[0],d=c[1];s="d.data."+u+l+d}else if("notNull"===l)for(var f in c)s+="d.data."+c[f]+"!==null",f<c.length-1&&(s+=" && ");else console.warn("Unsupported operator: ",l);i.transform.push({type:"filter",test:s})}},n.filterLessThanZero=function(e,t){t.forEach(function(n,r){"log"===t.scale(r).type&&e.data[1].transform.push({type:"filter",test:"d."+t.field(r)+">0"})})}},{"../globals":24}],9:[function(e,t){"use strict";function n(e,t){return t=t||{},{_name:e||void 0,type:"group",from:t.from,properties:{enter:{x:t.x||void 0,y:t.y||void 0,width:t.width||{group:"width"},height:t.height||{group:"height"}}},scales:t.scales||void 0,axes:t.axes||void 0,marks:t.marks||[]}}t.exports={def:n}},{}],10:[function(e,t){"use strict";function n(e,t){var n=r(e,t);return n=i(e,t,n)}function r(e,t){var n,r,i=e.has(ROW),a=e.has(COL),o=e.has(X),s=e.has(Y),l=e.marktype(),c=o&&e.isDimension(X)?e.cardinality(X,t):1,u=s&&e.isDimension(Y)?e.cardinality(Y,t):1,d=c>e.config("largeBandMaxCardinality")||u>e.config("largeBandMaxCardinality"),f=e.config("cellPadding");n=o?e.isOrdinalScale(X)?(c+e.band(X).padding)*e.bandSize(X,d):a||i?e.enc(COL).width:e.config("singleWidth"):l===TEXT?e.config("textCellWidth"):e.bandSize(X),r=s?e.isOrdinalScale(Y)?(u+e.band(Y).padding)*e.bandSize(Y,d):a||i?e.enc(ROW).height:e.config("singleHeight"):e.bandSize(Y);var p=n,h=r;if(a){var g=e.cardinality(COL,t);p=n*((1+f)*(g-1)+1)}if(i){var m=e.cardinality(ROW,t);h=r*((1+f)*(m-1)+1)}return{cellWidth:n,cellHeight:r,cellPadding:f,width:p,height:h,x:{useSmallBand:d},y:{useSmallBand:d}}}function i(e,t,n){return[X,Y].forEach(function(r){var i;e.isDimension(r)||e.isType(r,T)?i=t[e.fieldName(r)].maxlength:"count"===e.aggr(r)?i=3:e.isType(r,Q)&&(i=r===X?3:Math.min(t[e.fieldName(r)].maxlength,7)),o(n,[r,"axisTitleOffset"],e.config("characterWidth")*i+20)}),n}{var a=(e("../globals"),e("../util")),o=a.setter;e("../schema/schema"),e("./time"),e("../field")}t.exports=n},{"../field":23,"../globals":24,"../schema/schema":25,"../util":27,"./time":19}],11:[function(e,t){"use strict";var n=(e("../globals"),e("./time")),r=t.exports={};r.defs=function(e){var t=[];if(e.has(COLOR)&&e.legend(COLOR)&&t.push(r.def(COLOR,e,{fill:COLOR,orient:"right"})),e.has(SIZE)&&e.legend(SIZE)&&t.push(r.def(SIZE,e,{size:SIZE,orient:1===t.length?"left":"right"})),e.has(SHAPE)&&e.legend(SHAPE)){if(2===t.length)return console.error("Vegalite currently only supports two legends"),t;t.push(r.def(SHAPE,e,{shape:SHAPE,orient:1===t.length?"left":"right"}))}return t},r.def=function(e,t,r){var i,a=r;if(a.title=t.fieldTitle(e),t.isType(e,T)&&(i=t.fn(e))&&n.hasScale(i)){var o=a.properties=a.properties||{},s=o.labels=o.labels||{},l=s.text=s.text||{};
l.scale="time-"+i}return a}},{"../globals":24,"./time":19}],12:[function(e,t){"use strict";function n(e,t){var n={};return e.isMeasure(X)?(n.x={scale:X,field:e.field(X)},e.isDimension(Y)&&(n.x2={scale:X,value:"log"===e.scale(X).type?1:0})):n.xc=e.has(X)?{scale:X,field:e.field(X)}:{value:0},e.isMeasure(Y)?(n.y={scale:Y,field:e.field(Y)},n.y2={scale:Y,value:"log"===e.scale(Y).type?1:0}):n.yc=e.has(Y)?{scale:Y,field:e.field(Y)}:{group:"height"},n.width=!e.has(X)||e.isOrdinalScale(X)?e.has(SIZE)?{scale:SIZE,field:e.field(SIZE)}:{value:e.bandSize(X,t.x.useSmallBand),offset:-1}:{value:2},n.height=!e.has(Y)||e.isOrdinalScale(Y)?e.has(SIZE)?{scale:SIZE,field:e.field(SIZE)}:{value:e.bandSize(Y,t.y.useSmallBand),offset:-1}:{value:2},n.fill=e.has(COLOR)?{scale:COLOR,field:e.field(COLOR)}:{value:e.value(COLOR)},e.has(ALPHA)?n.opacity={scale:ALPHA,field:e.field(ALPHA)}:void 0!==e.value(ALPHA)&&(n.opacity={value:e.value(ALPHA)}),n}function r(e,t,n){var r={};return e.has(X)?r.x={scale:X,field:e.field(X)}:e.has(X)||(r.x={value:e.bandSize(X,t.x.useSmallBand)/2}),e.has(Y)?r.y={scale:Y,field:e.field(Y)}:e.has(Y)||(r.y={value:e.bandSize(Y,t.y.useSmallBand)/2}),e.has(SIZE)?r.size={scale:SIZE,field:e.field(SIZE)}:e.has(SIZE)||(r.size={value:e.value(SIZE)}),e.has(SHAPE)?r.shape={scale:SHAPE,field:e.field(SHAPE)}:e.has(SHAPE)||(r.shape={value:e.value(SHAPE)}),e.has(COLOR)?r.stroke={scale:COLOR,field:e.field(COLOR)}:e.has(COLOR)||(r.stroke={value:e.value(COLOR)}),e.has(ALPHA)?r.opacity={scale:ALPHA,field:e.field(ALPHA)}:void 0!==e.value(ALPHA)?r.opacity={value:e.value(ALPHA)}:e.has(COLOR)||(r.opacity={value:n.opacity}),r.strokeWidth={value:e.config("strokeWidth")},r}function i(e){var t={};return e.has(X)?t.x={scale:X,field:e.field(X)}:e.has(X)||(t.x={value:0}),e.has(Y)?t.y={scale:Y,field:e.field(Y)}:e.has(Y)||(t.y={group:"height"}),e.has(COLOR)?t.stroke={scale:COLOR,field:e.field(COLOR)}:e.has(COLOR)||(t.stroke={value:e.value(COLOR)}),e.has(ALPHA)?t.opacity={scale:ALPHA,field:e.field(ALPHA)}:void 0!==e.value(ALPHA)&&(t.opacity={value:e.value(ALPHA)}),t.strokeWidth={value:e.config("strokeWidth")},t}function a(e){var t={};return e.isMeasure(X)?(t.x={scale:X,field:e.field(X)},e.isDimension(Y)&&(t.x2={scale:X,value:0},t.orient={value:"horizontal"})):t.x=e.has(X)?{scale:X,field:e.field(X)}:{value:0},e.isMeasure(Y)?(t.y={scale:Y,field:e.field(Y)},t.y2={scale:Y,value:0}):t.y=e.has(Y)?{scale:Y,field:e.field(Y)}:{group:"height"},e.has(COLOR)?t.fill={scale:COLOR,field:e.field(COLOR)}:e.has(COLOR)||(t.fill={value:e.value(COLOR)}),e.has(ALPHA)?t.opacity={scale:ALPHA,field:e.field(ALPHA)}:void 0!==e.value(ALPHA)&&(t.opacity={value:e.value(ALPHA)}),t}function o(e,t,n){var r={};return e.has(X)?(r.x={scale:X,field:e.field(X)},e.isDimension(X)&&(r.x.offset=-e.bandSize(X,t.x.useSmallBand)/3)):e.has(X)||(r.x={value:0}),e.has(Y)?(r.y={scale:Y,field:e.field(Y)},e.isDimension(Y)&&(r.y.offset=-e.bandSize(Y,t.y.useSmallBand)/3)):e.has(Y)||(r.y={value:0}),r.width=!e.has(X)||e.isDimension(X)?{value:e.bandSize(X,t.y.useSmallBand)/1.5}:{value:1},r.height=!e.has(Y)||e.isDimension(Y)?{value:e.bandSize(Y,t.y.useSmallBand)/1.5}:{value:1},r.fill=e.has(COLOR)?{scale:COLOR,field:e.field(COLOR)}:{value:e.value(COLOR)},e.has(ALPHA)?r.opacity={scale:ALPHA,field:e.field(ALPHA)}:void 0!==e.value(ALPHA)?r.opacity={value:e.value(ALPHA)}:e.has(COLOR)||(r.opacity={value:n.opacity}),r}function s(e){return function(t,n,r){var i={};return t.has(X)?i.x={scale:X,field:t.field(X)}:t.has(X)||(i.x={value:t.bandSize(X,n.x.useSmallBand)/2}),t.has(Y)?i.y={scale:Y,field:t.field(Y)}:t.has(Y)||(i.y={value:t.bandSize(Y,n.y.useSmallBand)/2}),t.has(SIZE)?i.size={scale:SIZE,field:t.field(SIZE)}:t.has(X)||(i.size={value:t.value(SIZE)}),i.shape={value:e},t.has(COLOR)?i.fill={scale:COLOR,field:t.field(COLOR)}:t.has(COLOR)||(i.fill={value:t.value(COLOR)}),t.has(ALPHA)?i.opacity={scale:ALPHA,field:t.field(ALPHA)}:void 0!==t.value(ALPHA)?i.opacity={value:t.value(ALPHA)}:t.has(COLOR)||(i.opacity={value:r.opacity}),i}}function l(e,t,n){var r={};return e.has(X)?r.x={scale:X,field:e.field(X)}:e.has(X)||(r.x=e.has(TEXT)&&e.isType(TEXT,Q)?{value:t.cellWidth-5}:{value:e.bandSize(X,t.x.useSmallBand)/2}),e.has(Y)?r.y={scale:Y,field:e.field(Y)}:e.has(Y)||(r.y={value:e.bandSize(Y,t.y.useSmallBand)/2}),e.has(SIZE)?r.fontSize={scale:SIZE,field:e.field(SIZE)}:e.has(SIZE)||(r.fontSize={value:e.font("size")}),r.fill={value:"black"},r.opacity=e.has(ALPHA)?{scale:ALPHA,field:e.field(ALPHA)}:void 0!==e.value(ALPHA)?{value:e.value(ALPHA)}:{value:n.opacity},e.has(TEXT)?e.isType(TEXT,Q)?(r.text={template:"{{"+e.field(TEXT)+" | number:'.3s'}}"},r.align={value:"right"}):r.text={field:e.field(TEXT)}:r.text={value:"Abc"},r.font={value:e.font("family")},r.fontWeight={value:e.font("weight")},r.fontStyle={value:e.font("style")},r.baseline={value:e.text("baseline")},r}var c=(e("../globals"),e("../util"),e("./scale"),t.exports={});c.def=function(e,t,n,r){var i=[];if(t.marktype()===TEXT&&t.has(COLOR)){var a={x:{value:0},y:{value:0},x2:{value:n.cellWidth},y2:{value:n.cellHeight},fill:{scale:COLOR,field:t.field(COLOR)}};i.push({type:"rect",from:{data:TABLE},properties:{enter:a,update:a}})}var o=e.prop(t,n,r);return i.push({type:e.type,from:{data:TABLE},properties:{enter:o,update:o}}),i},c.bar={type:"rect",stack:!0,prop:n,requiredEncoding:["x","y"],supportedEncoding:{row:1,col:1,x:1,y:1,size:1,color:1,alpha:1}},c.line={type:"line",line:!0,prop:i,requiredEncoding:["x","y"],supportedEncoding:{row:1,col:1,x:1,y:1,color:1,alpha:1,detail:1}},c.area={type:"area",stack:!0,line:!0,requiredEncoding:["x","y"],prop:a,supportedEncoding:{row:1,col:1,x:1,y:1,color:1,alpha:1}},c.tick={type:"rect",prop:o,supportedEncoding:{row:1,col:1,x:1,y:1,color:1,alpha:1,detail:1}},c.circle={type:"symbol",prop:s("circle"),supportedEncoding:{row:1,col:1,x:1,y:1,size:1,color:1,alpha:1,detail:1}},c.square={type:"symbol",prop:s("square"),supportedEncoding:c.circle.supportedEncoding},c.point={type:"symbol",prop:r,supportedEncoding:{row:1,col:1,x:1,y:1,size:1,color:1,alpha:1,shape:1,detail:1}},c.text={type:"text",prop:l,requiredEncoding:["text"],supportedEncoding:{row:1,col:1,size:1,color:1,alpha:1,text:1}}},{"../globals":24,"../util":27,"./scale":13}],13:[function(e,t){"use strict";function n(e,t,n,r){if(t.isType(e,T)){var o=a.scale.domain(t.fn(e),e);if(o)return o}if(t.bin(e)&&r.stats){var s=i.getbins(r.stats[t.fieldName(e)],t.bin(e).maxbins),l=i.range(s.start,s.stop,s.step);return e===Y?l.reverse():l}return e==r.stack?{data:STACKED,field:"data."+(r.facet?"max_":"")+"sum_"+t.field(e,!0)}:{data:n.getDataset(e),field:t.field(e)}}function r(e,t,n,r){var i=t.scale(e.name);switch(e.name){case X:"ordinal"===e.type?e.bandWidth=t.bandSize(X,n.x.useSmallBand):(e.range=n.cellWidth?[0,n.cellWidth]:"width",e.zero=t.isType(e.name,T)&&"year"===t.fn(e.name)?!1:void 0===i.zero?!0:i.zero,e.reverse=i.reverse),e.round=!0,e.nice="time"===e.type?t.fn(e.name):!0;break;case Y:"ordinal"===e.type?e.bandWidth=t.bandSize(Y,n.y.useSmallBand):(e.range=n.cellHeight?[n.cellHeight,0]:"height",e.zero=t.isType(e.name,T)&&"year"===t.fn(e.name)?!1:void 0===i.zero?!0:i.zero,e.reverse=i.reverse),e.round=!0,e.nice="time"===e.type?t.fn(e.name)||t.config("timeScaleNice"):!0;break;case ROW:e.bandWidth=n.cellHeight,e.round=!0,e.nice=!0;break;case COL:e.bandWidth=n.cellWidth,e.round=!0,e.nice=!0;break;case SIZE:if(t.is("bar"))e.range=[3,Math.max(t.bandSize(X),t.bandSize(Y))];else if(t.is(TEXT))e.range=[8,40];else{var a=Math.min(t.bandSize(X),t.bandSize(Y))-1;e.range=[10,.8*a*a]}e.round=!0,e.zero=!1;break;case SHAPE:e.range="shapes";break;case COLOR:var o=t.scale(COLOR).range;void 0===o&&("ordinal"===e.type?o=r.colorRange:(o=["#A9DB9F","#0D5C21"],e.zero=!1)),e.range=o;break;case ALPHA:e.range=[.2,1];break;default:throw new Error("Unknown encoding name: "+e.name)}switch(e.name){case ROW:case COL:e.padding=t.config("cellPadding"),e.outerPadding=0;break;case X:case Y:"ordinal"===e.type&&(e.points=!0,e.padding=t.band(e.name).padding)}}var i=(e("../globals"),e("../util")),a=e("./time"),o=t.exports={};o.names=function(e){return i.keys(i.keys(e).reduce(function(t,n){return e[n]&&e[n].scale&&(t[e[n].scale]=1),t},{}))},o.defs=function(e,t,i,a,s,l){return l=l||{},e.reduce(function(e,c){var u={name:c,type:o.type(c,t),domain:n(c,t,s,l)};return"ordinal"!==u.type||t.bin(c)||0!==t.sort(c).length||(u.sort=!0),r(u,t,i,a,l),e.push(u),e},[])},o.type=function(e,t){switch(t.type(e)){case O:return"ordinal";case T:var n=t.fn(e);return n&&a.scale.type(n,e)||"time";case Q:return t.bin(e)?e===COLOR?"linear":"ordinal":t.scale(e).type}}},{"../globals":24,"../util":27,"./time":19}],14:[function(e,t){"use strict";function n(e,t,n){var r={},i=0;return t.forEach(function(a,o){var s=t.sort(o,n);if(s.length>0){var l=s.map(function(e){return{op:e.aggr,field:"data."+e.name}}),c=s.map(function(e){var t=e.reverse?"-":"";return t+"data."+("count"===e.aggr?"count":e.aggr+"_"+e.name)}),u="sorted"+i++,d=[{type:"aggregate",groupby:["data."+a.name],fields:l},{type:"sort",by:c}];e.data.push({name:u,source:RAW,transform:d}),r[o]=u}}),{spec:e,getDataset:function(e){var t=r[e];return t?t:TABLE}}}e("../globals");t.exports=n},{"../globals":24}],15:[function(e,t){"use strict";function n(e,t,n,i){if(!r[t.marktype()].stack)return!1;if(!t.has(COLOR))return!1;var a=null,o=null,s=null,l=t.isMeasure(X),c=t.isMeasure(Y);if(l&&!c)a=Y,o=X,s=0;else{if(!c||l)return null;a=X,o=Y,s=1}var u={name:STACKED,source:TABLE,transform:[{type:"aggregate",groupby:[t.field(a)].concat(i),fields:[{op:"sum",field:t.field(o)}]}]};return i&&i.length>0&&u.transform.push({type:"aggregate",groupby:i,fields:[{op:"max",field:"data.sum_"+t.field(o,!0)}]}),e.data.push(u),n.from.transform=[{type:"stack",point:t.field(a),height:t.field(o),output:{y1:o,y0:o+"2"}}],n.properties.update[o]=n.properties.enter[o]={scale:o,field:o},n.properties.update[o+"2"]=n.properties.enter[o+"2"]={scale:o,field:o+"2"},o}var r=(e("../globals"),e("../util"),e("./marks"));t.exports=n},{"../globals":24,"../util":27,"./marks":12}],16:[function(e,t){"use strict";function n(e,t){if(e.has(COLOR)&&e.isDimension(COLOR)){var n=e.cardinality(COLOR,t);return 10>=n?"category10":"category20"}return null}function r(e,t){if(!t)return 1;var n=0;if(e.isAggregate())n=1,e.forEach(function(r,a){a===ROW||a===COL||(a===X||a===Y)&&i.isOrdinalScale(r,!0)||(n*=e.cardinality(a,t))});else{n=t.count;var r=1;e.has(ROW)&&(r*=e.cardinality(ROW,t)),e.has(COL)&&(r*=e.cardinality(COL,t)),n/=r}var a=0;return a=20>n?1:200>n?.7:1e3>n||e.is("tick")?.6:.3}{var i=(e("../globals"),e("../util"),e("../field"));e("../Encoding")}t.exports=function(e,t){return{opacity:r(e,t),colorRange:n(e,t)}}},{"../Encoding":2,"../field":23,"../globals":24,"../util":27}],17:[function(e,t){"use strict";function n(e,t,n,i,a){var o=e.marks,s=r("subfacet",{marks:o});e.marks=[s],s.from=t.from,delete t.from;var l=s.from.transform||(s.from.transform=[]);l.unshift({type:"facet",keys:n}),i&&a.has(COLOR)&&l.unshift({type:"sort",by:a.field(COLOR)})}var r=(e("../globals"),e("./group").def);t.exports=n},{"../globals":24,"./group":9}],18:[function(e,t){"use strict";function n(e,t,n){var a={name:RAW,format:{type:e.data("formatType")}},o={name:TABLE,source:RAW},s=i.getUrl(e,n);s&&(a.url=s);var l=!!e.data("vegaServer");return e.forEach(function(e){var t;e.type==T?(a.format.parse=a.format.parse||{},a.format.parse[e.name]="date"):e.type==Q&&(a.format.parse=a.format.parse||{},t="count"===e.aggr?"count":l&&e.bin?"bin_"+e.name:l&&e.aggr?e.aggr+"_"+e.name:e.name,a.format.parse[t]="number")}),{width:t.width,height:t.height,padding:"auto",data:[a,o],marks:[r("cell",{width:t.cellWidth?{value:t.cellWidth}:void 0,height:t.cellHeight?{value:t.cellHeight}:void 0})]}}var r=(e("../globals"),e("./group").def),i=e("../data");t.exports=n},{"../data":21,"../globals":24,"./group":9}],19:[function(e,t){"use strict";function n(e,t){var r={},i={};t.forEach(function(e,n){e.type===T&&e.fn&&(r[t.field(n)]={field:e,encType:n},i[e.fn]=!0)});var a=e.data[1],o=a.transform=a.transform||[];for(var s in r){var l=r[s];n.transform(o,t,l.encType,l.field)}var c=e.scales=e.scales||[];for(var u in i)n.scale(c,u,t);return e}function r(e,t){return"utc"+e+"(d.data."+t.name+")"}var i=(e("../globals"),e("../util"));t.exports=n,n.cardinality=function(e,t,n,r){var i=e.fn;switch(i){case"seconds":return 60;case"minutes":return 60;case"hours":return 24;case"day":return 7;case"date":return 31;case"month":return 12;case"year":var a=t[e.name],o=t["year_"+e.name];return o?o.cardinality-(a.numNulls>0&&n[r]?1:0):null}return null},n.formula=function(e){return r(e.fn,e)},n.transform=function(e,t,r,i){e.push({type:"formula",field:t.field(r),expr:n.formula(i)})},n.scale=function(e,t,n){var r=n.config("timeScaleLabelLength");switch(t){case"day":e.push({name:"time-"+t,type:"ordinal",domain:i.range(0,7),range:["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"].map(function(e){return e.substr(0,r)})});break;case"month":e.push({name:"time-"+t,type:"ordinal",domain:i.range(0,12),range:["January","February","March","April","May","June","July","August","September","October","November","December"].map(function(e){return e.substr(0,r)})})}},n.isOrdinalFn=function(e){switch(e){case"seconds":case"minutes":case"hours":case"day":case"date":case"month":return!0}return!1},n.scale.type=function(e,t){return t===COLOR?"linear":n.isOrdinalFn(e)||t===COL||t===ROW?"ordinal":"linear"},n.scale.domain=function(e,t){var n=t===COLOR;switch(e){case"seconds":case"minutes":return n?[0,59]:i.range(0,60);case"hours":return n?[0,23]:i.range(0,24);case"day":return n?[0,6]:i.range(0,7);case"date":return n?[1,31]:i.range(1,32);case"month":return n?[0,11]:i.range(0,12)}return null},n.hasScale=function(e){switch(e){case"day":case"month":return!0}return!1}},{"../globals":24,"../util":27}],20:[function(e,t){"use strict";var n=(e("./globals"),t.exports={});n.encodingTypes=[X,Y,ROW,COL,SIZE,SHAPE,COLOR,ALPHA,TEXT,DETAIL],n.dataTypes={O:O,Q:Q,T:T},n.dataTypeNames=["O","Q","T"].reduce(function(e,t){return e[n.dataTypes[t]]=t,e},{}),n.shorthand={delim:"|",assign:"=",type:",",func:"_"}},{"./globals":24}],21:[function(e,t){"use strict";var n=e("./util"),r=t.exports={},i=e("./field");r.getUrl=function(e,t){if(!e.data("vegaServer"))return e.data("url");if(0!==e.length()){var r=[];e.forEach(function(i,a){var o={name:e.field(a,!0),field:i.name};i.aggr&&(o.aggr=i.aggr),i.bin&&(o.binSize=n.getbins(t[i.name],e.bin(a).maxbins).step),r.push(o)});var i={table:e.data("vegaServer").table,fields:r};return e.data("vegaServer").url+"/query/?q="+JSON.stringify(i)}},r.getSchema=function(e,t){var r=[],a=n.keys(e[0]);return a.forEach(function(t){for(var i=0,a=e[i][t];""===a||null===a||void 0===a;)if(a=e[++i][t],i>=e.length){a="";break}a=n.parse(a);var o="number"==typeof a?"Q":a instanceof Date?"T":"O";r.push({name:t,type:o})}),r=n.stablesort(r,t||i.order.typeThenName,i.order.name)},r.getStats=function(e){var t={},r=n.keys(e[0]);return r.forEach(function(r){var i=e.map(function(e){return e[r]}),a=n.parse(e[0][r]),o={};o=n.minmax("number"==typeof a?n.numbers(i):a instanceof Date?n.dates(i):i),o.cardinality=n.uniq(e,r),o.count=e.length,o.maxlength=e.reduce(function(e,t){if(null===t[r])return e;var n=t[r].toString().length;return n>e?n:e},0),o.numNulls=e.reduce(function(e,t){return null===t[r]?e+1:e},0);var s=n.numbers(i);s.length>0&&(o.skew=n.skew(s),o.stdev=n.stdev(s),o.mean=n.mean(s),o.median=n.median(s));for(var l={};Object.keys(l).length<Math.min(o.cardinality,10);){var c=e[Math.floor(Math.random()*e.length)][r];l[c]=!0}o.sample=Object.keys(l),t[r]=o}),t.count=e.length,t}},{"./field":23,"./util":27}],22:[function(e,t){"use strict";var n=e("./consts"),r=n.shorthand,i=(e("./compile/time"),e("./field")),a=e("./util"),o=e("./schema/schema"),s=o.encTypes,l=t.exports={};l.countRetinal=function(e){var t=0;return e.color&&t++,e.alpha&&t++,e.size&&t++,e.shape&&t++,t},l.has=function(e,t){var n=e&&e[t];return n&&n.name},l.isAggregate=function(e){for(var t in e)if(l.has(e,t)&&e[t].aggr)return!0;return!1},l.forEach=function(e,t){var n=0;s.forEach(function(r){l.has(e,r)&&t(e[r],r,n++)})},l.map=function(e,t){var n=[];return s.forEach(function(r){l.has(e,r)&&n.push(t(e[r],r,e))}),n},l.reduce=function(e,t,n){var r=n;return s.forEach(function(n){l.has(e,n)&&(r=t(r,e[n],n,e))}),r},l.fields=function(e){return l.reduce(e,function(e,t){var n=e[t.name]=e[t.name]||[],r=n.containsType=n.containsType||{};return-1===n.indexOf(t)&&(n.push(t),r[t.type]=!0),e},{})},l.shorthand=function(e){return l.map(e,function(e,t){return t+r.assign+i.shorthand(e)}).join(r.delim)},l.fromShorthand=function(e,t){var n=a.isArray(e)?e:e.split(r.delim);return n.reduce(function(e,n){var a=n.split(r.assign),o=a[0].trim(),s=a[1];return e[o]=i.fromShorthand(s,t),e},{})}},{"./compile/time":19,"./consts":20,"./field":23,"./schema/schema":25,"./util":27}],23:[function(e,t){"use strict";function n(e){return e?c.isType.byCode:c.isType.byName}function r(e,t){var r=n(t);return r(e,O)||!!e.bin||r(e,T)&&!!e.fn}var i=e("./consts"),a=i.shorthand,o=e("./compile/time"),s=e("./util"),l=e("./schema/schema"),c=t.exports={};c.shorthand=function(e){var t=i.shorthand;return(e.aggr?e.aggr+t.func:"")+(e.fn?e.fn+t.func:"")+(e.bin?"bin"+t.func:"")+(e.name||"")+t.type+(i.dataTypeNames[e.type]||e.type)},c.shorthands=function(e,t){return t=t||a.delim,e.map(c.shorthand).join(t)},c.fromShorthand=function(e,t){var n,r=e.split(a.type),o={name:r[0].trim(),type:t?i.dataTypes[r[1].trim()]:r[1].trim()};for(n in l.aggr.enum){var s=l.aggr.enum[n];if(0===o.name.indexOf(s+"_")){o.name=o.name.substr(s.length+1),"count"==s&&0===o.name.length&&(o.name="*"),o.aggr=s;break}}for(n in l.timefns){var c=l.timefns[n];if(o.name&&0===o.name.indexOf(c+"_")){o.name=o.name.substr(o.length+1),o.fn=c;break}}return o.name&&0===o.name.indexOf("bin_")&&(o.name=o.name.substr(4),o.bin=!0),o};var u={O:0,G:1,T:2,Q:3};c.order={},c.order.type=function(e){return"count"===e.aggr?4:u[e.type]},c.order.typeThenName=function(e){return c.order.type(e)+"_"+e.name.toLowerCase()},c.order.original=function(){return 0},c.order.name=function(e){return e.name},c.order.typeThenCardinality=function(e,t){return t[e.name].cardinality},c.isType=function(e,t){return(e.type&t)>0},c.isType.byCode=c.isType,c.isType.byName=function(e,t){return e.type===i.dataTypeNames[t]},c.isType.get=n,c.isOrdinalScale=function(e,t){var r=n(t);return r(e,O)||e.bin||r(e,T)&&e.fn&&o.isOrdinalFn(e.fn)},c.isDimension=function(e,t){return e&&r(e,t)},c.isMeasure=function(e,t){return e&&!r(e,t)},c.role=function(e){return r(e)?"dimension":"measure"},c.count=function(){return{name:"*",aggr:"count",type:"Q",displayName:c.count.displayName}},c.count.displayName="Number of Records",c.isCount=function(e){return"count"===e.aggr},c.cardinality=function(e,t,r,a){var c=n(a),u=a?i.dataTypeNames[e.type]:e.type;if(r=r||{},e.bin){var d=s.getbins(t[e.name],e.bin.maxbins||l.MAXBINS_DEFAULT);return(d.stop-d.start)/d.step}if(c(e,T)){var f=o.cardinality(e,t,r,u);if(null!==f)return f}if(e.aggr)return 1;var p=t[e.name];return p.cardinality-(p.numNulls>0&&r[u]?1:0)}},{"./compile/time":19,"./consts":20,"./schema/schema":25,"./util":27}],24:[function(){(function(e){"use strict";var t=e||window;t.TABLE="table",t.RAW="raw",t.STACKED="stacked",t.INDEX="index",t.X="x",t.Y="y",t.ROW="row",t.COL="col",t.SIZE="size",t.SHAPE="shape",t.COLOR="color",t.ALPHA="alpha",t.TEXT="text",t.DETAIL="detail",t.O=1,t.Q=2,t.T=4}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],25:[function(e,t){"use strict";var n=t.exports={},r=e("../util");n.util=e("./schemautil"),n.marktype={type:"string","enum":["point","tick","bar","line","area","circle","square","text"]},n.aggr={type:"string","enum":["avg","sum","min","max","count"],supportedEnums:{Q:["avg","sum","min","max","count"],O:[],T:["avg","min","max"],"":["count"]},supportedTypes:{Q:!0,O:!0,T:!0,"":!0}},n.band={type:"object",properties:{size:{type:"integer",minimum:0},padding:{type:"integer",minimum:0,"default":1}}},n.getSupportedRole=function(e){return n.schema.properties.enc.properties[e].supportedRole},n.timefns=["year","month","day","date","hours","minutes","seconds"],n.defaultTimeFn="month",n.fn={type:"string","enum":n.timefns,supportedTypes:{T:!0}},n.scale_type={type:"string","enum":["linear","log","pow","sqrt","quantile"],"default":"linear",supportedTypes:{Q:!0}},n.field={type:"object",properties:{name:{type:"string"}}};var i=r.duplicate,a=n.util.merge;n.MAXBINS_DEFAULT=15;var o={type:["boolean","object"],"default":!1,properties:{maxbins:{type:"integer","default":n.MAXBINS_DEFAULT,minimum:2}},supportedTypes:{Q:!0}},s=a(i(n.field),{type:"object",properties:{type:{type:"string","enum":["O","Q","T"]},aggr:n.aggr,fn:n.fn,bin:o,scale:{type:"object",properties:{type:n.scale_type,reverse:{type:"boolean","default":!1,supportedTypes:{Q:!0,T:!0}},zero:{type:"boolean",description:"Include zero","default":!0,supportedTypes:{Q:!0,T:!0}},nice:{type:"string","enum":["second","minute","hour","day","week","month","year"],supportedTypes:{T:!0}}}}}}),l=a(i(n.field),{type:"object",supportedRole:{dimension:!0},properties:{type:{type:"string","enum":["O","Q","T"]},fn:n.fn,bin:o,aggr:{type:"string","enum":["count"],supportedTypes:{O:!0}}}}),c={type:"object",supportedMarktypes:{point:!0,tick:!0,bar:!0,line:!0,area:!0,circle:!0,square:!0},properties:{axis:{type:"object",properties:{grid:{type:"boolean","default":!0,description:"A flag indicate if gridlines should be created in addition to ticks."},title:{type:"boolean","default":!0,description:"A title for the axis."},titleOffset:{type:"integer","default":void 0,description:"A title offset value for the axis."},format:{type:"string","default":void 0,description:"The formatting pattern for axis labels."},maxLabelLength:{type:"integer","default":25,minimum:0,description:"Truncate labels that are too long."}}}}},u={type:"object",properties:{sort:{type:"array","default":[],items:{type:"object",supportedTypes:{O:!0},required:["name","aggr"],name:{type:"string"},aggr:{type:"string","enum":["avg","sum","min","max","count"]},reverse:{type:"boolean","default":!1}}}}},d={type:"object",properties:{band:n.band}},f={type:"object",properties:{legend:{type:"boolean","default":!0}}},p={type:"object",supportedMarktypes:{text:!0},properties:{text:{type:"object",properties:{align:{type:"string","default":"left"},baseline:{type:"string","default":"middle"},margin:{type:"integer","default":4,minimum:0}}},font:{type:"object",properties:{weight:{type:"string","enum":["normal","bold"],"default":"normal"},size:{type:"integer","default":10,minimum:0},family:{type:"string","default":"Helvetica Neue"},style:{type:"string","default":"normal","enum":["normal","italic"]}}}}},h={type:"object",supportedMarktypes:{point:!0,bar:!0,circle:!0,square:!0,text:!0},properties:{value:{type:"integer","default":30,minimum:0}}},g={type:"object",supportedMarktypes:{point:!0,tick:!0,bar:!0,line:!0,area:!0,circle:!0,square:!0,text:!0},properties:{value:{type:"string",role:"color","default":"steelblue"},scale:{type:"object",properties:{range:{type:["string","array"]}}}}},m={type:"object",supportedMarktypes:{point:!0,tick:!0,bar:!0,line:!0,area:!0,circle:!0,square:!0,text:!0},properties:{value:{type:"number","default":void 0,minimum:0,maximum:1}}},v={type:"object",supportedMarktypes:{point:!0,circle:!0,square:!0},properties:{value:{type:"string","enum":["circle","square","cross","diamond","triangle-up","triangle-down"],"default":"circle"}}},y={type:"object",supportedMarktypes:{point:!0,tick:!0,line:!0,circle:!0,square:!0}},b={properties:{height:{type:"number",minimum:0,"default":150},grid:{type:"boolean","default":!0,description:"A flag indicate if gridlines should be created in addition to ticks."}}},x={properties:{width:{type:"number",minimum:0,"default":150},axis:{properties:{maxLabelLength:{type:"integer","default":12,minimum:0,description:"Truncate labels that are too long."}}}}},k={type:"object",supportedMarktypes:{point:!0,tick:!0,bar:!0,line:!0,area:!0,circle:!0,square:!0,text:!0},properties:{padding:{type:"number",minimum:0,maximum:1,"default":.1}}},w={required:["name","type"]},S=a(i(s),{supportedRole:{measure:!0,dimension:!0}}),_=a(i(s),{supportedRole:{measure:!0,dimension:"ordinal-only"}}),O=a(i(s),{supportedRole:{measure:!0}}),E=a(i(S),c,d,w,u),T=i(E),A=a(i(l),w,k,u),L=a(i(A),c,b),C=a(i(A),c,x),M=a(i(_),f,h,u),N=a(i(S),f,g,u),P=a(i(_),m,u),I=a(i(l),f,v,u),R=a(i(l),y,u),D=a(i(O),p,u),z={type:"array",items:{type:"object",properties:{operands:{type:"array",items:{type:["string","boolean","integer","number"]}},operator:{type:"string","enum":[">",">=","=","!=","<","<=","notNull"]}}}},j={type:"object",properties:{formatType:{type:"string","enum":["json","csv"],"default":"json"},url:{type:"string","default":void 0},vegaServer:{type:"object","default":null,properties:{table:{type:"string","default":void 0},url:{type:"string","default":"http://localhost:3001"}}}}};console.log(n.util.instantiate(j));var U={type:"object",properties:{width:{type:"integer","default":void 0},height:{type:"integer","default":void 0},viewport:{type:"array",items:{type:"integer"},"default":void 0},gridColor:{type:"string",role:"color","default":"#eeeeee"},filterNull:{type:"object",properties:{O:{type:"boolean","default":!1},Q:{type:"boolean","default":!0},T:{type:"boolean","default":!0}}},toggleSort:{type:"string","default":"O"},singleHeight:{type:"integer","default":200,minimum:0},singleWidth:{type:"integer","default":200,minimum:0},largeBandSize:{type:"integer","default":21,minimum:0},smallBandSize:{type:"integer","default":12,minimum:0},largeBandMaxCardinality:{type:"integer","default":10},cellPadding:{type:"number","default":.1},cellGridColor:{type:"string",role:"color","default":"#aaaaaa"},cellBackgroundColor:{type:"string",role:"color","default":"transparent"},textCellWidth:{type:"integer","default":90,minimum:0},strokeWidth:{type:"integer","default":2,minimum:0},timeScaleLabelLength:{type:"integer","default":3,minimum:0},characterWidth:{type:"integer","default":6}}};n.schema={$schema:"http://json-schema.org/draft-04/schema#",description:"Schema for vegalite specification",type:"object",required:["marktype","enc","data","config"],properties:{data:j,marktype:n.marktype,enc:{type:"object",properties:{x:E,y:T,row:L,col:C,size:M,color:N,alpha:P,shape:I,text:D,detail:R}},filter:z,config:U}},n.encTypes=r.keys(n.schema.properties.enc.properties),n.instantiate=function(){return n.util.instantiate(n.schema)}},{"../util":27,"./schemautil":26}],26:[function(e,t){"use strict";function n(e,t){if("object"!=typeof t||null===t)return e;for(var r in t)t.hasOwnProperty(r)&&void 0!==t[r]&&("object"!=typeof t[r]||null===t[r]?e[r]=t[r]:"object"!=typeof e[r]||null===e[r]?e[r]=n(t[r].constructor===Array?[]:{},t[r]):n(e[r],t[r]));return e}var r=t.exports={},i=e("../util"),a=function(e){return 0===Object.keys(e).length};r.extend=function(e,t){return r.merge(r.instantiate(t),e)},r.instantiate=function(e){var t;if(void 0===e)return void 0;if("default"in e)return t=e.default,i.isObject(t)?i.duplicate(t):t;if("object"===e.type){var n={};for(var a in e.properties)t=r.instantiate(e.properties[a]),void 0!==t&&(n[a]=t);return n}return"array"===e.type?[]:void 0},r.subtract=function(e,t){var n={};for(var o in e){var s=t[o],l=e[o];if(!t||s!==l)if("object"==typeof l&&!i.isArray(l)&&s){var c=r.subtract(l,s);a(c)||(n[o]=c)}else(!i.isArray(l)||l.length>0)&&(n[o]=l)}return n},r.merge=function(){for(var e=arguments[0],t=1;t<arguments.length;t++)e=n(e,arguments[t]);return e}},{"../util":27}],27:[function(e,t){"use strict";function n(e,t,n,r){for(;r>n;){var a=n+r>>>1;i.cmp(e[a],t)<0?n=a+1:r=a}return n}function r(e,t,n){var r=0,i=e.split(s);return e=n?(i=i.reverse()).filter(function(e){return r+=e.length,t>=r}).reverse():i.filter(function(e){return r+=e.length,t>=r}),e.length?e.join("").trim():i[0].slice(0,t)}var i=t.exports={};i.keys=function(e){var t,n=[];for(t in e)n.push(t);return n},i.vals=function(e){var t,n=[];for(t in e)n.push(e[t]);return n},i.range=function(e,t,n){if(arguments.length<3&&(n=1,arguments.length<2&&(t=e,e=0)),(t-e)/n==1/0)throw new Error("infinite range");var r,i=[],a=-1;if(0>n)for(;(r=e+n*++a)>t;)i.push(r);else for(;(r=e+n*++a)<t;)i.push(r);return i},i.find=function(e,t){var n=e.filter(function(e){return e[t.name]===t.value});return n.length&&n[0]||null},i.isin=function(e,t){return-1!==t.indexOf(e)},i.uniq=function(e,t){var n,r,i={},a=0;for(n=0;n<e.length;++n)r=e[n][t],i[r]||(i[r]=1,a+=1);return a};var a=function(e){return!isNaN(parseFloat(e))&&isFinite(e)};i.numbers=function(e){for(var t=[],n=0;n<e.length;n++)a(e[n])&&t.push(+e[n]);return t},i.dates=function(e){for(var t=[],n=0;n<e.length;n++){var r=Date.parse(e[n]);isNaN(r)||t.push(new Date(r))}return t},i.median=function(e){e.sort(function(e,t){return e-t});var t=Math.floor(e.length/2);return e.length%2?e[t]:(e[t-1]+e[t])/2},i.mean=function(e){return e.reduce(function(e,t){return e+t},0)/e.length},i.variance=function(e){for(var t=i.mean(e),n=[],r=0;r<e.length;r++)n.push(Math.pow(e[r]-t,2));return i.mean(n)},i.stablesort=function(e,t,n){var r={};return e.forEach(function(e,t){r[n(e)]=t}),e.sort(function(e,i){var a=t(e),o=t(i);return o>a?-1:a>o?1:r[n(e)]-r[n(i)]}),e},i.stdev=function(e){return Math.sqrt(i.variance(e))},i.skew=function(e){var t=i.mean(e),n=i.median(e),r=i.stdev(e);return 1*(t-n)/r},i.parse=function(e){if(a(e))return+e;var t=Date.parse(e);return isNaN(t)?e:new Date(t)},i.minmax=function(e){for(var t={min:+1/0,max:-1/0},n=0;n<e.length;++n){var r=e[n];null!==r&&((r>t.max||t.max===-1/0)&&(t.max=r),(r<t.min||t.min===+1/0)&&(t.min=r))}return t},i.duplicate=function(e){return JSON.parse(JSON.stringify(e))},i.isObject=function(e){return e===Object(e)},i.isArray=Array.isArray||function(e){return"[object Array]"==toString.call(e)},i.array=function(e){return e?i.isArray(e)?e:[e]:[]},i.forEach=function(e,t,n){if(e.forEach)e.forEach.call(n,t);else for(var r in e)t.call(n,e[r],r,e)},i.reduce=function(e,t,n,r){if(e.reduce)return e.reduce.call(r,t,n);for(var i in e)n=t.call(r,n,e[i],i,e);return n},i.map=function(e,t,n){if(e.map)return e.map.call(n,t);var r=[];for(var i in e)r.push(t.call(n,e[i],i,e))},i.any=function(e,t){var n,r=0;for(n in e)if(t(e[n],n,r++))return!0;return!1},i.all=function(e,t){var n,r=0;for(n in e)if(!t(e[n],n,r++))return!1;return!0},i.cmp=function(e,t){return t>e?-1:e>t?1:e>=t?0:null===e&&null===t?0:null===e?-1:null===t?1:0/0};var o=function(e,t){return i.keys(t).reduce(function(e,n){return e[n]=t[n],e},e)};i.merge=function(){for(var e=arguments[0],t=1;t<arguments.length;t++)e=o(e,arguments[t]);return e},i.getbins=function(e,t){return i.bins({min:e.min,max:e.max,maxbins:t})},i.bins=function(e){e=e||{};var t,r,i,a,o=e.maxbins||1024,s=e.base||10,l=e.div||[5,2],c=e.minstep||0,u=Math.log(s),d=Math.ceil(Math.log(o)/u),f=e.min,p=e.max,h=p-f,g=Math.max(c,Math.pow(s,Math.round(Math.log(h)/u)-d)),m=Math.ceil(h/g);if(e.step)g=e.step;else if(e.steps)g=e.steps[Math.min(e.steps.length-1,n(e.steps,h/o,0,e.steps.length))];else{do g*=s,m=Math.ceil(h/g);while(m>o);for(i=0;i<l.length;++i)r=g/l[i],r>=c&&o>=h/r&&(g=r,m=Math.ceil(h/g))}return r=Math.log(g),t=r>=0?0:~~(-r/u)+1,a=(0>f?-1:1)*Math.pow(s,-t-1),f=Math.min(f,Math.floor(f/g+a)*g),p=Math.ceil(p/g)*g,{start:f,stop:p,step:g,unit:t}},i.setter=function(e,t,n,r){for(var i=0;i<t.length-1;++i)e=r||t[i]in e?e[t[i]]:e[t[i]]={};e[t[i]]=n},i.getter=function(e,t,n){for(var r=0;r<t.length;++r)e=n||t[r]in e?e[t[r]]:e[t[r]]={};return e},i.truncate=function(e,t,n,i,a){var o=e.length;if(t>=o)return e;a=a||"...";var s=Math.max(0,t-a.length);switch(n){case"left":return a+(i?r(e,s,1):e.slice(o-s));case"middle":case"center":var l=Math.ceil(s/2),c=Math.floor(s/2);return(i?r(e,l):e.slice(0,l))+a+(i?r(e,c,1):e.slice(o-c));default:return(i?r(e,s):e.slice(0,s))+a}};var s=/([\u0009\u000A\u000B\u000C\u000D\u0020\u00A0\u1680\u180E\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200A\u202F\u205F\u2028\u2029\u3000\uFEFF])/;
i.error=function(e){console.error("[VL Error]",e)}},{}]},{},[1])(1)}),angular.module("polestar",["ngAnimate","ngCookies","ngSanitize","ngTouch","ngDragDrop","monospaced.elastic","zeroclipboard","ui.router","Chronicle","LocalStorageModule","720kb.tooltips","ngOrderObjectBy","angular-websql"]).constant("_",window._).constant("vl",window.vl).constant("vg",window.vg).constant("Papa",window.Papa).constant("ZSchema",window.ZSchema).constant("Tether",window.Tether).constant("Drop",window.Drop).constant("Blob",window.Blob).constant("URL",window.URL).constant("jsondiffpatch",window.jsondiffpatch).constant("consts",{addCount:!0,debug:!0,useUrl:!0,logging:!1,defaultConfigSet:"large",appId:"polestar"}).config(["uiZeroclipConfigProvider",function(e){e.setZcConf({swfPath:"bower_components/zeroclipboard/dist/ZeroClipboard.swf"})}]).config(["localStorageServiceProvider",function(e){e.setPrefix("polestar")}]).config(["$stateProvider","$urlRouterProvider",function(e,t){e.state("home",{url:"/",templateUrl:"app/main/main.html",controller:"MainCtrl"}),t.otherwise("/")}]),angular.module("polestar").filter("underscore2space",function(){return function(e){return e?e.replace(/_+/g," "):""}}),angular.module("polestar").filter("scaleType",function(){return function(e){var t={Q:"Quantitative",O:"Ordinal",T:"Time"};return t[e]}}),angular.module("polestar").filter("reportUrl",["compactJSONFilter","_","consts",function(e,t,n){function r(n){var r="https://docs.google.com/forms/d/1T9ZA14F3mmzrHR7JJVUKyPXzrMqF54CjLIOjv2E7ZEM/viewform?";if(n.fields){var i=encodeURI(e(t.values(n.fields)));r+="entry.1245199477="+i+"&"}if(n.encoding){var a=t.omit(n.encoding,"config");a=encodeURI(e(a)),r+="entry.1323680136="+a+"&"}if(n.encoding2){var o=t.omit(n.encoding2,"config");o=encodeURI(e(o)),r+="entry.853137786="+o+"&"}var s="entry.1940292677=";switch(n.type){case"vl":r+=s+"Visualization+Rendering+(Vegalite)&";break;case"vr":r+=s+"Recommender+Algorithm+(Visrec)&";break;case"fv":r+=s+"Recommender+UI+(FacetedViz)&"}return r}function i(n){var r="https://docs.google.com/forms/d/1xKs-qGaLZEUfbTmhdmSoS13OKOEpuu_NNWE5TAAml_Y/viewform?";if(n.encoding){var i=t.omit(n.encoding,"config");i=encodeURI(e(i)),r+="entry.1245199477="+i+"&"}return r}return"voyager"===n.appId?r:i}]),angular.module("polestar").filter("encodeURI",function(){return function(e){return window.encodeURI(e)}}),angular.module("polestar").filter("compactJSON",function(){return function(e){return JSON.stringify(e,null,"  ",80)}}),angular.module("polestar").directive("vlPlotGroup",["Bookmarks","consts","vl","Dataset","Drop","Logger",function(e,t,n,r,i,a){var o;return{templateUrl:"components/vlplotgroup/vlplotgroup.html",restrict:"E",replace:!0,scope:{chart:"=",disabled:"=",isInList:"=",fieldSet:"=",showBookmark:"@",showDebug:"=",showExpand:"=",showFilterNull:"@",showLog:"@",showMarkType:"@",showSort:"@",showTranspose:"@",showLabel:"@",configSet:"@",alwaysSelected:"=",isSelected:"=",highlighted:"=",expandAction:"&",maxHeight:"=",maxWidth:"=",overflow:"=",alwaysScrollable:"=",rescale:"=",tooltip:"=",thumbnail:"="},link:function(s,l){s.Bookmarks=e,s.consts=t,s.Dataset=r,s.log={},s.log.support=function(e,t){if(!e)return!1;var n=e.enc,r=n[t];return r&&"Q"===r.type&&!r.bin},s.log.toggle=function(e,t){if(s.log.support(e,t)){var n=e.enc[t],r=n.scale=n.scale||{};r.type="log"===r.type?"linear":"log",a.logInteraction(a.actions.LOG_TOGGLE,s.chart.shorthand)}},s.log.active=function(e,t){if(s.log.support(e,t)){var n=e.enc[t],r=n.scale=n.scale||{};return"log"===r.type}};var c=s.toggleSort=function(e){a.logInteraction(a.actions.SORT_TOGGLE,s.chart.shorthand),n.Encoding.toggleSort(e)};c.support=n.Encoding.toggleSort.support,s.toggleFilterNull=function(e,t){a.logInteraction(a.actions.NULL_FILTER_TOGGLE,s.chart.shorthand),n.Encoding.toggleFilterNullO(e,t)},s.toggleFilterNull.support=n.Encoding.toggleFilterNullO.support,o=new i({content:l.find(".dev-tool")[0],target:l.find(".fa-wrench")[0],position:"bottom right",openOn:"click",constrainToWindow:!0}),s.toggleSortClass=function(e){var t=e&&n.Encoding.toggleSort.direction(e),r=e&&n.Encoding.toggleSort.mode(e);return"y"===t?"Q"===r?"fa-sort-amount-desc":"fa-sort-alpha-asc":"x"===t?"Q"===r?"fa-sort-amount-desc sort-x":"fa-sort-alpha-asc sort-x":"invisible"},s.transpose=function(){a.logInteraction(a.actions.TRANSPOSE_TOGGLE,s.chart.shorthand),n.Encoding.transpose(s.chart.vlSpec)}}}}]),angular.module("polestar").directive("vlPlot",["vl","vg","$timeout","$q","Dataset","Config","consts","_","$document","Logger",function(e,t,n,r,i,a,o,s,l,c){function u(e,t){return e>f||t>f||e*t>p?"svg":"canvas"}var d=0,f=16383.5,p=67108864,h=[],g=!1;return{templateUrl:"components/vlplot/vlplot.html",restrict:"E",scope:{vgSpec:"=",vlSpec:"=",disabled:"=",isInList:"=",fieldSetKey:"=",shorthand:"=",maxHeight:"=",maxWidth:"=",alwaysScrollable:"=",overflow:"=",tooltip:"=",configSet:"@",rescale:"=",thumbnail:"="},replace:!0,link:function(r,f){function p(e,i){i.datum.data&&(r.tooltipPromise=n(function(){r.tooltipActive=!0,c.logInteraction(c.actions.CHART_TOOLTIP,i.datum),r.data=s.pairs(i.datum.data).map(function(e){return e.isNumber=t.isNumber(e[1]),e}),r.$digest();var n=f.find(".vis-tooltip"),a=angular.element(l),o=n.width(),u=n.height();e.pageY+10+u<a.height()?n.css("top",e.pageY+10):n.css("top",e.pageY-10-u),e.pageX+10+o<a.width()?n.css("left",e.pageX+10):n.css("left",e.pageX-10-o)},S))}function m(){var e=f.find(".vis-tooltip");e.css("top",null),e.css("left",null),n.cancel(r.tooltipPromise),r.tooltipActive=!1,r.data=[],r.$digest()}function v(){return o.defaultConfigSet&&r.configSet&&o.defaultConfigSet!==r.configSet?null:r.vgSpec}function y(){var t=r.configSet||o.defaultConfigSet||{},n=s.cloneDeep(r.vlSpec);return e.merge(n.config,a[t]()),e.compile(n,i.stats)}function b(){if(r.rescale){for(var e=r.maxWidth>0?r.maxWidth/r.width:1,t=r.maxHeight>0?r.maxHeight/r.height:1,n=Math.min(e,t),i=1;.75*i>n;)i/=2;var a=100*i/2&&0;f.find(".vega").css("transform","translate(-"+a+"%, -"+a+"%) scale("+i+")")}else f.find(".vega").css("transform",null)}function x(){h.length>0?h.shift()():g=!1}function k(n){function a(){if(r.disabled||r.isInList&&r.fieldSetKey&&!r.isInList(r.fieldSetKey))return console.log("cancel rendering",s),void x();var e=(new Date).getTime();t.parse.spec(n,function(t){var a=(new Date).getTime();_=null,_=t({el:f[0]}),o.useUrl||_.data({raw:i.data}),r.width=_.width(),r.height=_.height(),_.renderer(u(n.width,r.height)),_.update(),c.logInteraction(c.actions.CHART_RENDER,r.vlSpec),b();var l=(new Date).getTime();console.log("parse spec",a-e,"charting",l-a,s),r.tooltip&&(_.on("mouseover",p),_.on("mouseout",m)),x()})}if(!n)return void(_&&(_.off("mouseover"),_.off("mouseout")));r.height=n.height,f||console.error("can not find vis element");var s=r.shorthand||(r.vlSpec?e.Encoding.shorthand(r.vlSpec):"");r.renderer=u(n),g?h.push(a):(g=!0,a())}var w=500,S=250;r.visId=d++,r.hoverPromise=null,r.tooltipPromise=null,r.hoverFocus=!1,r.tooltipActive=!1,r.mouseover=function(){r.hoverPromise=n(function(){c.logInteraction(c.actions.CHART_MOUSEOVER,r.vlSpec),r.hoverFocus=!r.thumbnail},w)},r.mouseout=function(){r.hoverFocus&&c.logInteraction(c.actions.CHART_MOUSEOUT,r.vlSpec),n.cancel(r.hoverPromise),r.hoverFocus=r.unlocked=!1};var _;r.$watch("vgSpec",function(){var e=v();k(e)},!0),r.$watch("vlSpec",function(){var e=v();if(!e){var t=y();k(t)}},!0)}}}]),angular.module("polestar").directive("vlSpecEditor",["Spec",function(e){return{templateUrl:"components/vlSpecEditor/vlSpecEditor.html",restrict:"E",scope:{},link:function(t){t.Spec=e,t.parseShorthand=e.parseShorthand,t.parseVegalite=function(t){e.parseSpec(JSON.parse(t))}}}}]),angular.module("polestar").directive("vgSpecEditor",["Spec",function(e){return{templateUrl:"components/vgSpecEditor/vgSpecEditor.html",restrict:"E",scope:{},link:function(t){t.Spec=e}}}]),angular.module("polestar").directive("shelves",function(){return{templateUrl:"components/shelves/shelves.html",restrict:"E",scope:{},replace:!0,controller:["$scope","vl","jsondiffpatch","Spec","Config","Dataset","Logger","Pills",function(e,t,n,r,i,a,o,s){e.Spec=r,e.schema=t.schema.schema,e.pills=s,e.markChange=function(){o.logInteraction(o.actions.MARK_CHANGE,r.spec.marktype)},e.transpose=function(){t.Encoding.transpose(r.spec)},e.clear=function(){r.reset()},e.$watch("Spec.spec",function(e,t){o.logInteraction(o.actions.SPEC_CHANGE,e,n.diff(t,e)),r.update(e)},!0)}]}}),angular.module("polestar").directive("schemaListItem",["Pills",function(e){return{templateUrl:"components/schemalistitem/schemalistitem.html",restrict:"E",replace:!1,scope:{field:"="},link:function(t){t.getSchemaPill=e.getSchemaPill,t.fieldDragStart=function(){t.pill=e.getSchemaPill(t.field),e.dragStart(t.pill,null)},t.fieldDragStop=e.dragStop}}}]),angular.module("polestar").directive("schemaList",["Dataset",function(e){return{templateUrl:"components/schemalist/schemalist.html",restrict:"E",scope:{},replace:!0,controller:["$scope",function(t){t.Dataset=e}]}}]),angular.module("polestar").directive("propertyEditor",function(){return{templateUrl:"components/propertyeditor/propertyeditor.html",restrict:"E",scope:{id:"=",type:"=","enum":"=",propName:"=",group:"="},link:function(){}}}),angular.module("polestar").directive("nullFilterDirective",["Spec",function(e){return{templateUrl:"components/nullfilterdirective/nullfilterdirective.html",restrict:"E",scope:{},link:function(t){t.Spec=e,t.updateFilter=function(){e.update()}}}}]),angular.module("polestar").directive("markTypeSelect",function(){return{templateUrl:"components/marktypeselect/marktypeselect.html",restrict:"E",replace:!0,scope:{},link:function(e,t){t.text("this is the markTypeSelect directive")}}}),angular.module("polestar").directive("lyraExport",function(){return{template:'<a href="#" class="command" ng-click="export()">Export to lyra</a>',restrict:"E",replace:!0,scope:{},controller:["$scope","$timeout","Spec","Alerts",function(e,t,n,r){e.export=function(){var e=n.vgSpec;e||r.add("No vega spec present."),e.marks[0]["lyra.groupType"]="layer";var i="http://idl.cs.washington.edu/projects/lyra/app/",a=window.open(i,"_blank");t(function(){r.add("Please check whether lyra loaded the vega spec correctly. This feature is experimental and may not work.",5e3),a.postMessage({spec:e},i)},5e3)}}]}}),angular.module("polestar").directive("jsonInput",function(){return{restrict:"A",require:"ngModel",scope:{},link:function(e,t,n,r){var i=function(e){return JSON.stringify(e,null,"  ",80)};r.$formatters.push(i)}}}),angular.module("polestar").directive("functionSelect",["_","vl","Pills","Logger",function(e,t,n,r){return{templateUrl:"components/functionselect/functionselect.html",restrict:"E",scope:{encType:"=",schema:"=",field:"="},link:function(i){function a(){return n?n.pills[i.encType]:null}function o(e){var t=i.schema.properties;return!t.fn||t.fn.supportedTypes&&!t.fn.supportedTypes[e]?[]:(t.fn.supportedEnums?t.fn.supportedEnums[e]:t.fn.enum)||[]}function s(e){var t=i.schema.properties;return e?!t.aggr||t.aggr.supportedTypes&&!t.aggr.supportedTypes[e]?[]:(t.aggr.supportedEnums?t.aggr.supportedEnums[e]:t.aggr.enum)||[]:[d]}var l,c="bin",u="",d="count";i.pills=n.pills,i.func={selected:u,list:[u]},i.selectChanged=function(){r.logInteraction(r.actions.FUNC_CHANGE,i.func.selected)},i.$watch("func.selected",function(r){var u=a(),d=e.clone(u),f=d?d.type:"";d&&(d.bin=r===c?{maxbins:l||t.schema.MAXBINS_DEFAULT}:void 0,d.aggr=-1!==s(f).indexOf(r)?r:void 0,d.fn=-1!==o(f).indexOf(r)?r:void 0,e.isEqual(u,d)||(n.pills[i.encType]=d,n.update(i.encType)))}),i.$watch("field",function(e){if(i.schema&&e){var n=e.name?e.type:"",r=i.schema.properties;e.bin&&(l=e.bin.maxbins);var a=-1!==["row","col","shape"].indexOf(i.encType),f="Q"===n,p="T"===n;if("*"===e.name&&e.aggr===d)i.func.list=[d],i.func.selected=d;else{i.func.list=(a&&(f||p)?[]:[""]).concat(o(n)).concat(s(n).filter(function(e){return e!==d})).concat(r.bin&&r.bin.supportedTypes[n]?["bin"]:[]);var h=a&&f&&c||p&&t.schema.defaultTimeFn||u,g=e.bin?"bin":e.aggr||e.fn||h;i.func.selected=i.func.list.indexOf(g)>=0?g:h}}},!0)}}}]),angular.module("polestar").directive("fieldInfo",["Dataset","Drop",function(e,t){return{templateUrl:"components/fieldinfo/fieldinfo.html",restrict:"E",replace:!0,scope:{field:"=",showType:"=",showInfo:"=",showCaret:"=",popupContent:"=",showRemove:"=",removeAction:"&",action:"&",disableCountOrOCaret:"="},link:function(n,r){var i;n.typeNames=e.typeNames,n.stats=e.stats[n.field.name],n.count=e.stats.count,n.clicked=function(e){n.action&&e.target!==r.find(".fa-caret-down")[0]&&e.target!==r.find("span.type")[0]&&n.action(e)},n.func=function(e){return e.aggr||e.fn||e.bin&&"bin"||e._aggr||e._fn||e._bin&&"bin"||e._any&&"-, sum"},n.$watch("popupContent",function(e){e&&(i=new t({content:e,target:r.find(".type-caret")[0],position:"bottom left",openOn:"click"}))})}}}]),angular.module("polestar").directive("fieldDefEditor",["Dataset","Pills","_","Drop","Logger",function(e,t,n,r,i){return{templateUrl:"components/fielddefeditor/fielddefeditor.html",restrict:"E",replace:!0,scope:{encType:"=",enc:"=",schema:"=fieldDefSchema",marktype:"="},link:function(a,o){function s(){return t.pills[a.encType]}var l,c;a.allowedCasting={Q:["Q","O"],O:["O"],T:["T","O"],G:["G","O"]},a.Dataset=e,a.typeNames=e.typeNames,a.pills=t.pills,l=new r({content:o.find(".shelf-properties")[0],target:o.find(".shelf-label")[0],position:"bottom left",openOn:"click"}),a.fieldInfoPopupContent=o.find(".shelf-functions")[0],a.removeField=function(){t.remove(a.encType)},a.fieldDragStart=function(){t.dragStart(t[a.encType],a.encType)},a.fieldDragStop=function(){t.dragStop()},a.fieldDropped=function(){var e=s();c&&(c=null);var r=a.schema.properties.type.enum;n.contains(r,e.type)||(e.type=r[0]),t.dragDrop(a.encType),i.logInteraction(i.actions.FIELD_DROP,a.enc[a.encType])},a.$watch("enc[encType]",function(e){t.pills[a.encType]=e?n.cloneDeep(e):{}}),a.$watchGroup(["allowedCasting[Dataset.dataschema.byName[enc[encType].name].type]","enc[encType].aggr"],function(e){var t=e[0],n=e[1];a.allowedTypes="count"===n?["Q"]:t})}}}]),angular.module("polestar").directive("datasetSelector",["Dataset","Config","Spec","Logger",function(e,t,n,r){return{templateUrl:"components/datasetselector/datasetselector.html",restrict:"E",replace:!0,scope:{},controller:["$scope",function(i){i.Dataset=e,i.datasetChanged=function(){var i=e.dataset;r.logInteraction(r.actions.DATASET_CHANGE,i.name),e.update(i).then(function(){t.updateDataset(e.dataset,e.type),n.reset()})}}]}}]),angular.module("polestar").directive("configurationEditor",function(){return{templateUrl:"components/configurationeditor/configurationeditor.html",restrict:"E",scope:{},controller:["$scope","Config",function(e,t){e.Config=t}]}}),angular.module("polestar").directive("bookmarkList",["Bookmarks","consts",function(e,t){return{templateUrl:"components/bookmarklist/bookmarklist.html",restrict:"E",replace:!0,scope:{active:"=",deactivate:"&",highlighted:"="},link:function(n){n.Bookmarks=e,n.consts=t}}}]),angular.module("polestar").directive("alertMessages",["Alerts",function(e){return{templateUrl:"components/alertmessages/alertmessages.html",restrict:"E",scope:{},link:function(t){t.Alerts=e}}}]),angular.module("polestar").directive("addDataset",["Dataset","Drop",function(e,t){return{templateUrl:"components/adddataset/adddataset.html",restrict:"E",replace:!0,scope:{},link:function(n,r){n.dataset={},n.add=function(t){e.add(angular.copy(t)),n.dataset.name="",n.dataset.url="",i.close()};var i=new t({content:r.find(".popup-new-dataset")[0],target:r.find(".open-dataset-popup")[0],position:"bottom left",openOn:"click"});n.$on("$destroy",function(){i.destroy(),i=null})}}}]),angular.module("polestar").service("Spec",["_","vl","ZSchema","Alerts","Config","Dataset",function(e,t,n,r,i,a){function o(n){for(var r in n)e.isObject(n[r])&&o(n[r]),(null===n[r]||void 0===n[r]||e.isObject(n[r])&&0===t.keys(n[r]).length||n[r]===[])&&delete n[r]}var s={spec:null,vlSpec:null,encoding:null,shorthand:null,vgSpec:null};return s._removeEmptyFieldDefs=function(t){t.enc=e.omit(t.enc,function(e){return!e||void 0===e.name&&void 0===e.value})},s.parseShorthand=function(e){var n=t.Encoding.parseShorthand(e,i.config).toSpec();s.parseSpec(n)},s.parseSpec=function(e){s.spec=t.schema.util.merge(s.instantiate(),e)},s.instantiate=function(){var e=t.schema.instantiate();return e.marktype=t.schema.schema.properties.marktype.enum[0],e.config=i.config,e.data=i.data,e},s.reset=function(){s.spec=s.instantiate()},s.update=function(l){l||(l=s.spec);var c=e.cloneDeep(l);s._removeEmptyFieldDefs(c),o(c),"enc"in c||(c.enc={});var u=new n;u.setRemoteReference("http://json-schema.org/draft-04/schema",{});var d=t.schema.schema,f=u.validate(c,d);f?(t.merge(c.config,i.large()),s.encoding=t.Encoding.fromSpec(c),s.vlSpec=s.encoding.toSpec(!1),s.shorthand=s.encoding.toShorthand(),s.vgSpec=t.compile.encoding(s.encoding,a.stats),s.chart={fieldSet:e.values(s.vlSpec.enc),vlSpec:s.spec,vgSpec:s.vgSpec,shorthand:s.shorthand}):r.add({msg:u.getLastErrors()})},s.reset(),s}]),angular.module("polestar").service("Pills",["vl","Spec","_","$window",function(e,t,n,r){function i(t){return e.schema.util.instantiate(o[t])}function a(t,n,a){var s=n.type,l=e.schema.getSupportedRole(a),c=l.dimension&&!l.measure;n.name&&c?"count"===n.aggr?(n={},r.alert("COUNT not supported here!")):"Q"!==s||n.bin?"T"!==s||n.fn||(n.fn=e.schema.defaultTimeFn):(n.aggr=void 0,n.bin={maxbins:e.schema.MAXBINS_DEFAULT}):n.name||(n={});var u=i(a),d=o[a].properties;for(var f in d)n[f]&&("value"===f&&n.name?delete u[f]:u[f]=n[f]);t[a]=u}var o=e.schema.schema.properties.enc.properties,s={pills:{}};return s.getSchemaPill=function(e){return{name:e.name,type:e.type,aggr:e.aggr}},s.remove=function(e){delete s.pills[e],a(t.spec.enc,{},e)},s.update=function(e){a(t.spec.enc,s.pills[e],e)},s.dragStart=function(e,t){s.pills.dragging=e,s.pills.etDragFrom=t},s.dragStop=function(){delete s.pills.dragging},s.dragDrop=function(e){var r=n.clone(t.spec.enc),i=s.pills.etDragFrom;i&&a(r,s.pills[i]||{},i),a(r,s.pills[e]||{},e),t.spec.enc=r,i=null},s}]),angular.module("polestar").controller("MainCtrl",["$scope","$document","Spec","Dataset","Config","consts","Chronicle","Logger","Bookmarks",function(e,t,n,r,i,a,o,s,l){e.Spec=n,e.Dataset=r,e.Config=i,e.Logger=s,e.Bookmarks=l,e.consts=a,e.showDevPanel=!1,e.canUndo=!1,e.canRedo=!1,e.showBookmark=!1,e.hideBookmark=function(){e.showBookmark=!1},l.load(),r.update(r.dataset).then(function(){i.updateDataset(r.dataset),e.chron=o.record("Spec.spec",e,!0,["Dataset.dataset","Dataset.dataschema","Dataset.stats","Config.config"]),e.canUndoRedo=function(){e.canUndo=e.chron.canUndo(),e.canRedo=e.chron.canRedo()},e.chron.addOnAdjustFunction(e.canUndoRedo),e.chron.addOnUndoFunction(e.canUndoRedo),e.chron.addOnRedoFunction(e.canUndoRedo),e.chron.addOnUndoFunction(function(){s.logInteraction(s.actions.UNDO)}),e.chron.addOnRedoFunction(function(){s.logInteraction(s.actions.REDO)}),angular.element(t).on("keydown",function(t){return t.keyCode!=="Z".charCodeAt(0)||!t.ctrlKey&&!t.metaKey||t.shiftKey?t.keyCode==="Y".charCodeAt(0)&&(t.ctrlKey||t.metaKey)?(e.chron.redo(),e.$digest(),!1):t.keyCode==="Z".charCodeAt(0)&&(t.ctrlKey||t.metaKey)&&t.shiftKey?(e.chron.redo(),e.$digest(),!1):void 0:(e.chron.undo(),e.$digest(),!1)})})}]),angular.module("polestar").service("Logger",["$location","$window","$webSql","consts","Papa","Blob","URL",function(e,t,n,r,i,a,o){var s={},l=e.search().user;return s.db=n.openDatabase("logs","1.0","Logs",2097152),s.tableName="log_"+r.appId,s.actions={UNDO:"UNDO",REDO:"REDO",DATASET_CHANGE:"DATASET_CHANGE",CHART_MOUSEOVER:"CHART_MOUSEOVER",CHART_MOUSEOUT:"CHART_MOUSEOUT",CHART_RENDER:"CHART_RENDER",CHART_EXPOSE:"CHART_EXPOSE",CHART_TOOLTIP:"CHART_TOOLTIP",BOOKMARK_ADD:"BOOKMARK_ADD",BOOKMARK_REMOVE:"BOOKMARK_REMOVE",BOOKMARKS_CLEAR:"BOOKMARKS_CLEAR",NULL_FILTER_TOGGLE:"NULL_FILTER_TOGGLE",TRANSPOSE_TOGGLE:"TRANSPOSE_TOGGLE",SORT_TOGGLE:"SORT_TOGGLE",MARKTYPE_TOGGLE:"MARKTYPE_TOGGLE",LOG_TOGGLE:"LOG_TOGGLE",FUNC_CHANGE:"FUNC_CHANGE",SPEC_CHANGE:"SPEC_CHANGE",FIELD_DROP:"FIELD_DROP",MARK_CHANGE:"MARK_CHANGE",FIELDS_CHANGE:"FIELDS_CHANGE",FIELDS_RESET:"FIELDS_RESET",DRILL_DOWN_OPEN:"DRILL_DOWN_OPEN",DRILL_DOWN_CLOSE:"DRILL_DOWN_CLOSE",CLUSTER_SELECT:"CLUSTER_SELECT",LOAD_MORE:"LOAD_MORE"},s.createTableIfNotExists=function(){s.db.createTable(s.tableName,{userid:{type:"INTEGER","null":"NOT NULL"},time:{type:"TIMESTAMP","null":"NOT NULL","default":"CURRENT_TIMESTAMP"},action:{type:"TEXT","null":"NOT NULL"},data:{type:"TEXT"},diff:{type:"TEXT"}})},s.clear=function(){var e=t.confirm("Really clear the logs?");e===!0&&(s.db.dropTable(s.tableName),s.createTableIfNotExists())},s.export=function(){s.db.selectAll(s.tableName).then(function(e){if(0===e.rows.length)return void console.warn("No logs");for(var t=[],n=0;n<e.rows.length;n++)t.push(e.rows.item(n));var r=i.unparse(t),l=new a([r],{type:"text/csv"}),c=o.createObjectURL(l),u=angular.element("<a/>");u.attr({href:c,target:"_blank",download:s.tableName+".csv"})[0].click()})},s.logInteraction=function(e,t,n){if(r.logging){var i={userid:l,action:e};void 0!==t&&(i.data=JSON.stringify(t)),void 0!==n&&(i.diff=JSON.stringify(n)),s.db.insert(s.tableName,i).then(function(){})}},s.createTableIfNotExists(),s}]);var datasets=[{name:"Barley",url:"data/barley.json",id:"barley"},{name:"Cars",url:"data/cars.json",id:"cars"},{name:"Crimea",url:"data/crimea.json",id:"crimea"},{name:"Driving",url:"data/driving.json",id:"driving"},{name:"Iris",url:"data/iris.json",id:"iris"},{name:"Jobs",url:"data/jobs.json",id:"jobs"},{name:"Population",url:"data/population.json",id:"population"},{name:"Movies",url:"data/movies.json",id:"movies"},{name:"Birdstrikes",url:"data/birdstrikes.json",id:"birdstrikes"},{name:"Burtin",url:"data/burtin.json",id:"burtin"},{name:"Budget 2016",url:"data/budget.json",id:"budget"},{name:"Climate Normals",url:"data/climate.json",id:"climate"},{name:"Campaigns",url:"data/weball26.json",id:"weball26"}];angular.module("polestar").factory("Dataset",["$http","Alerts","_","Papa","vl","consts",function(e,t,n,r,i,a){var o={},s=i.field.count();return o.datasets=datasets,o.dataset=datasets[1],o.dataschema=[],o.dataschema.byName={},o.stats={},o.type=void 0,o.typeNames={O:"text",Q:"number",T:"time",G:"geo"},o.fieldOrder=i.field.order.typeThenName,o.update=function(l){return e.get(l.url,{cache:!0}).then(function(e){if(n.isObject(e.data))o.data=e.data,o.type="json";else{var l=r.parse(e.data,{dynamicTyping:!0,header:!0});if(0!==l.errors.length)return void n.each(l.errors,function(e){t.add(e.message,2e3)});o.data=l.data,o.type="csv"}var c=i.data.getSchema(o.data);a.addCount&&c.push(s),o.dataschema=c,o.dataschema.byName=getNameMap(o.dataschema),o.stats=i.data.getStats(o.data),n.each(o.dataschema,function(e){var t=o.stats[e.name];void 0!==t&&"Q"===e.type&&t.cardinality<=20&&(t.cardinality<(t.count-t.numNulls)/50||t.cardinality<=7)&&(e.type="O")})})},o.add=function(e){e.id||(e.id=e.url),datasets.push(e)},o}]),angular.module("polestar").factory("Config",["vl","_",function(e,t){var n={};return n.schema=e.schema.schema.properties.config,n.dataschema=e.schema.schema.properties.data,n.data=e.schema.util.instantiate(n.dataschema),n.config=e.schema.util.instantiate(n.schema),n.getConfig=function(){return t.cloneDeep(n.config)},n.getData=function(){return t.cloneDeep(n.data)},n.large=function(){return{singleWidth:400,singleHeight:400,largeBandMaxCardinality:20}},n.small=function(){return{}},n.updateDataset=function(e,t){n.data.url=e.url,n.data.formatType=t},n}]),angular.module("polestar").service("Bookmarks",["_","vl","localStorageService","Logger",function(e,t,n,r){var i=function(){this.dict={},this.length=0},a=i.prototype;return a.updateLength=function(){this.length=Object.keys(this.dict).length},a.save=function(){n.set("bookmarks",this.dict)},a.load=function(){this.dict=n.get("bookmarks")||{},this.updateLength()},a.clear=function(){this.dict={},this.updateLength(),this.save(),r.logInteraction(r.actions.BOOKMARKS_CLEAR)},a.toggle=function(e){var t=e.shorthand;this.dict[t]?this.remove(e):this.add(e)},a.add=function(t){var n=t.shorthand;console.log("adding",t.vlSpec,n),t.timeAdded=(new Date).getTime(),this.dict[n]=e.cloneDeep(t),this.updateLength(),this.save(),r.logInteraction(r.actions.BOOKMARK_ADD,n)},a.remove=function(e){var t=e.shorthand;console.log("removing",e.vlSpec,t),delete this.dict[t],this.updateLength(),this.save(),r.logInteraction(r.actions.BOOKMARK_REMOVE,t)},a.isBookmarked=function(e){return e in this.dict},new i}]),angular.module("polestar").service("Alerts",["$timeout","_",function(e,t){var n={};return n.alerts=[],n.add=function(r,i){var a={msg:r};n.alerts.push(a),i&&e(function(){var e=t.findIndex(n.alerts,a);n.closeAlert(e)},i)},n.closeAlert=function(e){n.alerts.splice(e,1)},n}]),angular.module("vleApp").run(["$templateCache",function(e){e.put("components/adddataset/adddataset.html",'<div><a class="open-dataset-popup"><i class="fa fa-plus"></i> Add dataset</a><div class="drop-container"><div class="popup-menu popup-new-dataset"><h3>Add a dataset</h3><p>Add the name of the dataset and the URL to a <b>JSON</b> or <b>CSV</b> (with header) file. Make sure that the formatting is correct and clean the data before adding it to Voyager. Also make sure that you host the file on a server that has <code>Access-Control-Allow-Origin: *</code> set. The added dataset is only visible to you.</p><form><div class="form-group"><label for="dataset-name">Name</label> <input ng-model="dataset.name" id="dataset-name" type="text"></div><div class="form-group"><label for="dataset-url">URL</label> <input ng-model="dataset.url" id="dataset-url" type="url"></div><button type="submit" ng-click="add(dataset)">Add dataset</button></form></div></div></div>'),e.put("app/main/main.html",'<div class="flex-root vflex full-width full-height"><div class="full-width no-shrink"><div class="card no-right-margin no-top-margin"><div class="right"><div class="controls"><span ng-show="consts.debug"><a ng-href="{{ {encoding:Spec.vlSpec} | reportUrl }}" target="_blank" class="command debug" tooltips="" tooltip-size="small" tooltip-content="Report an issue"><i class="fa fa-bug"></i></a> <a class="command debug" ng-click="showDevPanel = !showDevPanel" tooltips="" tooltip-size="small" tooltip-content="Debug Tool"><i class="fa fa-wrench"></i></a></span><a class="command" ng-click="showBookmark=true"><i class="fa fa-bookmark"></i> Bookmarks ({{Bookmarks.length}})</a> <a class="command" ng-click="chron.undo()" ng-class="{disabled: !canUndo}"><i class="fa fa-undo"></i> Undo</a> <a class="command" ng-click="chron.redo()" ng-class="{disabled: !canRedo}"><i class="fa fa-repeat"></i> Redo</a></div></div><h1>Pole</h1></div><alert-messages></alert-messages></div><div class="hflex full-width main-panel grow-1"><div class="pane data-pane noselect"><div class="card abs-100"><div class="right"><dataset-selector></dataset-selector><add-dataset></add-dataset></div><h2>Data</h2><schema-list></schema-list></div></div><div class="pane encoding-pane"><shelves></shelves></div><div class="pane vis-pane"><vl-plot-group class="card abs-100 no-right-margin full-vl-plot-group" chart="Spec.chart" show-bookmark="true" show-filter-null="true" show-log="true" show-mark-type="true" show-sort="true" show-transpose="true" config-set="large" show-label="true" tooltip="true" always-scrollable="true"></vl-plot-group></div></div><div class="hflex full-width dev-panel" ng-show="showDevPanel"><div class="pane"><div class="card"><button ng-click="Logger.clear()">Clear logs</button><br><button ng-click="Logger.export()">Download logs</button></div></div><div class="pane config-pane"><div class="card scroll-y abs-100"><configuration-editor></configuration-editor></div></div><div class="pane vl-pane"><vl-spec-editor></vl-spec-editor></div><div class="pane vg-pane"><vg-spec-editor></vg-spec-editor></div></div></div><bookmark-list active="showBookmark" deactivate="hideBookmark();" highlighted="{}"></bookmark-list>'),e.put("components/bookmarklist/bookmarklist.html",'<div class="modal" ng-show="active"><div class="wrapper"><div class="vflex full-width full-height" id="evs" ng-if="active"><div class="modal-header no-shrink card no-top-margin no-right-margin"><div class="right"><a ng-click="deactivate()" class="right">Close</a></div><h2 class="no-bottom-margin">Bookmarks ({{ Bookmarks.length }})</h2><a ng-click="Bookmarks.clear()"><i class="fa fa-trash-o"></i> Clear all</a></div><div class="flex-grow-1 scroll-y"><div ng-if="Bookmarks.length > 0" class="vis-list hflex flex-wrap"><vl-plot-group ng-repeat="chart in Bookmarks.dict | orderObjectBy : \'timeAdded\' : false" class="wrapped-vl-plot-group" chart="chart" field-set="chart.fieldSet" show-bookmark="true" show-debug="consts.debug" show-expand="false" always-selected="true" highlighted="highlighted" ng-mouseover="(highlighted||{})[field.name] = true" ng-mouseout="(highlighted||{})[field.name] = false" overflow="true" tooltip="true"></vl-plot-group></div><div class="vis-list-empty" ng-if="Bookmarks.length === 0">You have no bookmarks</div></div></div></div></div>'),e.put("components/datasetselector/datasetselector.html",'<select id="dataset-select" ng-model="Dataset.dataset" ng-change="datasetChanged()" ng-options="dataset.name for dataset in Dataset.datasets track by dataset.id"></select>'),e.put("components/alertmessages/alertmessages.html",'<div class="alert-box" ng-show="Alerts.alerts.length > 0"><div class="alert-item" ng-repeat="alert in Alerts.alerts">{{ alert.msg }} <a class="close" ng-click="Alerts.closeAlert($index)">&times;</a></div></div>'),e.put("components/configurationeditor/configurationeditor.html",'<form><div><label class="inline-label">Use server</label> <input type="checkbox" ng-model="Config.config.useVegaServer"></div><div><label class="inline-label">Data format</label><select required="" ng-options="format for format in Config.schema.properties.dataFormatType.enum track by format" ng-model="Config.config.dataFormatType"></select></div><div><label class="inline-label">Vega Server URL</label> <input ng-model="Config.config.vegaServerUrl" type="text"></div><pre>{{ Config.config | compactJSON }}</pre></form>'),e.put("components/fielddefeditor/fielddefeditor.html",'<div class="shelf-group"><div class="shelf" ng-class="{disabled: !schema.supportedMarktypes[marktype]}"><div class="shelf-label" ng-class="{expanded: propsExpanded}"><i class="fa fa-caret-down"></i> {{ encType }}</div><div class="field-drop" ng-model="pills[encType]" data-drop="schema.supportedMarktypes[marktype]" jqyoui-droppable="{onDrop:\'fieldDropped\'}" data-jqyoui-options="{activeClass: \'drop-active\'}"><field-info ng-show="enc[encType].name" ng-class="{expanded: funcsExpanded}" field="enc[encType]" show-type="true" show-caret="true" disable-count-or-o-caret="true" popup-content="fieldInfoPopupContent" show-remove="true" remove-action="removeField()" class="selected draggable full-width" data-drag="true" ng-model="pills[encType]" jqyoui-draggable="{onStart: \'fieldDragStart\', onStop:\'fieldDragStop\'}" data-jqyoui-options="{revert: \'invalid\', helper: \'clone\'}"></field-info><span class="placeholder" ng-if="!enc[encType].name">drop a field here</span></div></div><div class="drop-container"><div class="popup-menu shelf-properties shelf-properties-{{encType}}"><div><property-editor ng-show="schema.properties.legend" id="encType + \'legend\'" type="schema.properties.legend.type" enum="schema.properties.legend.enum" prop-name="\'legend\'" group="enc[encType]"></property-editor></div><div><property-editor ng-show="schema.properties.value" id="encType + \'value\'" type="schema.properties.value.type" enum="schema.properties.value.enum" prop-name="\'value\'" group="enc[encType]"></property-editor></div><div ng-repeat="group in [\'scale\', \'text\', \'axis\', \'bin\']" ng-show="schema.properties[group]"><h4>{{ group }}</h4><div ng-repeat="(propName, scaleProp) in schema.properties[group].properties" ng-init="id = encType + group + $index" ng-show="scaleProp.supportedTypes ? scaleProp.supportedTypes[enc[encType].type] : true"><property-editor id="id" type="scaleProp.type" enum="scaleProp.enum" prop-name="propName" group="enc[encType][group]"></property-editor></div></div></div><div class="popup-menu shelf-functions shelf-functions-{{encType}}"><div class="mb5"><h4>Types</h4><span ng-if="allowedTypes.length<=1">{{typeNames[enc[encType].type]}}</span> <label class="type-label" ng-if="allowedTypes.length>1" ng-repeat="type in allowedTypes"><input type="radio" ng-value="type" ng-model="enc[encType].type"> {{typeNames[type]}}</label></div><function-select field="enc[encType]" enc-type="encType" schema="schema"></function-select></div></div></div>'),e.put("components/fieldinfo/fieldinfo.html",'<span class="field-info"><span class="hflex full-width" ng-click="clicked($event)"><span class="type-caret" ng-class="{active: !disableCountOrOCaret || (field.type!==\'O\' && field.aggr!==\'count\')}"><i class="fa fa-caret-down" ng-show="showCaret"></i> <span class="type icon-small icon-type-{{typeNames[field.type]}}" ng-show="showType" title="{{typeNames[field.type]}}">{{field.type}}</span></span> <span ng-if="field.aggr!==\'count\'" class="field-info-text"><span ng-if="func(field)" class="field-func" ng-class="{any: field._any}">{{ func(field) }}</span><span class="field-name" ng-class="{hasfunc: func(field), any: field._any}">{{ field.name | underscore2space }}</span></span> <span ng-if="field.aggr===\'count\'" class="field-count field-info-text"><span class="field-name">COUNT</span></span> <span class="no-shrink remove" ng-show="showRemove"><a class="remove-field" ng-click="removeAction()"><i class="fa fa-times"></i></a></span> <span class="no-shrink info" ng-show="showInfo"><i ng-if="field.aggr !== \'count\' && field.type === \'O\'" class="fa fa-info-circle" tooltips="" tooltip-size="small" tooltip-content="<div class=\'tooltip-content\'> <strong>Name:</strong> {{field.name}}<br> <strong>Cardinality:</strong> {{stats.cardinality | number}}<br> <strong>Min:</strong> {{stats.min}}<br> <strong>Max:</strong> {{stats.max}}<br> <strong>Max length:</strong> {{stats.maxlength | number}}<br> <strong>Sample:</strong> <span class=\'sample\'>{{stats.sample.join(\', \')}}</span> </div>" tooltip-side="right"></i> <i ng-if="field.aggr !== \'count\' && field.type === \'T\'" class="fa fa-info-circle" tooltips="" tooltip-size="small" tooltip-content="<div class=\'tooltip-content\'> <strong>Name:</strong> {{field.name}}<br> <strong>Cardinality:</strong> {{stats.cardinality | number}}<br> <strong>Min:</strong> {{stats.min | date: short}}<br> <strong>Max:</strong> {{stats.max | date: short}}<br> <strong>Sample:</strong> <span class=\'sample\'>{{stats.sample.join(\', \')}}</span> </div>" tooltip-side="right"></i> <i ng-if="field.aggr !== \'count\' && field.type === \'Q\'" class="fa fa-info-circle" tooltips="" tooltip-size="small" tooltip-content="<div class=\'tooltip-content\'> <strong>Name:</strong> {{field.name}}<br> <strong>Cardinality:</strong> {{stats.cardinality | number}}<br> <strong>Min:</strong> {{stats.min | number}}<br> <strong>Max:</strong> {{stats.max | number}}<br> <strong>Stdev:</strong> {{stats.stdev | number:2}}<br> <strong>Mean:</strong> {{stats.mean | number:2}}<br> <strong>Median:</strong> {{stats.median | number}}<br> <strong>Sample:</strong> <span class=\'sample\'>{{stats.sample.join(\', \')}}</span> </div>" tooltip-side="right"></i><i ng-if="field.aggr === \'count\'" class="fa fa-info-circle" tooltips="" tooltip-size="small" tooltip-content="<div class=\'tooltip-content\'> <strong>Count:</strong> {{count}} </div>" tooltip-side="right"></i></span></span></span>'),e.put("components/functionselect/functionselect.html",'<div class="mb5" ng-if="func.list.length > 1 || func.list[0] !== \'\'"><h4>Functions</h4><label class="func-label field-func" ng-repeat="f in func.list"><input type="radio" ng-value="f" ng-model="func.selected" ng-change="selectChanged()"> {{f || \'-\'}}</label></div>'),e.put("components/marktypeselect/marktypeselect.html","<div></div>"),e.put("components/schemalistitem/schemalistitem.html",'<field-info field="field" show-type="true" show-info="true" class="pill list-item draggable full-width no-right-margin" ng-model="pill" data-drag="true" jqyoui-draggable="{placeholder: \'keep\', deepCopy: true, onStart: \'fieldDragStart\', onStop:\'fieldDragStop\'}" data-jqyoui-options="{revert: \'invalid\', helper: \'clone\'}"></field-info>'),e.put("components/propertyeditor/propertyeditor.html",'<label class="prop-label" for="{{ id }}">{{ propName }}</label><div class="inline-block" ng-switch="type + (enum !== undefined ? \'list\' : \'\')"><input id="{{ id }}" ng-switch-when="boolean" type="checkbox" ng-model="group[propName]"><select id="{{ id }}" ng-switch-when="stringlist" ng-model="group[propName]" ng-options="choice for choice in enum track by choice"></select><input id="{{ id }}" type="number" ng-switch-when="integer" ng-model="group[propName]" ng-model-options="{debounce: 200}"> <input id="{{ id }}" type="string" ng-switch-when="string" ng-model="group[propName]" ng-model-options="{debounce: 500}"></div>'),e.put("components/schemalist/schemalist.html",'<div class="schema full-width"><schema-list-item field="field" ng-repeat="field in Dataset.dataschema | orderBy : Dataset.fieldOrder"></schema-list-item></div>'),e.put("components/shelves/shelves.html",'<div class="card scroll-y abs-100"><a class="right" ng-click="clear()"><i class="fa fa-trash-o"></i> Clear</a><h2>Encoding</h2><div class="shelf-pane shelf-encoding-pane full-width"><h3>Positional</h3><field-def-editor enc-type="\'x\'" enc="Spec.spec.enc" marktype="Spec.spec.marktype" field-def-schema="schema.properties.enc.properties.x"></field-def-editor><field-def-editor enc-type="\'y\'" enc="Spec.spec.enc" marktype="Spec.spec.marktype" field-def-schema="schema.properties.enc.properties.y"></field-def-editor><field-def-editor enc-type="\'col\'" enc="Spec.spec.enc" marktype="Spec.spec.marktype" field-def-schema="schema.properties.enc.properties.col"></field-def-editor><field-def-editor enc-type="\'row\'" enc="Spec.spec.enc" marktype="Spec.spec.marktype" field-def-schema="schema.properties.enc.properties.row"></field-def-editor></div><div class="shelf-pane shelf-marks-pane full-width"><div class="right"><select class="markselect" ng-model="Spec.spec.marktype" ng-options="type for type in [\'point\', \'tick\', \'bar\', \'line\', \'area\', \'text\']" ng-change="markChange()"></select></div><h3>Marks</h3><field-def-editor enc-type="\'size\'" enc="Spec.spec.enc" marktype="Spec.spec.marktype" field-def-schema="schema.properties.enc.properties.size"></field-def-editor><field-def-editor enc-type="\'color\'" enc="Spec.spec.enc" marktype="Spec.spec.marktype" field-def-schema="schema.properties.enc.properties.color"></field-def-editor><field-def-editor enc-type="\'shape\'" enc="Spec.spec.enc" marktype="Spec.spec.marktype" field-def-schema="schema.properties.enc.properties.shape"></field-def-editor><field-def-editor enc-type="\'detail\'" enc="Spec.spec.enc" marktype="Spec.spec.marktype" field-def-schema="schema.properties.enc.properties.detail"></field-def-editor><field-def-editor enc-type="\'text\'" enc="Spec.spec.enc" marktype="Spec.spec.marktype" field-def-schema="schema.properties.enc.properties.text"></field-def-editor></div></div>'),e.put("components/vlSpecEditor/vlSpecEditor.html",'<div class="card scroll-y abs-100 vflex"><div class="subpane no-shrink"><a ng-click="parseShorthand(Spec.shorthand)" class="right command">Load</a><div class="right command"><a ui-zeroclip="" zeroclip-model="Spec.shorthand">Copy</a></div><h3>Vegalite Shorthand</h3><input class="shorthand full-width" type="text" ng-model="Spec.shorthand"></div><div class="subpane flex-grow-1 vflex"><div><a ng-click="parseVegalite(Spec.vlSpec)" class="right command">Load</a><div class="right command"><a ui-zeroclip="" zeroclip-model="Spec.vlSpec | compactJSON">Copy</a></div><h3>Vegalite Encoding</h3></div><textarea class="vlspec flex-grow-1 full-height" json-input="" type="text" ng-model="Spec.vlSpec"></textarea></div></div>'),e.put("components/nullfilterdirective/nullfilterdirective.html",'<label><input ng-model="Spec.spec.config.filterNull.O" ng-change="updateFilter()" type="checkbox"> Remove null values</label>'),e.put("components/vlplot/vlplot.html",'<div class="vis" id="vis-{{visId}}" ng-class="{ fit: !alwaysScrollable && !overflow && (maxHeight && (!height || height <= maxHeight)) && (maxWidth && (!width || width <= maxWidth)), overflow: alwaysScrollable || overflow || (maxHeight && height && height > maxHeight) || (maxWidth && width && width > maxWidth), scroll: alwaysScrollable || unlocked || hoverFocus }" ng-mousedown="unlocked=!thumbnail" ng-mouseup="unlocked=false" ng-mouseover="mouseover()" ng-mouseout="mouseout()"><div class="vis-tooltip" ng-show="tooltipActive"><table><tr ng-repeat="p in data"><td class="key">{{p[0]}}</td><td class="value"><b ng-if="p.isNumber">{{p[1]| number: 2}}</b> <b ng-if="!p.isNumber">{{p[1]}}</b></td></tr></table></div></div>'),e.put("components/vgSpecEditor/vgSpecEditor.html",'<div class="card scroll-y abs-100 vflex no-right-margin"><div><div class="right"><a class="command" ui-zeroclip="" zeroclip-model="Spec.vgSpec | compactJSON">Copy</a><lyra-export></lyra-export></div><h3>Vega Specification</h3></div><textarea class="vgspec flex-grow-1" json-input="" disabled="disabled" type="text" ng-model="Spec.vgSpec"></textarea></div>'),e.put("components/vlplotgroup/vlplotgroup.html",'<div class="vl-plot-group card vflex"><div ng-show="showExpand || fieldSet || showBookmark || showToggle" class="vl-plot-group-header full-width no-shrink"><div class="right"><a ng-show="consts.debug && showDebug" class="command debug"><i class="fa fa-wrench"></i></a><div class="drop-container"><div class="popup-menu popup-command no-shrink dev-tool"><a class="command debug" ui-zeroclip="" zeroclip-model="chart.shorthand">Copy Vls</a> <a class="command debug" ui-zeroclip="" zeroclip-model="chart.vlSpec | compactJSON">Copy Vl</a> <a class="command debug" ui-zeroclip="" zeroclip-model="chart.vgSpec | compactJSON">Copy Vg</a> <a class="command debug" ng-href="{{ {type:\'vl\', encoding: chart.vlSpec} | reportUrl }}" target="_blank">Report Bad Render</a> <a ng-click="showFeature=!showFeature" class="command debug">{{chart.score}}</a><div ng-repeat="f in chart.scoreFeatures track by f.reason">[{{f.score}}] {{f.reason}}</div></div></div><a ng-if="showMarkType" class="command disabled"><i class="fa fa-font"></i> <i class="fa fa-line-chart"></i> <i class="fa fa-area-chart"></i> <i class="fa fa-bar-chart"></i> <i class="fa fa-circle-o"></i></a> <a ng-if="showLog && chart.vlSpec && log.support(chart.vlSpec, \'x\')" class="command" ng-click="log.toggle(chart.vlSpec, \'x\')" ng-class="{active: log.active(chart.vlSpec, \'x\')}"><i class="fa fa-long-arrow-right"></i> <small>LOG X</small></a> <a ng-if="showLog && chart.vlSpec && log.support(chart.vlSpec, \'y\')" class="command" ng-click="log.toggle(chart.vlSpec, \'y\')" ng-class="{active: log.active(chart.vlSpec, \'y\')}"><i class="fa fa-long-arrow-up"></i> <small>LOG Y</small></a> <a ng-show="showSort && chart.vlSpec && toggleSort.support(chart.vlSpec, Dataset.stats)" class="command" ng-click="toggleSort(chart.vlSpec)"><i class="fa sort" ng-class="toggleSortClass(chart.vlSpec)"></i> <small ng-if="showLabel">Sort</small></a> <a ng-if="showFilterNull && chart.vlSpec && toggleFilterNull.support(chart.vlSpec, Dataset.stats)" class="command" ng-click="toggleFilterNull(chart.vlSpec)" ng-class="{active: chart.vlSpec && chart.vlSpec.config.filterNull.O}"><i class="fa fa-filter"></i> <small ng-if="showLabel">Filter</small> <small>NULL</small></a> <a ng-if="showTranspose" class="command" ng-click="transpose()"><i class="fa fa-refresh transpose"></i> <small ng-if="showLabel">Transpose</small></a> <a ng-if="showBookmark" class="command" ng-click="Bookmarks.toggle(chart)" ng-class="{disabled: !chart.vlSpec.enc, active: Bookmarks.isBookmarked(chart.shorthand)}"><i class="fa fa-bookmark"></i> <small ng-if="showLabel">Bookmark</small></a> <a ng-if="showExpand" ng-click="expandAction()" class="command"><i class="fa fa-expand"></i></a></div><div class="field-set-info" ng-if="fieldSet"><field-info ng-repeat="field in fieldSet" field="field" show-type="true" ng-class="{ selected: alwaysSelected || (isSelected && isSelected(field.name)), unselected: isSelected && !isSelected(field.name), highlighted: (highlighted||{})[field.name] }" ng-mouseover="(highlighted||{})[field.name] = true" ng-mouseout="(highlighted||{})[field.name] = false"></field-info></div></div><div class="vl-plot-wrapper full-width vis-{{fieldSet.key}} flex-grow-1"><vl-plot vl-spec="chart.vlSpec" disabled="disabled" field-set-key="chart.fieldSetKey" is-in-list="isInList" shorthand="chart.shorthand" config-set="{{configSet||\'small\'}}" max-height="maxHeight" max-width="maxWidth" overflow="overflow" tooltip="tooltip" rescale="rescale" thumbnail="thumbnail" always-scrollable="alwaysScrollable"></vl-plot></div></div>')
}]);